import{b0 as Se,b1 as oe,r as f,b2 as Te,b3 as De,j as e,b4 as ke,b5 as G,b6 as Fe,b7 as Ee,b8 as W,b9 as Pe,Y as re,R as C,B as _,P as Re,S as Ve,I as w,X as O,i as $,E as Ie,V as Me,W as Ae,D as $e,d as ze,e as Ke,f as He,g as Oe,Z as Be,$ as o,a0 as x,a2 as j,a1 as h,a3 as p,ae as B,ba as Ge,ar as qe,h as Ue,C as Qe,am as Ye,an as Xe,ao as Je,ap as de,T as We,w as Ze}from"./index-QCM3tg6T.js";import{T as E}from"./textarea-BRLhZEOX.js";import{S as Z,a as L,b as ee,c as se,d as ae}from"./select-Gd6X59OL.js";import{S as te}from"./switch-Dx-NYZfn.js";import{C as Le}from"./confirm-dialog-Ct8Hml3F.js";import{u as es,a as ss,g as as}from"./mcptools.service-DWKdhTwV.js";import{H as ts}from"./header-BrQ_ZiF7.js";import{M as ns}from"./main-BjTc0OpD.js";import{C as rs}from"./chevron-down-BGPTkRL1.js";import{E as ls}from"./ellipsis-vertical-MoBodAGb.js";import{S as is}from"./square-pen-BEuFlBVg.js";import"./index-CZ42OGo5.js";import"./use-infinite-scroll-Hevnk5Sy.js";var le="Tabs",[cs,Es]=Se(le,[oe]),xe=oe(),[ds,ie]=cs(le),me=f.forwardRef((r,t)=>{const{__scopeTabs:a,value:m,onValueChange:v,defaultValue:c,orientation:d="horizontal",dir:u,activationMode:S="automatic",...b}=r,g=Te(u),[i,N]=De({prop:m,onChange:v,defaultProp:c});return e.jsx(ds,{scope:a,baseId:ke(),value:i,onValueChange:N,orientation:d,dir:g,activationMode:S,children:e.jsx(G.div,{dir:g,"data-orientation":d,...b,ref:t})})});me.displayName=le;var he="TabsList",ue=f.forwardRef((r,t)=>{const{__scopeTabs:a,loop:m=!0,...v}=r,c=ie(he,a),d=xe(a);return e.jsx(Fe,{asChild:!0,...d,orientation:c.orientation,dir:c.dir,loop:m,children:e.jsx(G.div,{role:"tablist","aria-orientation":c.orientation,...v,ref:t})})});ue.displayName=he;var je="TabsTrigger",pe=f.forwardRef((r,t)=>{const{__scopeTabs:a,value:m,disabled:v=!1,...c}=r,d=ie(je,a),u=xe(a),S=fe(d.baseId,m),b=be(d.baseId,m),g=m===d.value;return e.jsx(Ee,{asChild:!0,...u,focusable:!v,active:g,children:e.jsx(G.button,{type:"button",role:"tab","aria-selected":g,"aria-controls":b,"data-state":g?"active":"inactive","data-disabled":v?"":void 0,disabled:v,id:S,...c,ref:t,onMouseDown:W(r.onMouseDown,i=>{!v&&i.button===0&&i.ctrlKey===!1?d.onValueChange(m):i.preventDefault()}),onKeyDown:W(r.onKeyDown,i=>{[" ","Enter"].includes(i.key)&&d.onValueChange(m)}),onFocus:W(r.onFocus,()=>{const i=d.activationMode!=="manual";!g&&!v&&i&&d.onValueChange(m)})})})});pe.displayName=je;var ve="TabsContent",ge=f.forwardRef((r,t)=>{const{__scopeTabs:a,value:m,forceMount:v,children:c,...d}=r,u=ie(ve,a),S=fe(u.baseId,m),b=be(u.baseId,m),g=m===u.value,i=f.useRef(g);return f.useEffect(()=>{const N=requestAnimationFrame(()=>i.current=!1);return()=>cancelAnimationFrame(N)},[]),e.jsx(Pe,{present:v||g,children:({present:N})=>e.jsx(G.div,{"data-state":g?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":S,hidden:!N,id:b,tabIndex:0,...d,ref:t,style:{...r.style,animationDuration:i.current?"0s":void 0},children:N&&c})})});ge.displayName=ve;function fe(r,t){return`${r}-trigger-${t}`}function be(r,t){return`${r}-content-${t}`}var os=me,Ne=ue,ye=pe,Ce=ge;const xs=os,we=f.forwardRef(({className:r,...t},a)=>e.jsx(Ne,{ref:a,className:re("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...t}));we.displayName=Ne.displayName;const M=f.forwardRef(({className:r,...t},a)=>e.jsx(ye,{ref:a,className:re("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...t}));M.displayName=ye.displayName;const A=f.forwardRef(({className:r,...t},a)=>e.jsx(Ce,{ref:a,className:re("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));A.displayName=Ce.displayName;const ms=C.object({name:C.string().min(1,{message:"工具名称是必填项"}).max(200,{message:"名称不能超过200个字符"}),description:C.string().optional(),tool_type:C.string().default("mcp"),sub_type:C.string().default("stdio"),tags:C.array(C.string()).default([]),is_active:C.boolean().default(!0),command:C.string().optional(),args:C.string().optional(),env:C.string().optional(),url:C.string().optional(),headers:C.string().default(""),timeout:C.number().optional()}).refine(r=>{var t,a;return r.sub_type==="stdio"?!!((t=r.command)!=null&&t.trim()):r.sub_type==="sse"||r.sub_type==="streamableHttp"?!!((a=r.url)!=null&&a.trim()):!0},{message:"请填写必要的配置信息",path:["sub_type"]}),ne=[{value:"stdio",label:"STDIO"},{value:"sse",label:"SSE"},{value:"streamableHttp",label:"Streamable HTTP"}];function hs({open:r,currentTool:t,isLoading:a,closeDialog:m,handleSubmit:v}){const[c,d]=f.useState(""),[u,S]=f.useState(new Set(["get_channel_videos"])),[b,g]=f.useState("info"),[i,N]=f.useState(null),[z,P]=f.useState(new Set),R=!!t,q=r==="create"||r==="edit",{data:k,isLoading:V}=Ie({queryKey:["mcp-info",t==null?void 0:t.uuid,b],queryFn:()=>as(t.uuid),enabled:!!t&&t.sub_type==="streamableHttp"&&["tools","prompts","resources"].includes(b)&&!z.has(`${t.uuid}-${b}`),staleTime:5*60*1e3});f.useEffect(()=>{k&&t&&(N(k.mcp_info),P(s=>new Set(s).add(`${t.uuid}-${b}`)))},[k,t,b]);const l=Me({resolver:Ae(ms),defaultValues:{name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",headers:"",timeout:30}});f.useEffect(()=>{if(t){const s=t.tool_conf||{},n=t.sub_type||"stdio";let y="",K="",I="",F="",H="";if(n==="stdio"){y=s.command||"",K=s.args?Array.isArray(s.args)?s.args.join(" "):s.args:"";const D=s.env;typeof D=="object"&&D!==null?I=Object.entries(D).map(([X,J])=>`${X}=${J}`).join(`
`):I=D||""}else if(n==="sse")F=s.url||"",H="";else if(n==="streamableHttp"){F=s.url||"";const D=s.headers;typeof D=="object"&&D!==null?H=Object.entries(D).map(([X,J])=>`${X}: ${J}`).join(`
`):H=D||""}l.reset({name:t.name,description:t.description||"",tool_type:t.tool_type||"mcp",sub_type:n,tags:t.tags||[],is_active:t.is_active??!0,command:y,args:K,env:I,url:F,headers:H,timeout:s.timeout||30}),g("info"),N(null),P(new Set)}else l.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",headers:"",timeout:30}),g("info"),N(null),P(new Set)},[t,l]);const U=s=>{v(s),d("")},T=()=>{if(c.trim()&&!l.getValues("tags").includes(c.trim())){const s=l.getValues("tags");l.setValue("tags",[...s,c.trim()]),d("")}},Q=s=>{const n=l.getValues("tags");l.setValue("tags",n.filter(y=>y!==s))},Y=s=>{s.key==="Enter"&&(s.preventDefault(),T())},_e=s=>{const n=new Set(u);n.has(s)?n.delete(s):n.add(s),S(n)},ce=s=>{!a&&!s&&(l.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",headers:"",timeout:30}),d(""),g("info"),N(null),P(new Set),m())};return e.jsx($e,{open:q,onOpenChange:ce,children:e.jsxs(ze,{className:"sm:max-w-1xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ke,{className:"text-left",children:[e.jsx(He,{children:R?`编辑工具 - ${t==null?void 0:t.name}`:"创建工具"}),e.jsxs(Oe,{children:[R?"修改工具信息":"创建一个新的工具","，填写必要信息后点击保存。"]})]}),e.jsx(Be,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(U),className:"space-y-4",children:[e.jsx(o,{control:l.control,name:"tool_type",render:({field:s})=>e.jsx(x,{className:"hidden",children:e.jsx(j,{children:e.jsx(w,{...s,type:"hidden"})})})}),l.watch("sub_type")==="streamableHttp"&&e.jsx(e.Fragment,{children:e.jsxs(xs,{value:b,onValueChange:g,className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-4",children:[e.jsx(M,{value:"info",children:"信息"}),e.jsx(M,{value:"tools",children:"工具"}),e.jsx(M,{value:"prompts",children:"提示"}),e.jsx(M,{value:"resources",children:"资源"})]}),e.jsxs(A,{value:"info",className:"space-y-4",children:[e.jsx(o,{control:l.control,name:"name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"工具名称 *"}),e.jsx(j,{children:e.jsx(w,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"描述"}),e.jsx(j,{children:e.jsx(E,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"对接方式"}),e.jsxs(Z,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(j,{children:e.jsx(L,{children:e.jsx(ee,{placeholder:"选择对接方式"})})}),e.jsx(se,{children:ne.map(n=>e.jsx(ae,{value:n.value,children:n.label},n.value))})]}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"url",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"URL *"}),e.jsx(j,{children:e.jsx(w,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:a})}),e.jsx(p,{})]})}),l.watch("sub_type")==="streamableHttp"&&e.jsx(o,{control:l.control,name:"headers",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"请求头"}),e.jsx(j,{children:e.jsx(E,{placeholder:`例如:
Authorization: Bearer your_token_here
Content-Type: application/json
X-API-Key: your_api_key
每行一个请求头，格式：Key: Value`,className:"resize-none",rows:4,...s,disabled:a})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"每行一个请求头，格式：Key: Value。空行会被忽略。"}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"超时时间（秒）"}),e.jsx(j,{children:e.jsx(w,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:n=>s.onChange(parseInt(n.target.value)||30),disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(x,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(h,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(j,{children:e.jsx(te,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(o,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"输入标签后按回车添加",value:c,onChange:n=>d(n.target.value),onKeyPress:Y,disabled:a}),e.jsx(_,{type:"button",variant:"outline",onClick:T,disabled:!c.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((n,y)=>e.jsxs(B,{variant:"secondary",className:"text-sm",children:[n,e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Q(n),disabled:a,children:e.jsx(O,{className:"h-3 w-3"})})]},y))})]}),e.jsx(p,{})]})})]}),e.jsx(A,{value:"tools",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:V?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载工具信息中..."})]}):i!=null&&i.tools&&i.tools.length>0?i.tools.map((s,n)=>e.jsxs("div",{className:"border rounded p-3 hover:bg-accent cursor-pointer",onClick:()=>_e(s.name),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.has(s.name)?e.jsx(rs,{className:"h-4 w-4 flex-shrink-0"}):e.jsx(Ge,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]})}),u.has(s.name)&&e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:s.inputSchema&&e.jsxs("div",{className:"mt-3 ml-5",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"输入参数:"}),e.jsx("div",{className:"bg-muted rounded p-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 text-xs",children:Object.entries(s.inputSchema.properties||{}).map(([y,K])=>{var F;const I=((F=s.inputSchema.required)==null?void 0:F.includes(y))||!1;return e.jsxs(qe.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[y,I&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"text-muted-foreground",children:e.jsx("span",{className:"inline-flex items-center",children:K.type})})]},y)})})})]})})]},n)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用工具"})})}),e.jsx(A,{value:"prompts",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:V?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载提示信息中..."})]}):i!=null&&i.prompts&&i.prompts.length>0?i.prompts.map((s,n)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description}),s.arguments&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"参数:"}),e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto",children:JSON.stringify(s.arguments,null,2)})]})]},n)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用提示"})})}),e.jsx(A,{value:"resources",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:V?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载资源信息中..."})]}):i!=null&&i.resources&&i.resources.length>0?i.resources.map((s,n)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("div",{className:"text-xs text-blue-600 break-all",children:["URI: ",s.uri]})]},n)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用资源"})})})]})}),l.watch("sub_type")==="sse"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{control:l.control,name:"name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"工具名称 *"}),e.jsx(j,{children:e.jsx(w,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"描述"}),e.jsx(j,{children:e.jsx(E,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"对接方式"}),e.jsxs(Z,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(j,{children:e.jsx(L,{children:e.jsx(ee,{placeholder:"选择对接方式"})})}),e.jsx(se,{children:ne.map(n=>e.jsx(ae,{value:n.value,children:n.label},n.value))})]}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"url",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"URL *"}),e.jsx(j,{children:e.jsx(w,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"超时时间（秒）"}),e.jsx(j,{children:e.jsx(w,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:n=>s.onChange(parseInt(n.target.value)||30),disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(x,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(h,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(j,{children:e.jsx(te,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(o,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"输入标签后按回车添加",value:c,onChange:n=>d(n.target.value),onKeyPress:Y,disabled:a}),e.jsx(_,{type:"button",variant:"outline",onClick:T,disabled:!c.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((n,y)=>e.jsxs(B,{variant:"secondary",className:"text-sm",children:[n,e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Q(n),disabled:a,children:e.jsx(O,{className:"h-3 w-3"})})]},y))})]}),e.jsx(p,{})]})})]}),l.watch("sub_type")==="stdio"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{control:l.control,name:"name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"工具名称 *"}),e.jsx(j,{children:e.jsx(w,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"描述"}),e.jsx(j,{children:e.jsx(E,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"对接方式"}),e.jsxs(Z,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(j,{children:e.jsx(L,{children:e.jsx(ee,{placeholder:"选择对接方式"})})}),e.jsx(se,{children:ne.map(n=>e.jsx(ae,{value:n.value,children:n.label},n.value))})]}),e.jsx(p,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{control:l.control,name:"command",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"命令 *"}),e.jsx(j,{children:e.jsx(w,{placeholder:"例如: python, node, npx",...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"args",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"参数"}),e.jsx(j,{children:e.jsx(E,{placeholder:`例如: path/to/script.py --option value
每行一个参数，或者用空格分隔`,className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"env",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"环境变量"}),e.jsx(j,{children:e.jsx(E,{placeholder:`例如:
API_KEY=your_api_key_here
DEBUG=true
PORT=3000
每行一个环境变量，格式：KEY=VALUE`,className:"resize-none",rows:4,...s,disabled:a})}),e.jsx(p,{})]})})]}),e.jsx(o,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"超时时间（秒）"}),e.jsx(j,{children:e.jsx(w,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:n=>s.onChange(parseInt(n.target.value)||30),disabled:a})}),e.jsx(p,{})]})}),e.jsx(o,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(x,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(h,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(j,{children:e.jsx(te,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(o,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(x,{children:[e.jsx(h,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"输入标签后按回车添加",value:c,onChange:n=>d(n.target.value),onKeyPress:Y,disabled:a}),e.jsx(_,{type:"button",variant:"outline",onClick:T,disabled:!c.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((n,y)=>e.jsxs(B,{variant:"secondary",className:"text-sm",children:[n,e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Q(n),disabled:a,children:e.jsx(O,{className:"h-3 w-3"})})]},y))})]}),e.jsx(p,{})]})})]}),e.jsxs(Ue,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>ce(!1),disabled:a,children:"取消"}),e.jsx(_,{type:"submit",disabled:a,children:a?"保存中...":R?"更新":"创建"})]})]})})]})})}function us({open:r,currentTool:t,isLoading:a,closeDialog:m,handleDelete:v}){return e.jsx(Le,{open:r==="delete",onOpenChange:c=>!c&&m(),handleConfirm:v,title:"删除工具",desc:t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["确定要删除工具 ",e.jsxs("span",{className:"font-semibold",children:['"',t.name,'"']})," 吗？"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• 对接方式：",t.sub_type]}),e.jsxs("p",{children:["• 标签：",t.tags.join(", ")||"无"]})]}),e.jsx("p",{className:"text-sm font-medium text-destructive mt-3",children:"此操作无法撤销，请谨慎操作。"})]}):"此操作无法撤销，请谨慎操作。",confirmText:"删除",destructive:!0,isLoading:a})}function js({tool:r,openEdit:t,openDelete:a}){return e.jsx(Qe,{className:"p-4 hover:bg-accent hover:text-accent-foreground border-0 relative group",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:r.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:!r.is_active&&e.jsx(B,{variant:"secondary",className:"text-xs",children:"已禁用"})})]}),e.jsxs(Ye,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ls,{className:"h-4 w-4"})})}),e.jsxs(Je,{align:"end",children:[e.jsxs(de,{onClick:()=>t(r),children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"编辑"]}),e.jsxs(de,{onClick:()=>a(r),className:"text-destructive focus:text-destructive",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"删除"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3 text-xs text-muted-foreground",children:e.jsx("span",{children:r.sub_type})}),e.jsx("p",{className:"text-sm text-muted-foreground flex-grow line-clamp-2",children:r.description||"暂无描述"})]})})}function ps({dialogProps:r}){const{tools:t,totalCount:a,isLoading:m,error:v,hasNextPage:c,isFetchingNextPage:d,searchQuery:u,setSearchQuery:S,loadMoreRef:b,fetchNextPage:g}=ss(),{open:i,currentTool:N,dialogLoading:z,openCreate:P,openEdit:R,openDelete:q,closeDialog:k,handleSubmit:V,handleDelete:l}=r,U=()=>{S("")};return v?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-destructive",children:"加载工具失败"}),e.jsx(_,{onClick:()=>g(),className:"mt-4",children:"重试"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto pt-0 px-6 pb-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{className:"pl-8 h-10 bg-transparent",placeholder:"搜索工具名称、描述或标签...",value:u,onChange:T=>S(T.target.value)}),u&&e.jsx(_,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 opacity-70 hover:opacity-100",onClick:U,disabled:m,children:e.jsx(O,{className:"h-4 w-4"})})]})}),!m&&e.jsx("div",{className:"mb-6 text-sm text-muted-foreground",children:a>0&&(u?e.jsxs(e.Fragment,{children:["找到 ",a,' 个匹配 "',u,'" 的工具']}):e.jsxs(e.Fragment,{children:["共 ",a," 个工具"]}))}),m&&t.length===0?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx($,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载中..."})]}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:u?`没有找到匹配 "${u}" 的工具`:"还没有工具，点击上方按钮创建第一个工具"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(T=>e.jsx(js,{tool:T,openEdit:R,openDelete:q},T.uuid))}),e.jsx("div",{ref:b,className:"mt-8 flex justify-center",children:d?e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx($,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"加载更多..."})]}):c?e.jsx("div",{className:"py-4",children:e.jsx(_,{variant:"outline",onClick:()=>g(),className:"text-sm",children:u?"点击加载更多搜索结果":"点击加载更多"})}):t.length>0?e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"已到底啦"})}):null})]}),e.jsx(hs,{open:i,currentTool:N,isLoading:z,closeDialog:k,handleSubmit:V}),e.jsx(us,{open:i,currentTool:N,isLoading:z,closeDialog:k,handleDelete:l}),e.jsx("div",{className:"h-[30px]"})]})}function vs(){const{open:r,currentTool:t,isLoading:a,openCreate:m,openEdit:v,openDelete:c,closeDialog:d,handleSubmit:u,handleDelete:S}=es();return e.jsxs(e.Fragment,{children:[e.jsxs(ts,{fixed:!0,children:[e.jsx("h3",{className:"text-2xl font-bold",children:"MCP工具"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsxs(_,{onClick:m,variant:"ghost",children:[e.jsx(Re,{className:"h-4 w-4"}),"新建工具"]})})]}),e.jsx(ns,{children:e.jsx(ps,{dialogProps:{open:r,currentTool:t,dialogLoading:a,openEdit:v,openDelete:c,closeDialog:d,handleSubmit:u,handleDelete:S}})})]})}const Ps=Ze("/_authenticated/mcptools/")({component:vs});export{Ps as Route};
