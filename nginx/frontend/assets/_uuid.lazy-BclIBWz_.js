import{c as Ie,r as N,j as g,bF as lr,$ as Et,T as dr,a as Vn,u as Fn,K as $t,M as Ct,b as On,i as Te,X as ur,S as fr,I as gr,al as hr,bZ as pr,w as mr}from"./index-CTPVv2qI.js";import{w as Ut}from"./whiteboard-DRU2tC5K.js";import{f as xr,g as Qt,h as Jt,j as en,k as yr,b as it,p as Yn,z as Wn,d as Xn,i as wr,l as xt,t as br,c as re,u as vr,s as se,a as Nr,e as tn}from"./index-Cmg_3NXZ.js";import{S as Gn}from"./sticky-note-gfnjJFSD.js";import{S as Er}from"./square-pen-DRmb1xVr.js";import{T as Cr}from"./tag-VD1gqTC7.js";import{C as Sr}from"./copy-DCTh9Qv_.js";import{S as qn}from"./save-CysiHy1C.js";import"./index-pO__9giw.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=Ie("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=Ie("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=Ie("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=Ie("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=Ie("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=Ie("SquareDashed",[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]]);function $r(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),o;return function(r){for(o=0;o<n;++o)s[o]=e[o]*(1-r)+t[o]*r;return s}}function Lr(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Dr(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,o=new Array(s),r=new Array(n),i;for(i=0;i<s;++i)o[i]=De(e[i],t[i]);for(;i<n;++i)r[i]=t[i];return function(a){for(i=0;i<s;++i)r[i]=o[i](a);return r}}function _r(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Tr(e,t){var n={},s={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?n[o]=De(e[o],t[o]):s[o]=t[o];return function(r){for(o in n)s[o]=n[o](r);return s}}function De(e,t){var n=typeof t,s;return t==null||n==="boolean"?xr(t):(n==="number"?Qt:n==="string"?(s=Jt(t))?(t=s,en):yr:t instanceof Jt?en:t instanceof Date?_r:Lr(t)?$r:Array.isArray(t)?Dr:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Tr:Qt)(e,t)}const le={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},He=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Kn=["Enter"," ","Escape"],Zn={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Se;(function(e){e.Strict="strict",e.Loose="loose"})(Se||(Se={}));var ye;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(ye||(ye={}));var ze;(function(e){e.Partial="partial",e.Full="full"})(ze||(ze={}));const Un={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var pe;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(pe||(pe={}));var nt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(nt||(nt={}));var W;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(W||(W={}));const nn={[W.Left]:W.Right,[W.Right]:W.Left,[W.Top]:W.Bottom,[W.Bottom]:W.Top};function Qn(e){return e===null?null:e?"valid":"invalid"}const Jn=e=>"id"in e&&"source"in e&&"target"in e,Hr=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Lt=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Oe=(e,t=[0,0])=>{const{width:n,height:s}=fe(e),o=e.origin??t,r=n*o[0],i=s*o[1];return{x:e.position.x-r,y:e.position.y-i}},zr=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,o)=>{const r=typeof o=="string";let i=!t.nodeLookup&&!r?o:void 0;t.nodeLookup&&(i=r?t.nodeLookup.get(o):Lt(o)?o:t.nodeLookup.get(o.id));const a=i?ot(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return at(s,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ct(n)},Ye=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(o=>{(t.filter===void 0||t.filter(o))&&(n=at(n,ot(o)),s=!0)}),s?ct(n):{x:0,y:0,width:0,height:0}},Dt=(e,t,[n,s,o]=[0,0,1],r=!1,i=!1)=>{const a={...Xe(t,[n,s,o]),width:t.width/o,height:t.height/o},l=[];for(const u of e.values()){const{measured:m,selectable:d=!0,hidden:c=!1}=u;if(i&&!d||c)continue;const f=m.width??u.width??u.initialWidth??null,p=m.height??u.height??u.initialHeight??null,x=Be(a,Me(u)),w=(f??0)*(p??0),y=r&&x>0;(!u.internals.handleBounds||y||x>=w||u.dragging)&&l.push(u)}return l},Br=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function Rr(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(o=>o.id)):null;return e.forEach(o=>{o.measured.width&&o.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!o.hidden)&&(!s||s.has(o.id))&&n.set(o.id,o)}),n}async function Vr({nodes:e,width:t,height:n,panZoom:s,minZoom:o,maxZoom:r},i){if(e.size===0)return Promise.resolve(!0);const a=Rr(e,i),l=Ye(a),u=_t(l,t,n,(i==null?void 0:i.minZoom)??o,(i==null?void 0:i.maxZoom)??r,(i==null?void 0:i.padding)??.1);return await s.setViewport(u,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function eo({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:o,onError:r}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:l,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},m=i.origin??s;let d=i.extent||o;if(i.extent==="parent"&&!i.expandParent)if(!a)r==null||r("005",le.error005());else{const f=a.measured.width,p=a.measured.height;f&&p&&(d=[[l,u],[l+f,u+p]])}else a&&je(i.extent)&&(d=[[i.extent[0][0]+l,i.extent[0][1]+u],[i.extent[1][0]+l,i.extent[1][1]+u]]);const c=je(d)?we(t,d,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&(r==null||r("015",le.error015())),{position:{x:c.x-l+(i.measured.width??0)*m[0],y:c.y-u+(i.measured.height??0)*m[1]},positionAbsolute:c}}async function Fr({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:o}){const r=new Set(e.map(c=>c.id)),i=[];for(const c of n){if(c.deletable===!1)continue;const f=r.has(c.id),p=!f&&c.parentId&&i.find(x=>x.id===c.parentId);(f||p)&&i.push(c)}const a=new Set(t.map(c=>c.id)),l=s.filter(c=>c.deletable!==!1),m=Br(i,l);for(const c of l)a.has(c.id)&&!m.find(p=>p.id===c.id)&&m.push(c);if(!o)return{edges:m,nodes:i};const d=await o({nodes:i,edges:m});return typeof d=="boolean"?d?{edges:m,nodes:i}:{edges:[],nodes:[]}:d}const ke=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),we=(e={x:0,y:0},t,n)=>({x:ke(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:ke(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function to(e,t,n){const{width:s,height:o}=fe(n),{x:r,y:i}=n.internals.positionAbsolute;return we(e,[[r,i],[r+s,i+o]],t)}const on=(e,t,n)=>e<t?ke(Math.abs(e-t),1,t)/t:e>n?-ke(Math.abs(e-n),1,t)/t:0,no=(e,t,n=15,s=40)=>{const o=on(e.x,s,t.width-s)*n,r=on(e.y,s,t.height-s)*n;return[o,r]},at=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),St=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),ct=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Me=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=Lt(e)?e.internals.positionAbsolute:Oe(e,t);return{x:n,y:s,width:((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0,height:((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0}},ot=(e,t=[0,0])=>{var o,r;const{x:n,y:s}=Lt(e)?e.internals.positionAbsolute:Oe(e,t);return{x:n,y:s,x2:n+(((o=e.measured)==null?void 0:o.width)??e.width??e.initialWidth??0),y2:s+(((r=e.measured)==null?void 0:r.height)??e.height??e.initialHeight??0)}},oo=(e,t)=>ct(at(St(e),St(t))),Be=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},sn=e=>ae(e.width)&&ae(e.height)&&ae(e.x)&&ae(e.y),ae=e=>!isNaN(e)&&isFinite(e),Or=(e,t)=>{},We=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Xe=({x:e,y:t},[n,s,o],r=!1,i=[1,1])=>{const a={x:(e-n)/o,y:(t-s)/o};return r?We(a,i):a},st=({x:e,y:t},[n,s,o])=>({x:e*o+n,y:t*o+s});function Ne(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function Yr(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=Ne(e,n),o=Ne(e,t);return{top:s,right:o,bottom:s,left:o,x:o*2,y:s*2}}if(typeof e=="object"){const s=Ne(e.top??e.y??0,n),o=Ne(e.bottom??e.y??0,n),r=Ne(e.left??e.x??0,t),i=Ne(e.right??e.x??0,t);return{top:s,right:i,bottom:o,left:r,x:r+i,y:s+o}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Wr(e,t,n,s,o,r){const{x:i,y:a}=st(e,[t,n,s]),{x:l,y:u}=st({x:e.x+e.width,y:e.y+e.height},[t,n,s]),m=o-l,d=r-u;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(m),bottom:Math.floor(d)}}const _t=(e,t,n,s,o,r)=>{const i=Yr(r,t,n),a=(t-i.x)/e.width,l=(n-i.y)/e.height,u=Math.min(a,l),m=ke(u,s,o),d=e.x+e.width/2,c=e.y+e.height/2,f=t/2-d*m,p=n/2-c*m,x=Wr(e,f,p,m,t,n),w={left:Math.min(x.left-i.left,0),top:Math.min(x.top-i.top,0),right:Math.min(x.right-i.right,0),bottom:Math.min(x.bottom-i.bottom,0)};return{x:f-w.left+w.right,y:p-w.top+w.bottom,zoom:m}},Re=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function je(e){return e!=null&&e!=="parent"}function fe(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function so(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function ro(e,t={width:0,height:0},n,s,o){const r={...e},i=s.get(n);if(i){const a=i.origin||o;r.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],r.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return r}function rn(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Xr(){let e,t;return{promise:new Promise((s,o)=>{e=s,t=o}),resolve:e,reject:t}}function Gr(e){return{...Zn,...e||{}}}function _e(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:o}){const{x:r,y:i}=ce(e),a=Xe({x:r-((o==null?void 0:o.left)??0),y:i-((o==null?void 0:o.top)??0)},s),{x:l,y:u}=n?We(a,t):a;return{xSnapped:l,ySnapped:u,...a}}const Tt=e=>({width:e.offsetWidth,height:e.offsetHeight}),io=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},qr=["INPUT","SELECT","TEXTAREA"];function ao(e){var s,o;const t=((o=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:o[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:qr.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const co=e=>"clientX"in e,ce=(e,t)=>{var r,i;const n=co(e),s=n?e.clientX:(r=e.touches)==null?void 0:r[0].clientX,o=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},an=(e,t,n,s,o)=>{const r=t.querySelectorAll(`.${e}`);return!r||!r.length?null:Array.from(r).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:o,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/s,y:(a.top-n.top)/s,...Tt(i)}})};function lo({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:o,sourceControlY:r,targetControlX:i,targetControlY:a}){const l=e*.125+o*.375+i*.375+n*.125,u=t*.125+r*.375+a*.375+s*.125,m=Math.abs(l-e),d=Math.abs(u-t);return[l,u,m,d]}function Qe(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function cn({pos:e,x1:t,y1:n,x2:s,y2:o,c:r}){switch(e){case W.Left:return[t-Qe(t-s,r),n];case W.Right:return[t+Qe(s-t,r),n];case W.Top:return[t,n-Qe(n-o,r)];case W.Bottom:return[t,n+Qe(o-n,r)]}}function uo({sourceX:e,sourceY:t,sourcePosition:n=W.Bottom,targetX:s,targetY:o,targetPosition:r=W.Top,curvature:i=.25}){const[a,l]=cn({pos:n,x1:e,y1:t,x2:s,y2:o,c:i}),[u,m]=cn({pos:r,x1:s,y1:o,x2:e,y2:t,c:i}),[d,c,f,p]=lo({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:a,sourceControlY:l,targetControlX:u,targetControlY:m});return[`M${e},${t} C${a},${l} ${u},${m} ${s},${o}`,d,c,f,p]}function fo({sourceX:e,sourceY:t,targetX:n,targetY:s}){const o=Math.abs(n-e)/2,r=n<e?n+o:n-o,i=Math.abs(s-t)/2,a=s<t?s+i:s-i;return[r,a,o,i]}function Kr({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s,elevateOnSelect:o=!1}){if(s!==void 0)return s;const r=o&&n?1e3:0,i=Math.max(e.parentId||o&&e.selected?e.internals.z:0,t.parentId||o&&t.selected?t.internals.z:0);return r+i}function Zr({sourceNode:e,targetNode:t,width:n,height:s,transform:o}){const r=at(ot(e),ot(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:s/o[2]};return Be(i,ct(r))>0}const Ur=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,Qr=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),go=(e,t)=>{if(!e.source||!e.target)return t;let n;return Jn(e)?n={...e}:n={...e,id:Ur(e)},Qr(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function ho({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[o,r,i,a]=fo({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,o,r,i,a]}const ln={[W.Left]:{x:-1,y:0},[W.Right]:{x:1,y:0},[W.Top]:{x:0,y:-1},[W.Bottom]:{x:0,y:1}},Jr=({source:e,sourcePosition:t=W.Bottom,target:n})=>t===W.Left||t===W.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},dn=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function ei({source:e,sourcePosition:t=W.Bottom,target:n,targetPosition:s=W.Top,center:o,offset:r,stepPosition:i}){const a=ln[t],l=ln[s],u={x:e.x+a.x*r,y:e.y+a.y*r},m={x:n.x+l.x*r,y:n.y+l.y*r},d=Jr({source:u,sourcePosition:t,target:m}),c=d.x!==0?"x":"y",f=d[c];let p=[],x,w;const y={x:0,y:0},v={x:0,y:0},[,,h,b]=fo({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[c]*l[c]===-1){c==="x"?(x=o.x??u.x+(m.x-u.x)*i,w=o.y??(u.y+m.y)/2):(x=o.x??(u.x+m.x)/2,w=o.y??u.y+(m.y-u.y)*i);const E=[{x,y:u.y},{x,y:m.y}],C=[{x:u.x,y:w},{x:m.x,y:w}];a[c]===f?p=c==="x"?E:C:p=c==="x"?C:E}else{const E=[{x:u.x,y:m.y}],C=[{x:m.x,y:u.y}];if(c==="x"?p=a.x===f?C:E:p=a.y===f?E:C,t===s){const k=Math.abs(e[c]-n[c]);if(k<=r){const A=Math.min(r-1,r-k);a[c]===f?y[c]=(u[c]>e[c]?-1:1)*A:v[c]=(m[c]>n[c]?-1:1)*A}}if(t!==s){const k=c==="x"?"y":"x",A=a[c]===l[k],D=u[k]>m[k],L=u[k]<m[k];(a[c]===1&&(!A&&D||A&&L)||a[c]!==1&&(!A&&L||A&&D))&&(p=c==="x"?E:C)}const P={x:u.x+y.x,y:u.y+y.y},M={x:m.x+v.x,y:m.y+v.y},O=Math.max(Math.abs(P.x-p[0].x),Math.abs(M.x-p[0].x)),T=Math.max(Math.abs(P.y-p[0].y),Math.abs(M.y-p[0].y));O>=T?(x=(P.x+M.x)/2,w=p[0].y):(x=p[0].x,w=(P.y+M.y)/2)}return[[e,{x:u.x+y.x,y:u.y+y.y},...p,{x:m.x+v.x,y:m.y+v.y},n],x,w,h,b]}function ti(e,t,n,s){const o=Math.min(dn(e,t)/2,dn(t,n)/2,s),{x:r,y:i}=t;if(e.x===r&&r===n.x||e.y===i&&i===n.y)return`L${r} ${i}`;if(e.y===i){const u=e.x<n.x?-1:1,m=e.y<n.y?1:-1;return`L ${r+o*u},${i}Q ${r},${i} ${r},${i+o*m}`}const a=e.x<n.x?1:-1,l=e.y<n.y?-1:1;return`L ${r},${i+o*l}Q ${r},${i} ${r+o*a},${i}`}function kt({sourceX:e,sourceY:t,sourcePosition:n=W.Bottom,targetX:s,targetY:o,targetPosition:r=W.Top,borderRadius:i=5,centerX:a,centerY:l,offset:u=20,stepPosition:m=.5}){const[d,c,f,p,x]=ei({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:o},targetPosition:r,center:{x:a,y:l},offset:u,stepPosition:m});return[d.reduce((y,v,h)=>{let b="";return h>0&&h<d.length-1?b=ti(d[h-1],v,d[h+1],i):b=`${h===0?"M":"L"}${v.x} ${v.y}`,y+=b,y},""),c,f,p,x]}function un(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function ni(e){var d;const{sourceNode:t,targetNode:n}=e;if(!un(t)||!un(n))return null;const s=t.internals.handleBounds||fn(t.handles),o=n.internals.handleBounds||fn(n.handles),r=gn((s==null?void 0:s.source)??[],e.sourceHandle),i=gn(e.connectionMode===Se.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),e.targetHandle);if(!r||!i)return(d=e.onError)==null||d.call(e,"008",le.error008(r?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(r==null?void 0:r.position)||W.Bottom,l=(i==null?void 0:i.position)||W.Top,u=Ve(t,r,a),m=Ve(n,i,l);return{sourceX:u.x,sourceY:u.y,targetX:m.x,targetY:m.y,sourcePosition:a,targetPosition:l}}function fn(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function Ve(e,t,n=W.Left,s=!1){const o=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??fe(e);if(s)return{x:o+i/2,y:r+a/2};switch((t==null?void 0:t.position)??n){case W.Top:return{x:o+i/2,y:r};case W.Right:return{x:o+i,y:r+a/2};case W.Bottom:return{x:o+i/2,y:r+a};case W.Left:return{x:o,y:r+a/2}}}function gn(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Mt(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function oi(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:o}){const r=new Set;return e.reduce((i,a)=>([a.markerStart||s,a.markerEnd||o].forEach(l=>{if(l&&typeof l=="object"){const u=Mt(l,t);r.has(u)||(i.push({id:u,color:l.color||n,...l}),r.add(u))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const po=1e3,si=10,Ht={nodeOrigin:[0,0],nodeExtent:He,elevateNodesOnSelect:!0,defaults:{}},ri={...Ht,checkEquality:!0};function zt(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function ii(e,t,n){const s=zt(Ht,n);for(const o of e.values())if(o.parentId)Bt(o,e,t,s);else{const r=Oe(o,s.nodeOrigin),i=je(o.extent)?o.extent:s.nodeExtent,a=we(r,i,fe(o));o.internals.positionAbsolute=a}}function ai(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const o of e.handles){const r={id:o.id,width:o.width??1,height:o.height??1,nodeId:e.id,x:o.x,y:o.y,position:o.position,type:o.type};o.type==="source"?n.push(r):o.type==="target"&&s.push(r)}return{source:n,target:s}}function jt(e,t,n,s){var u,m;const o=zt(ri,s);let r={i:-1},i=e.length>0;const a=new Map(t),l=o!=null&&o.elevateNodesOnSelect?po:0;t.clear(),n.clear();for(const d of e){let c=a.get(d.id);if(o.checkEquality&&d===(c==null?void 0:c.internals.userNode))t.set(d.id,c);else{const f=Oe(d,o.nodeOrigin),p=je(d.extent)?d.extent:o.nodeExtent,x=we(f,p,fe(d));c={...o.defaults,...d,measured:{width:(u=d.measured)==null?void 0:u.width,height:(m=d.measured)==null?void 0:m.height},internals:{positionAbsolute:x,handleBounds:ai(d,c),z:mo(d,l),userNode:d}},t.set(d.id,c)}(c.measured===void 0||c.measured.width===void 0||c.measured.height===void 0)&&!c.hidden&&(i=!1),d.parentId&&Bt(c,t,n,s,r)}return i}function ci(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Bt(e,t,n,s,o){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a}=zt(Ht,s),l=e.parentId,u=t.get(l);if(!u){console.warn(`Parent node ${l} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}ci(e,n),o&&!u.parentId&&u.internals.rootParentIndex===void 0&&(u.internals.rootParentIndex=++o.i,u.internals.z=u.internals.z+o.i*si),o&&u.internals.rootParentIndex!==void 0&&(o.i=u.internals.rootParentIndex);const m=r?po:0,{x:d,y:c,z:f}=li(e,u,i,a,m),{positionAbsolute:p}=e.internals,x=d!==p.x||c!==p.y;(x||f!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:x?{x:d,y:c}:p,z:f}})}function mo(e,t){return(ae(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function li(e,t,n,s,o){const{x:r,y:i}=t.internals.positionAbsolute,a=fe(e),l=Oe(e,n),u=je(e.extent)?we(l,e.extent,a):l;let m=we({x:r+u.x,y:i+u.y},s,a);e.extent==="parent"&&(m=to(m,a,t));const d=mo(e,o),c=t.internals.z??0;return{x:m.x,y:m.y,z:c>=d?c+1:d}}function Rt(e,t,n,s=[0,0]){var i;const o=[],r=new Map;for(const a of e){const l=t.get(a.parentId);if(!l)continue;const u=((i=r.get(a.parentId))==null?void 0:i.expandedRect)??Me(l),m=oo(u,a.rect);r.set(a.parentId,{expandedRect:m,parent:l})}return r.size>0&&r.forEach(({expandedRect:a,parent:l},u)=>{var h;const m=l.internals.positionAbsolute,d=fe(l),c=l.origin??s,f=a.x<m.x?Math.round(Math.abs(m.x-a.x)):0,p=a.y<m.y?Math.round(Math.abs(m.y-a.y)):0,x=Math.max(d.width,Math.round(a.width)),w=Math.max(d.height,Math.round(a.height)),y=(x-d.width)*c[0],v=(w-d.height)*c[1];(f>0||p>0||y||v)&&(o.push({id:u,type:"position",position:{x:l.position.x-f+y,y:l.position.y-p+v}}),(h=n.get(u))==null||h.forEach(b=>{e.some(S=>S.id===b.id)||o.push({id:b.id,type:"position",position:{x:b.position.x+f,y:b.position.y+p}})})),(d.width<a.width||d.height<a.height||f||p)&&o.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:x+(f?c[0]*f-y:0),height:w+(p?c[1]*p-v:0)}})}),o}function di(e,t,n,s,o,r){const i=s==null?void 0:s.querySelector(".xyflow__viewport");let a=!1;if(!i)return{changes:[],updatedInternals:a};const l=[],u=window.getComputedStyle(i),{m22:m}=new window.DOMMatrixReadOnly(u.transform),d=[];for(const c of e.values()){const f=t.get(c.id);if(!f)continue;if(f.hidden){t.set(f.id,{...f,internals:{...f.internals,handleBounds:void 0}}),a=!0;continue}const p=Tt(c.nodeElement),x=f.measured.width!==p.width||f.measured.height!==p.height;if(!!(p.width&&p.height&&(x||!f.internals.handleBounds||c.force))){const y=c.nodeElement.getBoundingClientRect(),v=je(f.extent)?f.extent:r;let{positionAbsolute:h}=f.internals;f.parentId&&f.extent==="parent"?h=to(h,p,t.get(f.parentId)):v&&(h=we(h,v,p));const b={...f,measured:p,internals:{...f.internals,positionAbsolute:h,handleBounds:{source:an("source",c.nodeElement,y,m,f.id),target:an("target",c.nodeElement,y,m,f.id)}}};t.set(f.id,b),f.parentId&&Bt(b,t,n,{nodeOrigin:o}),a=!0,x&&(l.push({id:f.id,type:"dimensions",dimensions:p}),f.expandParent&&f.parentId&&d.push({id:f.id,parentId:f.parentId,rect:Me(b,o)}))}}if(d.length>0){const c=Rt(d,t,n,o);l.push(...c)}return{changes:l,updatedInternals:a}}async function ui({delta:e,panZoom:t,transform:n,translateExtent:s,width:o,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[o,r]],s),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function hn(e,t,n,s,o,r){let i=o;const a=s.get(i)||new Map;s.set(i,a.set(n,t)),i=`${o}-${e}`;const l=s.get(i)||new Map;if(s.set(i,l.set(n,t)),r){i=`${o}-${e}-${r}`;const u=s.get(i)||new Map;s.set(i,u.set(n,t))}}function xo(e,t,n){e.clear(),t.clear();for(const s of n){const{source:o,target:r,sourceHandle:i=null,targetHandle:a=null}=s,l={edgeId:s.id,source:o,target:r,sourceHandle:i,targetHandle:a},u=`${o}-${i}--${r}-${a}`,m=`${r}-${a}--${o}-${i}`;hn("source",l,m,e,o,i),hn("target",l,u,e,r,a),t.set(s.id,s)}}function yo(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:yo(n,t):!1}function pn(e,t,n){var o;let s=e;do{if((o=s==null?void 0:s.matches)!=null&&o.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function fi(e,t,n,s){const o=new Map;for(const[r,i]of e)if((i.selected||i.id===s)&&(!i.parentId||!yo(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(r);a&&o.set(r,{id:r,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return o}function yt({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var i,a,l;const o=[];for(const[u,m]of t){const d=(i=n.get(u))==null?void 0:i.internals.userNode;d&&o.push({...d,position:m.position,dragging:s})}if(!e)return[o[0],o];const r=(a=n.get(e))==null?void 0:a.internals.userNode;return[r?{...r,position:((l=t.get(e))==null?void 0:l.position)||r.position,dragging:s}:o[0],o]}function gi({dragItems:e,snapGrid:t,x:n,y:s}){const o=e.values().next().value;if(!o)return null;const r={x:n-o.distance.x,y:s-o.distance.y},i=We(r,t);return{x:i.x-r.x,y:i.y-r.y}}function hi({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:o}){let r={x:null,y:null},i=0,a=new Map,l=!1,u={x:0,y:0},m=null,d=!1,c=null,f=!1,p=!1,x=null;function w({noDragClassName:v,handleSelector:h,domNode:b,isSelectable:S,nodeId:E,nodeClickDistance:C=0}){c=it(b);function P({x:k,y:A}){const{nodeLookup:D,nodeExtent:L,snapGrid:z,snapToGrid:_,nodeOrigin:j,onNodeDrag:I,onSelectionDrag:R,onError:V,updateNodePositions:H}=t();r={x:k,y:A};let X=!1;const $=a.size>1,B=$&&L?St(Ye(a)):null,Y=$&&_?gi({dragItems:a,snapGrid:z,x:k,y:A}):null;for(const[G,F]of a){if(!D.has(G))continue;let K={x:k-F.distance.x,y:A-F.distance.y};_&&(K=Y?{x:Math.round(K.x+Y.x),y:Math.round(K.y+Y.y)}:We(K,z));let Q=null;if($&&L&&!F.extent&&B){const{positionAbsolute:q}=F.internals,J=q.x-B.x+L[0][0],te=q.x+F.measured.width-B.x2+L[1][0],ne=q.y-B.y+L[0][1],ie=q.y+F.measured.height-B.y2+L[1][1];Q=[[J,ne],[te,ie]]}const{position:U,positionAbsolute:Z}=eo({nodeId:G,nextPosition:K,nodeLookup:D,nodeExtent:Q||L,nodeOrigin:j,onError:V});X=X||F.position.x!==U.x||F.position.y!==U.y,F.position=U,F.internals.positionAbsolute=Z}if(p=p||X,!!X&&(H(a,!0),x&&(s||I||!E&&R))){const[G,F]=yt({nodeId:E,dragItems:a,nodeLookup:D});s==null||s(x,a,G,F),I==null||I(x,G,F),E||R==null||R(x,F)}}async function M(){if(!m)return;const{transform:k,panBy:A,autoPanSpeed:D,autoPanOnNodeDrag:L}=t();if(!L){l=!1,cancelAnimationFrame(i);return}const[z,_]=no(u,m,D);(z!==0||_!==0)&&(r.x=(r.x??0)-z/k[2],r.y=(r.y??0)-_/k[2],await A({x:z,y:_})&&P(r)),i=requestAnimationFrame(M)}function O(k){var $;const{nodeLookup:A,multiSelectionActive:D,nodesDraggable:L,transform:z,snapGrid:_,snapToGrid:j,selectNodesOnDrag:I,onNodeDragStart:R,onSelectionDragStart:V,unselectNodesAndEdges:H}=t();d=!0,(!I||!S)&&!D&&E&&(($=A.get(E))!=null&&$.selected||H()),S&&I&&E&&(e==null||e(E));const X=_e(k.sourceEvent,{transform:z,snapGrid:_,snapToGrid:j,containerBounds:m});if(r=X,a=fi(A,L,X,E),a.size>0&&(n||R||!E&&V)){const[B,Y]=yt({nodeId:E,dragItems:a,nodeLookup:A});n==null||n(k.sourceEvent,a,B,Y),R==null||R(k.sourceEvent,B,Y),E||V==null||V(k.sourceEvent,Y)}}const T=Xn().clickDistance(C).on("start",k=>{const{domNode:A,nodeDragThreshold:D,transform:L,snapGrid:z,snapToGrid:_}=t();m=(A==null?void 0:A.getBoundingClientRect())||null,f=!1,p=!1,x=k.sourceEvent,D===0&&O(k),r=_e(k.sourceEvent,{transform:L,snapGrid:z,snapToGrid:_,containerBounds:m}),u=ce(k.sourceEvent,m)}).on("drag",k=>{const{autoPanOnNodeDrag:A,transform:D,snapGrid:L,snapToGrid:z,nodeDragThreshold:_,nodeLookup:j}=t(),I=_e(k.sourceEvent,{transform:D,snapGrid:L,snapToGrid:z,containerBounds:m});if(x=k.sourceEvent,(k.sourceEvent.type==="touchmove"&&k.sourceEvent.touches.length>1||E&&!j.has(E))&&(f=!0),!f){if(!l&&A&&d&&(l=!0,M()),!d){const R=ce(k.sourceEvent,m),V=R.x-u.x,H=R.y-u.y;Math.sqrt(V*V+H*H)>_&&O(k)}(r.x!==I.xSnapped||r.y!==I.ySnapped)&&a&&d&&(u=ce(k.sourceEvent,m),P(I))}}).on("end",k=>{if(!(!d||f)&&(l=!1,d=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:A,updateNodePositions:D,onNodeDragStop:L,onSelectionDragStop:z}=t();if(p&&(D(a,!1),p=!1),o||L||!E&&z){const[_,j]=yt({nodeId:E,dragItems:a,nodeLookup:A,dragging:!1});o==null||o(k.sourceEvent,a,_,j),L==null||L(k.sourceEvent,_,j),E||z==null||z(k.sourceEvent,j)}}}).filter(k=>{const A=k.target;return!k.button&&(!v||!pn(A,`.${v}`,b))&&(!h||pn(A,h,b))});c.call(T)}function y(){c==null||c.on(".drag",null)}return{update:w,destroy:y}}function pi(e,t,n){const s=[],o={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const r of t.values())Be(o,Me(r))>0&&s.push(r);return s}const mi=250;function xi(e,t,n,s){var a,l;let o=[],r=1/0;const i=pi(e,n,t+mi);for(const u of i){const m=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((l=u.internals.handleBounds)==null?void 0:l.target)??[]];for(const d of m){if(s.nodeId===d.nodeId&&s.type===d.type&&s.id===d.id)continue;const{x:c,y:f}=Ve(u,d,d.position,!0),p=Math.sqrt(Math.pow(c-e.x,2)+Math.pow(f-e.y,2));p>t||(p<r?(o=[{...d,x:c,y:f}],r=p):p===r&&o.push({...d,x:c,y:f}))}}if(!o.length)return null;if(o.length>1){const u=s.type==="source"?"target":"source";return o.find(m=>m.type===u)??o[0]}return o[0]}function wo(e,t,n,s,o,r=!1){var u,m,d;const i=s.get(e);if(!i)return null;const a=o==="strict"?(u=i.internals.handleBounds)==null?void 0:u[t]:[...((m=i.internals.handleBounds)==null?void 0:m.source)??[],...((d=i.internals.handleBounds)==null?void 0:d.target)??[]],l=(n?a==null?void 0:a.find(c=>c.id===n):a==null?void 0:a[0])??null;return l&&r?{...l,...Ve(i,l,l.position,!0)}:l}function bo(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function yi(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const vo=()=>!0;function wi(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:o,edgeUpdaterType:r,isTarget:i,domNode:a,nodeLookup:l,lib:u,autoPanOnConnect:m,flowId:d,panBy:c,cancelConnection:f,onConnectStart:p,onConnect:x,onConnectEnd:w,isValidConnection:y=vo,onReconnectEnd:v,updateConnection:h,getTransform:b,getFromHandle:S,autoPanSpeed:E,dragThreshold:C=1,handleDomNode:P}){const M=io(e.target);let O=0,T;const{x:k,y:A}=ce(e),D=bo(r,P),L=a==null?void 0:a.getBoundingClientRect();let z=!1;if(!L||!D)return;const _=wo(o,D,s,l,t);if(!_)return;let j=ce(e,L),I=!1,R=null,V=!1,H=null;function X(){if(!m||!L)return;const[U,Z]=no(j,L,E);c({x:U,y:Z}),O=requestAnimationFrame(X)}const $={..._,nodeId:o,type:D,position:_.position},B=l.get(o);let G={inProgress:!0,isValid:null,from:Ve(B,$,W.Left,!0),fromHandle:$,fromPosition:$.position,fromNode:B,to:j,toHandle:null,toPosition:nn[$.position],toNode:null};function F(){z=!0,h(G),p==null||p(e,{nodeId:o,handleId:s,handleType:D})}C===0&&F();function K(U){if(!z){const{x:te,y:ne}=ce(U),ie=te-k,de=ne-A;if(!(ie*ie+de*de>C*C))return;F()}if(!S()||!$){Q(U);return}const Z=b();j=ce(U,L),T=xi(Xe(j,Z,!1,[1,1]),n,l,$),I||(X(),I=!0);const q=No(U,{handle:T,connectionMode:t,fromNodeId:o,fromHandleId:s,fromType:i?"target":"source",isValidConnection:y,doc:M,lib:u,flowId:d,nodeLookup:l});H=q.handleDomNode,R=q.connection,V=yi(!!T,q.isValid);const J={...G,isValid:V,to:q.toHandle&&V?st({x:q.toHandle.x,y:q.toHandle.y},Z):j,toHandle:q.toHandle,toPosition:V&&q.toHandle?q.toHandle.position:nn[$.position],toNode:q.toHandle?l.get(q.toHandle.nodeId):null};V&&T&&G.toHandle&&J.toHandle&&G.toHandle.type===J.toHandle.type&&G.toHandle.nodeId===J.toHandle.nodeId&&G.toHandle.id===J.toHandle.id&&G.to.x===J.to.x&&G.to.y===J.to.y||(h(J),G=J)}function Q(U){if(!("touches"in U&&U.touches.length>0)){if(z){(T||H)&&R&&V&&(x==null||x(R));const{inProgress:Z,...q}=G,J={...q,toPosition:G.toHandle?G.toPosition:null};w==null||w(U,J),r&&(v==null||v(U,J))}f(),cancelAnimationFrame(O),I=!1,V=!1,R=null,H=null,M.removeEventListener("mousemove",K),M.removeEventListener("mouseup",Q),M.removeEventListener("touchmove",K),M.removeEventListener("touchend",Q)}}M.addEventListener("mousemove",K),M.addEventListener("mouseup",Q),M.addEventListener("touchmove",K),M.addEventListener("touchend",Q)}function No(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:o,fromType:r,doc:i,lib:a,flowId:l,isValidConnection:u=vo,nodeLookup:m}){const d=r==="target",c=t?i.querySelector(`.${a}-flow__handle[data-id="${l}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:f,y:p}=ce(e),x=i.elementFromPoint(f,p),w=x!=null&&x.classList.contains(`${a}-flow__handle`)?x:c,y={handleDomNode:w,isValid:!1,connection:null,toHandle:null};if(w){const v=bo(void 0,w),h=w.getAttribute("data-nodeid"),b=w.getAttribute("data-handleid"),S=w.classList.contains("connectable"),E=w.classList.contains("connectableend");if(!h||!v)return y;const C={source:d?h:s,sourceHandle:d?b:o,target:d?s:h,targetHandle:d?o:b};y.connection=C;const M=S&&E&&(n===Se.Strict?d&&v==="source"||!d&&v==="target":h!==s||b!==o);y.isValid=M&&u(C),y.toHandle=wo(h,v,b,m,n,!0)}return y}const It={onPointerDown:wi,isValid:No};function bi({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const o=it(e);function r({translateExtent:a,width:l,height:u,zoomStep:m=1,pannable:d=!0,zoomable:c=!0,inversePan:f=!1}){const p=h=>{if(h.sourceEvent.type!=="wheel"||!t)return;const b=n(),S=h.sourceEvent.ctrlKey&&Re()?10:1,E=-h.sourceEvent.deltaY*(h.sourceEvent.deltaMode===1?.05:h.sourceEvent.deltaMode?1:.002)*m,C=b[2]*Math.pow(2,E*S);t.scaleTo(C)};let x=[0,0];const w=h=>{(h.sourceEvent.type==="mousedown"||h.sourceEvent.type==="touchstart")&&(x=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY])},y=h=>{const b=n();if(h.sourceEvent.type!=="mousemove"&&h.sourceEvent.type!=="touchmove"||!t)return;const S=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY],E=[S[0]-x[0],S[1]-x[1]];x=S;const C=s()*Math.max(b[2],Math.log(b[2]))*(f?-1:1),P={x:b[0]-E[0]*C,y:b[1]-E[1]*C},M=[[0,0],[l,u]];t.setViewportConstrained({x:P.x,y:P.y,zoom:b[2]},M,a)},v=Wn().on("start",w).on("zoom",d?y:null).on("zoom.wheel",c?p:null);o.call(v,{})}function i(){o.on("zoom",null)}return{update:r,destroy:i,pointer:Yn}}const lt=e=>({x:e.x,y:e.y,zoom:e.k}),wt=({x:e,y:t,zoom:n})=>wr.translate(e,t).scale(n),Ee=(e,t)=>e.target.closest(`.${t}`),Eo=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),vi=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,bt=(e,t=0,n=vi,s=()=>{})=>{const o=typeof t=="number"&&t>0;return o||s(),o?e.transition().duration(t).ease(n).on("end",s):e},Co=e=>{const t=e.ctrlKey&&Re()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Ni({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:o,panOnScrollSpeed:r,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:u}){return m=>{if(Ee(m,t))return m.ctrlKey&&m.preventDefault(),!1;m.preventDefault(),m.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(m.ctrlKey&&i){const w=Yn(m),y=Co(m),v=d*Math.pow(2,y);s.scaleTo(n,v,w,m);return}const c=m.deltaMode===1?20:1;let f=o===ye.Vertical?0:m.deltaX*c,p=o===ye.Horizontal?0:m.deltaY*c;!Re()&&m.shiftKey&&o!==ye.Vertical&&(f=m.deltaY*c,p=0),s.translateBy(n,-(f/d)*r,-(p/d)*r,{internal:!0});const x=lt(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(l==null||l(m,x),e.panScrollTimeout=setTimeout(()=>{u==null||u(m,x),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a==null||a(m,x))}}function Ei({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,o){const r=s.type==="wheel",i=!t&&r&&!s.ctrlKey,a=Ee(s,e);if(s.ctrlKey&&r&&a&&s.preventDefault(),i||a)return null;s.preventDefault(),n.call(this,s,o)}}function Ci({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var r,i,a;if((r=s.sourceEvent)!=null&&r.internal)return;const o=lt(s.transform);e.mouseButton=((i=s.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=o,((a=s.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,o))}}function Si({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:o}){return r=>{var i,a;e.usedRightMouseButton=!!(n&&Eo(t,e.mouseButton??0)),(i=r.sourceEvent)!=null&&i.sync||s([r.transform.x,r.transform.y,r.transform.k]),o&&!((a=r.sourceEvent)!=null&&a.internal)&&(o==null||o(r.sourceEvent,lt(r.transform)))}}function ki({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:o,onPaneContextMenu:r}){return i=>{var a;if(!((a=i.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,r&&Eo(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&r(i.sourceEvent),e.usedRightMouseButton=!1,s(!1),o)){const l=lt(i.transform);e.prevViewport=l,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{o==null||o(i.sourceEvent,l)},n?150:0)}}}function Mi({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:o,zoomOnDoubleClick:r,userSelectionActive:i,noWheelClassName:a,noPanClassName:l,lib:u,connectionInProgress:m}){return d=>{var w;const c=e||t,f=n&&d.ctrlKey,p=d.type==="wheel";if(d.button===1&&d.type==="mousedown"&&(Ee(d,`${u}-flow__node`)||Ee(d,`${u}-flow__edge`)))return!0;if(!s&&!c&&!o&&!r&&!n||i||m&&!p||Ee(d,a)&&p||Ee(d,l)&&(!p||o&&p&&!e)||!n&&d.ctrlKey&&p)return!1;if(!n&&d.type==="touchstart"&&((w=d.touches)==null?void 0:w.length)>1)return d.preventDefault(),!1;if(!c&&!o&&!f&&p||!s&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(s)&&!s.includes(d.button)&&d.type==="mousedown")return!1;const x=Array.isArray(s)&&s.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||p)&&x}}function ji({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:s,translateExtent:o,viewport:r,onPanZoom:i,onPanZoomStart:a,onPanZoomEnd:l,onDraggingChange:u}){const m={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),c=Wn().clickDistance(!ae(s)||s<0?0:s).scaleExtent([t,n]).translateExtent(o),f=it(e).call(c);h({x:r.x,y:r.y,zoom:ke(r.zoom,t,n)},[[0,0],[d.width,d.height]],o);const p=f.on("wheel.zoom"),x=f.on("dblclick.zoom");c.wheelDelta(Co);function w(k,A){return f?new Promise(D=>{c==null||c.interpolate((A==null?void 0:A.interpolate)==="linear"?De:xt).transform(bt(f,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>D(!0)),k)}):Promise.resolve(!1)}function y({noWheelClassName:k,noPanClassName:A,onPaneContextMenu:D,userSelectionActive:L,panOnScroll:z,panOnDrag:_,panOnScrollMode:j,panOnScrollSpeed:I,preventScrolling:R,zoomOnPinch:V,zoomOnScroll:H,zoomOnDoubleClick:X,zoomActivationKeyPressed:$,lib:B,onTransformChange:Y,connectionInProgress:G}){L&&!m.isZoomingOrPanning&&v();const K=z&&!$&&!L?Ni({zoomPanValues:m,noWheelClassName:k,d3Selection:f,d3Zoom:c,panOnScrollMode:j,panOnScrollSpeed:I,zoomOnPinch:V,onPanZoomStart:a,onPanZoom:i,onPanZoomEnd:l}):Ei({noWheelClassName:k,preventScrolling:R,d3ZoomHandler:p});if(f.on("wheel.zoom",K,{passive:!1}),!L){const U=Ci({zoomPanValues:m,onDraggingChange:u,onPanZoomStart:a});c.on("start",U);const Z=Si({zoomPanValues:m,panOnDrag:_,onPaneContextMenu:!!D,onPanZoom:i,onTransformChange:Y});c.on("zoom",Z);const q=ki({zoomPanValues:m,panOnDrag:_,panOnScroll:z,onPaneContextMenu:D,onPanZoomEnd:l,onDraggingChange:u});c.on("end",q)}const Q=Mi({zoomActivationKeyPressed:$,panOnDrag:_,zoomOnScroll:H,panOnScroll:z,zoomOnDoubleClick:X,zoomOnPinch:V,userSelectionActive:L,noPanClassName:A,noWheelClassName:k,lib:B,connectionInProgress:G});c.filter(Q),X?f.on("dblclick.zoom",x):f.on("dblclick.zoom",null)}function v(){c.on("zoom",null)}async function h(k,A,D){const L=wt(k),z=c==null?void 0:c.constrain()(L,A,D);return z&&await w(z),new Promise(_=>_(z))}async function b(k,A){const D=wt(k);return await w(D,A),new Promise(L=>L(D))}function S(k){if(f){const A=wt(k),D=f.property("__zoom");(D.k!==k.zoom||D.x!==k.x||D.y!==k.y)&&(c==null||c.transform(f,A,null,{sync:!0}))}}function E(){const k=f?br(f.node()):{x:0,y:0,k:1};return{x:k.x,y:k.y,zoom:k.k}}function C(k,A){return f?new Promise(D=>{c==null||c.interpolate((A==null?void 0:A.interpolate)==="linear"?De:xt).scaleTo(bt(f,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>D(!0)),k)}):Promise.resolve(!1)}function P(k,A){return f?new Promise(D=>{c==null||c.interpolate((A==null?void 0:A.interpolate)==="linear"?De:xt).scaleBy(bt(f,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>D(!0)),k)}):Promise.resolve(!1)}function M(k){c==null||c.scaleExtent(k)}function O(k){c==null||c.translateExtent(k)}function T(k){const A=!ae(k)||k<0?0:k;c==null||c.clickDistance(A)}return{update:y,destroy:v,setViewport:b,setViewportConstrained:h,getViewport:E,scaleTo:C,scaleBy:P,setScaleExtent:M,setTranslateExtent:O,syncViewport:S,setClickDistance:T}}var be;(function(e){e.Line="line",e.Handle="handle"})(be||(be={}));const Ii=["top-left","top-right","bottom-left","bottom-right"],Pi=["top","right","bottom","left"];function Ai({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:o,affectsY:r}){const i=e-t,a=n-s,l=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&o&&(l[0]=l[0]*-1),a&&r&&(l[1]=l[1]*-1),l}function mn(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),o=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:o}}function ge(e,t){return Math.max(0,t-e)}function he(e,t){return Math.max(0,e-t)}function Je(e,t,n){return Math.max(0,t-e,e-n)}function xn(e,t){return e?!t:t}function $i(e,t,n,s,o,r,i,a){let{affectsX:l,affectsY:u}=t;const{isHorizontal:m,isVertical:d}=t,c=m&&d,{xSnapped:f,ySnapped:p}=n,{minWidth:x,maxWidth:w,minHeight:y,maxHeight:v}=s,{x:h,y:b,width:S,height:E,aspectRatio:C}=e;let P=Math.floor(m?f-e.pointerX:0),M=Math.floor(d?p-e.pointerY:0);const O=S+(l?-P:P),T=E+(u?-M:M),k=-r[0]*S,A=-r[1]*E;let D=Je(O,x,w),L=Je(T,y,v);if(i){let j=0,I=0;l&&P<0?j=ge(h+P+k,i[0][0]):!l&&P>0&&(j=he(h+O+k,i[1][0])),u&&M<0?I=ge(b+M+A,i[0][1]):!u&&M>0&&(I=he(b+T+A,i[1][1])),D=Math.max(D,j),L=Math.max(L,I)}if(a){let j=0,I=0;l&&P>0?j=he(h+P,a[0][0]):!l&&P<0&&(j=ge(h+O,a[1][0])),u&&M>0?I=he(b+M,a[0][1]):!u&&M<0&&(I=ge(b+T,a[1][1])),D=Math.max(D,j),L=Math.max(L,I)}if(o){if(m){const j=Je(O/C,y,v)*C;if(D=Math.max(D,j),i){let I=0;!l&&!u||l&&!u&&c?I=he(b+A+O/C,i[1][1])*C:I=ge(b+A+(l?P:-P)/C,i[0][1])*C,D=Math.max(D,I)}if(a){let I=0;!l&&!u||l&&!u&&c?I=ge(b+O/C,a[1][1])*C:I=he(b+(l?P:-P)/C,a[0][1])*C,D=Math.max(D,I)}}if(d){const j=Je(T*C,x,w)/C;if(L=Math.max(L,j),i){let I=0;!l&&!u||u&&!l&&c?I=he(h+T*C+k,i[1][0])/C:I=ge(h+(u?M:-M)*C+k,i[0][0])/C,L=Math.max(L,I)}if(a){let I=0;!l&&!u||u&&!l&&c?I=ge(h+T*C,a[1][0])/C:I=he(h+(u?M:-M)*C,a[0][0])/C,L=Math.max(L,I)}}}M=M+(M<0?L:-L),P=P+(P<0?D:-D),o&&(c?O>T*C?M=(xn(l,u)?-P:P)/C:P=(xn(l,u)?-M:M)*C:m?(M=P/C,u=l):(P=M*C,l=u));const z=l?h+P:h,_=u?b+M:b;return{width:S+(l?-P:P),height:E+(u?-M:M),x:r[0]*P*(l?-1:1)+z,y:r[1]*M*(u?-1:1)+_}}const So={width:0,height:0,x:0,y:0},Li={...So,pointerX:0,pointerY:0,aspectRatio:1};function Di(e){return[[0,0],[e.measured.width,e.measured.height]]}function _i(e,t,n){const s=t.position.x+e.position.x,o=t.position.y+e.position.y,r=e.measured.width??0,i=e.measured.height??0,a=n[0]*r,l=n[1]*i;return[[s-a,o-l],[s+r-a,o+i-l]]}function Ti({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:o}){const r=it(e);let i={controlDirection:mn("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:u,boundaries:m,keepAspectRatio:d,resizeDirection:c,onResizeStart:f,onResize:p,onResizeEnd:x,shouldResize:w}){let y={...So},v={...Li};i={boundaries:m,resizeDirection:c,keepAspectRatio:d,controlDirection:mn(u)};let h,b=null,S=[],E,C,P,M=!1;const O=Xn().on("start",T=>{const{nodeLookup:k,transform:A,snapGrid:D,snapToGrid:L,nodeOrigin:z,paneDomNode:_}=n();if(h=k.get(t),!h)return;b=(_==null?void 0:_.getBoundingClientRect())??null;const{xSnapped:j,ySnapped:I}=_e(T.sourceEvent,{transform:A,snapGrid:D,snapToGrid:L,containerBounds:b});y={width:h.measured.width??0,height:h.measured.height??0,x:h.position.x??0,y:h.position.y??0},v={...y,pointerX:j,pointerY:I,aspectRatio:y.width/y.height},E=void 0,h.parentId&&(h.extent==="parent"||h.expandParent)&&(E=k.get(h.parentId),C=E&&h.extent==="parent"?Di(E):void 0),S=[],P=void 0;for(const[R,V]of k)if(V.parentId===t&&(S.push({id:R,position:{...V.position},extent:V.extent}),V.extent==="parent"||V.expandParent)){const H=_i(V,h,V.origin??z);P?P=[[Math.min(H[0][0],P[0][0]),Math.min(H[0][1],P[0][1])],[Math.max(H[1][0],P[1][0]),Math.max(H[1][1],P[1][1])]]:P=H}f==null||f(T,{...y})}).on("drag",T=>{const{transform:k,snapGrid:A,snapToGrid:D,nodeOrigin:L}=n(),z=_e(T.sourceEvent,{transform:k,snapGrid:A,snapToGrid:D,containerBounds:b}),_=[];if(!h)return;const{x:j,y:I,width:R,height:V}=y,H={},X=h.origin??L,{width:$,height:B,x:Y,y:G}=$i(v,i.controlDirection,z,i.boundaries,i.keepAspectRatio,X,C,P),F=$!==R,K=B!==V,Q=Y!==j&&F,U=G!==I&&K;if(!Q&&!U&&!F&&!K)return;if((Q||U||X[0]===1||X[1]===1)&&(H.x=Q?Y:y.x,H.y=U?G:y.y,y.x=H.x,y.y=H.y,S.length>0)){const te=Y-j,ne=G-I;for(const ie of S)ie.position={x:ie.position.x-te+X[0]*($-R),y:ie.position.y-ne+X[1]*(B-V)},_.push(ie)}if((F||K)&&(H.width=F&&(!i.resizeDirection||i.resizeDirection==="horizontal")?$:y.width,H.height=K&&(!i.resizeDirection||i.resizeDirection==="vertical")?B:y.height,y.width=H.width,y.height=H.height),E&&h.expandParent){const te=X[0]*(H.width??0);H.x&&H.x<te&&(y.x=te,v.x=v.x-(H.x-te));const ne=X[1]*(H.height??0);H.y&&H.y<ne&&(y.y=ne,v.y=v.y-(H.y-ne))}const Z=Ai({width:y.width,prevWidth:R,height:y.height,prevHeight:V,affectsX:i.controlDirection.affectsX,affectsY:i.controlDirection.affectsY}),q={...y,direction:Z};(w==null?void 0:w(T,q))!==!1&&(M=!0,p==null||p(T,q),s(H,_))}).on("end",T=>{M&&(x==null||x(T,{...y}),o==null||o({...y}),M=!1)});r.call(O)}function l(){r.on(".drag",null)}return{update:a,destroy:l}}const dt=N.createContext(null),Hi=dt.Provider,ko=le.error001();function ee(e,t){const n=N.useContext(dt);if(n===null)throw new Error(ko);return vr(n,e,t)}function oe(){const e=N.useContext(dt);if(e===null)throw new Error(ko);return N.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const yn={display:"none"},zi={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Mo="react-flow__node-desc",jo="react-flow__edge-desc",Bi="react-flow__aria-live",Ri=e=>e.ariaLiveMessage,Vi=e=>e.ariaLabelConfig;function Fi({rfId:e}){const t=ee(Ri);return g.jsx("div",{id:`${Bi}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:zi,children:t})}function Oi({rfId:e,disableKeyboardA11y:t}){const n=ee(Vi);return g.jsxs(g.Fragment,{children:[g.jsx("div",{id:`${Mo}-${e}`,style:yn,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),g.jsx("div",{id:`${jo}-${e}`,style:yn,children:n["edge.a11yDescription.default"]}),!t&&g.jsx(Fi,{rfId:e})]})}const ut=N.forwardRef(({position:e="top-left",children:t,className:n,style:s,...o},r)=>{const i=`${e}`.split("-");return g.jsx("div",{className:re(["react-flow__panel",n,...i]),style:s,ref:r,...o,children:t})});ut.displayName="Panel";function Yi({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:g.jsx(ut,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:g.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Wi=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},et=e=>e.id;function Xi(e,t){return se(e.selectedNodes.map(et),t.selectedNodes.map(et))&&se(e.selectedEdges.map(et),t.selectedEdges.map(et))}function Gi({onSelectionChange:e}){const t=oe(),{selectedNodes:n,selectedEdges:s}=ee(Wi,Xi);return N.useEffect(()=>{const o={nodes:n,edges:s};e==null||e(o),t.getState().onSelectionChangeHandlers.forEach(r=>r(o))},[n,s,e]),null}const qi=e=>!!e.onSelectionChangeHandlers;function Ki({onSelectionChange:e}){const t=ee(qi);return e||t?g.jsx(Gi,{onSelectionChange:e}):null}const Io=[0,0],Zi={x:0,y:0,zoom:1},Ui=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],wn=[...Ui,"rfId"],Qi=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),bn={translateExtent:He,nodeOrigin:Io,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function Ji(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:o,setTranslateExtent:r,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:l,setPaneClickDistance:u}=ee(Qi,se),m=oe();N.useEffect(()=>(l(e.defaultNodes,e.defaultEdges),()=>{d.current=bn,a()}),[]);const d=N.useRef(bn);return N.useEffect(()=>{for(const c of wn){const f=e[c],p=d.current[c];f!==p&&(typeof e[c]>"u"||(c==="nodes"?t(f):c==="edges"?n(f):c==="minZoom"?s(f):c==="maxZoom"?o(f):c==="translateExtent"?r(f):c==="nodeExtent"?i(f):c==="paneClickDistance"?u(f):c==="ariaLabelConfig"?m.setState({ariaLabelConfig:Gr(f)}):c==="fitView"?m.setState({fitViewQueued:f}):c==="fitViewOptions"?m.setState({fitViewOptions:f}):m.setState({[c]:f})))}d.current=e},wn.map(c=>e[c])),null}function vn(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function ea(e){var s;const[t,n]=N.useState(e==="system"?null:e);return N.useEffect(()=>{if(e!=="system"){n(e);return}const o=vn(),r=()=>n(o!=null&&o.matches?"dark":"light");return r(),o==null||o.addEventListener("change",r),()=>{o==null||o.removeEventListener("change",r)}},[e]),t!==null?t:(s=vn())!=null&&s.matches?"dark":"light"}const Nn=typeof document<"u"?document:null;function Fe(e=null,t={target:Nn,actInsideInputWithModifier:!0}){const[n,s]=N.useState(!1),o=N.useRef(!1),r=N.useRef(new Set([])),[i,a]=N.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),m=u.reduce((d,c)=>d.concat(...c),[]);return[u,m]}return[[],[]]},[e]);return N.useEffect(()=>{const l=(t==null?void 0:t.target)??Nn,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const m=f=>{var w,y;if(o.current=f.ctrlKey||f.metaKey||f.shiftKey||f.altKey,(!o.current||o.current&&!u)&&ao(f))return!1;const x=Cn(f.code,a);if(r.current.add(f[x]),En(i,r.current,!1)){const v=((y=(w=f.composedPath)==null?void 0:w.call(f))==null?void 0:y[0])||f.target,h=(v==null?void 0:v.nodeName)==="BUTTON"||(v==null?void 0:v.nodeName)==="A";t.preventDefault!==!1&&(o.current||!h)&&f.preventDefault(),s(!0)}},d=f=>{const p=Cn(f.code,a);En(i,r.current,!0)?(s(!1),r.current.clear()):r.current.delete(f[p]),f.key==="Meta"&&r.current.clear(),o.current=!1},c=()=>{r.current.clear(),s(!1)};return l==null||l.addEventListener("keydown",m),l==null||l.addEventListener("keyup",d),window.addEventListener("blur",c),window.addEventListener("contextmenu",c),()=>{l==null||l.removeEventListener("keydown",m),l==null||l.removeEventListener("keyup",d),window.removeEventListener("blur",c),window.removeEventListener("contextmenu",c)}}},[e,s]),n}function En(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(o=>t.has(o)))}function Cn(e,t){return t.includes(e)?"code":"key"}const ta=()=>{const e=oe();return N.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,o,r],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??s,y:t.y??o,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:o,minZoom:r,maxZoom:i,panZoom:a}=e.getState(),l=_t(t,s,o,r,i,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(l,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:o,snapToGrid:r,domNode:i}=e.getState();if(!i)return t;const{x:a,y:l}=i.getBoundingClientRect(),u={x:t.x-a,y:t.y-l},m=n.snapGrid??o,d=n.snapToGrid??r;return Xe(u,s,d,m)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:o,y:r}=s.getBoundingClientRect(),i=st(t,n);return{x:i.x+o,y:i.y+r}}}),[])};function Po(e,t){const n=[],s=new Map,o=[];for(const r of e)if(r.type==="add"){o.push(r);continue}else if(r.type==="remove"||r.type==="replace")s.set(r.id,[r]);else{const i=s.get(r.id);i?i.push(r):s.set(r.id,[r])}for(const r of t){const i=s.get(r.id);if(!i){n.push(r);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...r};for(const l of i)na(l,a);n.push(a)}return o.length&&o.forEach(r=>{r.index!==void 0?n.splice(r.index,0,{...r.item}):n.push({...r.item})}),n}function na(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Ao(e,t){return Po(e,t)}function $o(e,t){return Po(e,t)}function xe(e,t){return{id:e,type:"select",selected:t}}function Ce(e,t=new Set,n=!1){const s=[];for(const[o,r]of e){const i=t.has(o);!(r.selected===void 0&&!i)&&r.selected!==i&&(n&&(r.selected=i),s.push(xe(r.id,i)))}return s}function Sn({items:e=[],lookup:t}){var o;const n=[],s=new Map(e.map(r=>[r.id,r]));for(const[r,i]of e.entries()){const a=t.get(i.id),l=((o=a==null?void 0:a.internals)==null?void 0:o.userNode)??a;l!==void 0&&l!==i&&n.push({id:i.id,item:i,type:"replace"}),l===void 0&&n.push({item:i,type:"add",index:r})}for(const[r]of t)s.get(r)===void 0&&n.push({id:r,type:"remove"});return n}function kn(e){return{id:e.id,type:"remove"}}const Mn=e=>Hr(e),oa=e=>Jn(e);function Lo(e){return N.forwardRef(e)}const sa=typeof window<"u"?N.useLayoutEffect:N.useEffect;function jn(e){const[t,n]=N.useState(BigInt(0)),[s]=N.useState(()=>ra(()=>n(o=>o+BigInt(1))));return sa(()=>{const o=s.get();o.length&&(e(o),s.reset())},[t]),s}function ra(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Do=N.createContext(null);function ia({children:e}){const t=oe(),n=N.useCallback(a=>{const{nodes:l=[],setNodes:u,hasDefaultNodes:m,onNodesChange:d,nodeLookup:c,fitViewQueued:f}=t.getState();let p=l;for(const w of a)p=typeof w=="function"?w(p):w;const x=Sn({items:p,lookup:c});m&&u(p),x.length>0?d==null||d(x):f&&window.requestAnimationFrame(()=>{const{fitViewQueued:w,nodes:y,setNodes:v}=t.getState();w&&v(y)})},[]),s=jn(n),o=N.useCallback(a=>{const{edges:l=[],setEdges:u,hasDefaultEdges:m,onEdgesChange:d,edgeLookup:c}=t.getState();let f=l;for(const p of a)f=typeof p=="function"?p(f):p;m?u(f):d&&d(Sn({items:f,lookup:c}))},[]),r=jn(o),i=N.useMemo(()=>({nodeQueue:s,edgeQueue:r}),[]);return g.jsx(Do.Provider,{value:i,children:e})}function aa(){const e=N.useContext(Do);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const ca=e=>!!e.panZoom;function Vt(){const e=ta(),t=oe(),n=aa(),s=ee(ca),o=N.useMemo(()=>{const r=d=>t.getState().nodeLookup.get(d),i=d=>{n.nodeQueue.push(d)},a=d=>{n.edgeQueue.push(d)},l=d=>{var y,v;const{nodeLookup:c,nodeOrigin:f}=t.getState(),p=Mn(d)?d:c.get(d.id),x=p.parentId?ro(p.position,p.measured,p.parentId,c,f):p.position,w={...p,position:x,width:((y=p.measured)==null?void 0:y.width)??p.width,height:((v=p.measured)==null?void 0:v.height)??p.height};return Me(w)},u=(d,c,f={replace:!1})=>{i(p=>p.map(x=>{if(x.id===d){const w=typeof c=="function"?c(x):c;return f.replace&&Mn(w)?w:{...x,...w}}return x}))},m=(d,c,f={replace:!1})=>{a(p=>p.map(x=>{if(x.id===d){const w=typeof c=="function"?c(x):c;return f.replace&&oa(w)?w:{...x,...w}}return x}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var c;return(c=r(d))==null?void 0:c.internals.userNode},getInternalNode:r,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(c=>({...c}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:i,setEdges:a,addNodes:d=>{const c=Array.isArray(d)?d:[d];n.nodeQueue.push(f=>[...f,...c])},addEdges:d=>{const c=Array.isArray(d)?d:[d];n.edgeQueue.push(f=>[...f,...c])},toObject:()=>{const{nodes:d=[],edges:c=[],transform:f}=t.getState(),[p,x,w]=f;return{nodes:d.map(y=>({...y})),edges:c.map(y=>({...y})),viewport:{x:p,y:x,zoom:w}}},deleteElements:async({nodes:d=[],edges:c=[]})=>{const{nodes:f,edges:p,onNodesDelete:x,onEdgesDelete:w,triggerNodeChanges:y,triggerEdgeChanges:v,onDelete:h,onBeforeDelete:b}=t.getState(),{nodes:S,edges:E}=await Fr({nodesToRemove:d,edgesToRemove:c,nodes:f,edges:p,onBeforeDelete:b}),C=E.length>0,P=S.length>0;if(C){const M=E.map(kn);w==null||w(E),v(M)}if(P){const M=S.map(kn);x==null||x(S),y(M)}return(P||C)&&(h==null||h({nodes:S,edges:E})),{deletedNodes:S,deletedEdges:E}},getIntersectingNodes:(d,c=!0,f)=>{const p=sn(d),x=p?d:l(d),w=f!==void 0;return x?(f||t.getState().nodes).filter(y=>{const v=t.getState().nodeLookup.get(y.id);if(v&&!p&&(y.id===d.id||!v.internals.positionAbsolute))return!1;const h=Me(w?y:v),b=Be(h,x);return c&&b>0||b>=h.width*h.height||b>=x.width*x.height}):[]},isNodeIntersecting:(d,c,f=!0)=>{const x=sn(d)?d:l(d);if(!x)return!1;const w=Be(x,c);return f&&w>0||w>=c.width*c.height||w>=x.width*x.height},updateNode:u,updateNodeData:(d,c,f={replace:!1})=>{u(d,p=>{const x=typeof c=="function"?c(p):c;return f.replace?{...p,data:x}:{...p,data:{...p.data,...x}}},f)},updateEdge:m,updateEdgeData:(d,c,f={replace:!1})=>{m(d,p=>{const x=typeof c=="function"?c(p):c;return f.replace?{...p,data:x}:{...p,data:{...p.data,...x}}},f)},getNodesBounds:d=>{const{nodeLookup:c,nodeOrigin:f}=t.getState();return zr(d,{nodeLookup:c,nodeOrigin:f})},getHandleConnections:({type:d,id:c,nodeId:f})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${f}-${d}${c?`-${c}`:""}`))==null?void 0:p.values())??[])},getNodeConnections:({type:d,handleId:c,nodeId:f})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${f}${d?c?`-${d}-${c}`:`-${d}`:""}`))==null?void 0:p.values())??[])},fitView:async d=>{const c=t.getState().fitViewResolver??Xr();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:c}),n.nodeQueue.push(f=>[...f]),c.promise}}},[]);return N.useMemo(()=>({...o,...e,viewportInitialized:s}),[s])}const In=e=>e.selected,la=typeof window<"u"?window:void 0;function da({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=oe(),{deleteElements:s}=Vt(),o=Fe(e,{actInsideInputWithModifier:!1}),r=Fe(t,{target:la});N.useEffect(()=>{if(o){const{edges:i,nodes:a}=n.getState();s({nodes:a.filter(In),edges:i.filter(In)}),n.setState({nodesSelectionActive:!1})}},[o]),N.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}function ua(e){const t=oe();N.useEffect(()=>{const n=()=>{var o,r,i,a;if(!e.current||!(((r=(o=e.current).checkVisibility)==null?void 0:r.call(o))??!0))return!1;const s=Tt(e.current);(s.height===0||s.width===0)&&((a=(i=t.getState()).onError)==null||a.call(i,"004",le.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const ft={position:"absolute",width:"100%",height:"100%",top:0,left:0},fa=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function ga({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:o=.5,panOnScrollMode:r=ye.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:l,translateExtent:u,minZoom:m,maxZoom:d,zoomActivationKeyCode:c,preventScrolling:f=!0,children:p,noWheelClassName:x,noPanClassName:w,onViewportChange:y,isControlledViewport:v,paneClickDistance:h}){const b=oe(),S=N.useRef(null),{userSelectionActive:E,lib:C,connectionInProgress:P}=ee(fa,se),M=Fe(c),O=N.useRef();ua(S);const T=N.useCallback(k=>{y==null||y({x:k[0],y:k[1],zoom:k[2]}),v||b.setState({transform:k})},[y,v]);return N.useEffect(()=>{if(S.current){O.current=ji({domNode:S.current,minZoom:m,maxZoom:d,translateExtent:u,viewport:l,paneClickDistance:h,onDraggingChange:L=>b.setState({paneDragging:L}),onPanZoomStart:(L,z)=>{const{onViewportChangeStart:_,onMoveStart:j}=b.getState();j==null||j(L,z),_==null||_(z)},onPanZoom:(L,z)=>{const{onViewportChange:_,onMove:j}=b.getState();j==null||j(L,z),_==null||_(z)},onPanZoomEnd:(L,z)=>{const{onViewportChangeEnd:_,onMoveEnd:j}=b.getState();j==null||j(L,z),_==null||_(z)}});const{x:k,y:A,zoom:D}=O.current.getViewport();return b.setState({panZoom:O.current,transform:[k,A,D],domNode:S.current.closest(".react-flow")}),()=>{var L;(L=O.current)==null||L.destroy()}}},[]),N.useEffect(()=>{var k;(k=O.current)==null||k.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:o,panOnScrollMode:r,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:M,preventScrolling:f,noPanClassName:w,userSelectionActive:E,noWheelClassName:x,lib:C,onTransformChange:T,connectionInProgress:P})},[e,t,n,s,o,r,i,a,M,f,w,E,x,C,T,P]),g.jsx("div",{className:"react-flow__renderer",ref:S,style:ft,children:p})}const ha=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function pa(){const{userSelectionActive:e,userSelectionRect:t}=ee(ha,se);return e&&t?g.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const vt=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},ma=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function xa({isSelecting:e,selectionKeyPressed:t,selectionMode:n=ze.Full,panOnDrag:s,selectionOnDrag:o,onSelectionStart:r,onSelectionEnd:i,onPaneClick:a,onPaneContextMenu:l,onPaneScroll:u,onPaneMouseEnter:m,onPaneMouseMove:d,onPaneMouseLeave:c,children:f}){const p=oe(),{userSelectionActive:x,elementsSelectable:w,dragging:y,connectionInProgress:v}=ee(ma,se),h=w&&(e||x),b=N.useRef(null),S=N.useRef(),E=N.useRef(new Set),C=N.useRef(new Set),P=N.useRef(!1),M=N.useRef(!1),O=j=>{if(P.current||v){P.current=!1;return}a==null||a(j),p.getState().resetSelectedElements(),p.setState({nodesSelectionActive:!1})},T=j=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){j.preventDefault();return}l==null||l(j)},k=u?j=>u(j):void 0,A=j=>{(o&&b.current===j.target||!o||t)&&j.stopPropagation()},D=j=>{var B,Y;const{resetSelectedElements:I,domNode:R}=p.getState();S.current=R==null?void 0:R.getBoundingClientRect();const V=j.target!==b.current&&!!j.target.closest(".nokey"),H=o&&b.current===j.target||!o||t;if(!w||!e||j.button!==0||!S.current||V||!H||!j.isPrimary)return;j.stopPropagation(),j.preventDefault(),(Y=(B=j.target)==null?void 0:B.setPointerCapture)==null||Y.call(B,j.pointerId),M.current=!0,P.current=!1;const{x:X,y:$}=ce(j.nativeEvent,S.current);I(),p.setState({userSelectionRect:{width:0,height:0,startX:X,startY:$,x:X,y:$}}),r==null||r(j)},L=j=>{const{userSelectionRect:I,transform:R,nodeLookup:V,edgeLookup:H,connectionLookup:X,triggerNodeChanges:$,triggerEdgeChanges:B,defaultEdgeOptions:Y}=p.getState();if(!S.current||!I)return;P.current=!0;const{x:G,y:F}=ce(j.nativeEvent,S.current),{startX:K,startY:Q}=I,U={startX:K,startY:Q,x:G<K?G:K,y:F<Q?F:Q,width:Math.abs(G-K),height:Math.abs(F-Q)},Z=E.current,q=C.current;E.current=new Set(Dt(V,U,R,n===ze.Partial,!0).map(te=>te.id)),C.current=new Set;const J=(Y==null?void 0:Y.selectable)??!0;for(const te of E.current){const ne=X.get(te);if(ne)for(const{edgeId:ie}of ne.values()){const de=H.get(ie);de&&(de.selectable??J)&&C.current.add(ie)}}if(!rn(Z,E.current)){const te=Ce(V,E.current,!0);$(te)}if(!rn(q,C.current)){const te=Ce(H,C.current);B(te)}p.setState({userSelectionRect:U,userSelectionActive:!0,nodesSelectionActive:!1})},z=j=>{var R,V;if(j.button!==0||!M.current)return;(V=(R=j.target)==null?void 0:R.releasePointerCapture)==null||V.call(R,j.pointerId);const{userSelectionRect:I}=p.getState();!x&&I&&j.target===b.current&&(O==null||O(j)),p.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:E.current.size>0}),i==null||i(j),(t||o)&&(P.current=!1),M.current=!1},_=s===!0||Array.isArray(s)&&s.includes(0);return g.jsxs("div",{className:re(["react-flow__pane",{draggable:_,dragging:y,selection:e}]),onClick:h?void 0:vt(O,b),onContextMenu:vt(T,b),onWheel:vt(k,b),onPointerEnter:h?void 0:m,onPointerMove:h?L:d,onPointerUp:h?z:void 0,onPointerDownCapture:h?D:void 0,onClickCapture:h?A:void 0,onPointerLeave:c,ref:b,style:ft,children:[f,g.jsx(pa,{})]})}function Pt({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:o,unselectNodesAndEdges:r,multiSelectionActive:i,nodeLookup:a,onError:l}=t.getState(),u=a.get(e);if(!u){l==null||l("012",le.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&i)&&(r({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var m;return(m=s==null?void 0:s.current)==null?void 0:m.blur()})):o([e])}function _o({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:o,isSelectable:r,nodeClickDistance:i}){const a=oe(),[l,u]=N.useState(!1),m=N.useRef();return N.useEffect(()=>{m.current=hi({getStoreItems:()=>a.getState(),onNodeMouseDown:d=>{Pt({id:d,store:a,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),N.useEffect(()=>{var d,c;if(t)(d=m.current)==null||d.destroy();else if(e.current)return(c=m.current)==null||c.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:r,nodeId:o,nodeClickDistance:i}),()=>{var f;(f=m.current)==null||f.destroy()}},[n,s,t,r,e,o]),l}const ya=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function To(){const e=oe();return N.useCallback(n=>{const{nodeExtent:s,snapToGrid:o,snapGrid:r,nodesDraggable:i,onError:a,updateNodePositions:l,nodeLookup:u,nodeOrigin:m}=e.getState(),d=new Map,c=ya(i),f=o?r[0]:5,p=o?r[1]:5,x=n.direction.x*f*n.factor,w=n.direction.y*p*n.factor;for(const[,y]of u){if(!c(y))continue;let v={x:y.internals.positionAbsolute.x+x,y:y.internals.positionAbsolute.y+w};o&&(v=We(v,r));const{position:h,positionAbsolute:b}=eo({nodeId:y.id,nextPosition:v,nodeLookup:u,nodeExtent:s,nodeOrigin:m,onError:a});y.position=h,y.internals.positionAbsolute=b,d.set(y.id,y)}l(d)},[])}const Ft=N.createContext(null),wa=Ft.Provider;Ft.Consumer;const Ho=()=>N.useContext(Ft),ba=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),va=(e,t,n)=>s=>{const{connectionClickStartHandle:o,connectionMode:r,connection:i}=s,{fromHandle:a,toHandle:l,isValid:u}=i,m=(l==null?void 0:l.nodeId)===e&&(l==null?void 0:l.id)===t&&(l==null?void 0:l.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:m,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.id)===t&&(o==null?void 0:o.type)===n,isPossibleEndHandle:r===Se.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!o,valid:m&&u}};function Na({type:e="source",position:t=W.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:o=!0,isConnectableEnd:r=!0,id:i,onConnect:a,children:l,className:u,onMouseDown:m,onTouchStart:d,...c},f){var L,z;const p=i||null,x=e==="target",w=oe(),y=Ho(),{connectOnClick:v,noPanClassName:h,rfId:b}=ee(ba,se),{connectingFrom:S,connectingTo:E,clickConnecting:C,isPossibleEndHandle:P,connectionInProcess:M,clickConnectionInProcess:O,valid:T}=ee(va(y,p,e),se);y||(z=(L=w.getState()).onError)==null||z.call(L,"010",le.error010());const k=_=>{const{defaultEdgeOptions:j,onConnect:I,hasDefaultEdges:R}=w.getState(),V={...j,..._};if(R){const{edges:H,setEdges:X}=w.getState();X(go(V,H))}I==null||I(V),a==null||a(V)},A=_=>{if(!y)return;const j=co(_.nativeEvent);if(o&&(j&&_.button===0||!j)){const I=w.getState();It.onPointerDown(_.nativeEvent,{handleDomNode:_.currentTarget,autoPanOnConnect:I.autoPanOnConnect,connectionMode:I.connectionMode,connectionRadius:I.connectionRadius,domNode:I.domNode,nodeLookup:I.nodeLookup,lib:I.lib,isTarget:x,handleId:p,nodeId:y,flowId:I.rfId,panBy:I.panBy,cancelConnection:I.cancelConnection,onConnectStart:I.onConnectStart,onConnectEnd:I.onConnectEnd,updateConnection:I.updateConnection,onConnect:k,isValidConnection:n||I.isValidConnection,getTransform:()=>w.getState().transform,getFromHandle:()=>w.getState().connection.fromHandle,autoPanSpeed:I.autoPanSpeed,dragThreshold:I.connectionDragThreshold})}j?m==null||m(_):d==null||d(_)},D=_=>{const{onClickConnectStart:j,onClickConnectEnd:I,connectionClickStartHandle:R,connectionMode:V,isValidConnection:H,lib:X,rfId:$,nodeLookup:B,connection:Y}=w.getState();if(!y||!R&&!o)return;if(!R){j==null||j(_.nativeEvent,{nodeId:y,handleId:p,handleType:e}),w.setState({connectionClickStartHandle:{nodeId:y,type:e,id:p}});return}const G=io(_.target),F=n||H,{connection:K,isValid:Q}=It.isValid(_.nativeEvent,{handle:{nodeId:y,id:p,type:e},connectionMode:V,fromNodeId:R.nodeId,fromHandleId:R.id||null,fromType:R.type,isValidConnection:F,flowId:$,doc:G,lib:X,nodeLookup:B});Q&&K&&k(K);const U=structuredClone(Y);delete U.inProgress,U.toPosition=U.toHandle?U.toHandle.position:null,I==null||I(_,U),w.setState({connectionClickStartHandle:null})};return g.jsx("div",{"data-handleid":p,"data-nodeid":y,"data-handlepos":t,"data-id":`${b}-${y}-${p}-${e}`,className:re(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",h,u,{source:!x,target:x,connectable:s,connectablestart:o,connectableend:r,clickconnecting:C,connectingfrom:S,connectingto:E,valid:T,connectionindicator:s&&(!M||P)&&(M||O?r:o)}]),onMouseDown:A,onTouchStart:A,onClick:v?D:void 0,ref:f,...c,children:l})}const me=N.memo(Lo(Na));function Ea({data:e,isConnectable:t,sourcePosition:n=W.Bottom}){return g.jsxs(g.Fragment,{children:[e==null?void 0:e.label,g.jsx(me,{type:"source",position:n,isConnectable:t})]})}function Ca({data:e,isConnectable:t,targetPosition:n=W.Top,sourcePosition:s=W.Bottom}){return g.jsxs(g.Fragment,{children:[g.jsx(me,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,g.jsx(me,{type:"source",position:s,isConnectable:t})]})}function Sa(){return null}function ka({data:e,isConnectable:t,targetPosition:n=W.Top}){return g.jsxs(g.Fragment,{children:[g.jsx(me,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const rt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Pn={input:Ea,default:Ca,output:ka,group:Sa};function Ma(e){var t,n,s,o;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((o=e.style)==null?void 0:o.height)}}const ja=e=>{const{width:t,height:n,x:s,y:o}=Ye(e.nodeLookup,{filter:r=>!!r.selected});return{width:ae(t)?t:null,height:ae(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${o}px)`}};function Ia({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=oe(),{width:o,height:r,transformString:i,userSelectionActive:a}=ee(ja,se),l=To(),u=N.useRef(null);if(N.useEffect(()=>{var c;n||(c=u.current)==null||c.focus({preventScroll:!0})},[n]),_o({nodeRef:u}),a||!o||!r)return null;const m=e?c=>{const f=s.getState().nodes.filter(p=>p.selected);e(c,f)}:void 0,d=c=>{Object.prototype.hasOwnProperty.call(rt,c.key)&&(c.preventDefault(),l({direction:rt[c.key],factor:c.shiftKey?4:1}))};return g.jsx("div",{className:re(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:g.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:m,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:o,height:r}})})}const An=typeof window<"u"?window:void 0,Pa=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function zo({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:l,selectionKeyCode:u,selectionOnDrag:m,selectionMode:d,onSelectionStart:c,onSelectionEnd:f,multiSelectionKeyCode:p,panActivationKeyCode:x,zoomActivationKeyCode:w,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:h,panOnScroll:b,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:P,defaultViewport:M,translateExtent:O,minZoom:T,maxZoom:k,preventScrolling:A,onSelectionContextMenu:D,noWheelClassName:L,noPanClassName:z,disableKeyboardA11y:_,onViewportChange:j,isControlledViewport:I}){const{nodesSelectionActive:R,userSelectionActive:V}=ee(Pa),H=Fe(u,{target:An}),X=Fe(x,{target:An}),$=X||P,B=X||b,Y=m&&$!==!0,G=H||V||Y;return da({deleteKeyCode:l,multiSelectionKeyCode:p}),g.jsx(ga,{onPaneContextMenu:r,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:h,panOnScroll:B,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:!H&&$,defaultViewport:M,translateExtent:O,minZoom:T,maxZoom:k,zoomActivationKeyCode:w,preventScrolling:A,noWheelClassName:L,noPanClassName:z,onViewportChange:j,isControlledViewport:I,paneClickDistance:a,children:g.jsxs(xa,{onSelectionStart:c,onSelectionEnd:f,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:r,onPaneScroll:i,panOnDrag:$,isSelecting:!!G,selectionMode:d,selectionKeyPressed:H,selectionOnDrag:Y,children:[e,R&&g.jsx(Ia,{onSelectionContextMenu:D,noPanClassName:z,disableKeyboardA11y:_})]})})}zo.displayName="FlowRenderer";const Aa=N.memo(zo),$a=e=>t=>e?Dt(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function La(e){return ee(N.useCallback($a(e),[e]),se)}const Da=e=>e.updateNodeInternals;function _a(){const e=ee(Da),[t]=N.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(o=>{const r=o.target.getAttribute("data-id");s.set(r,{id:r,nodeElement:o.target,force:!0})}),e(s)}));return N.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function Ta({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const o=oe(),r=N.useRef(null),i=N.useRef(null),a=N.useRef(e.sourcePosition),l=N.useRef(e.targetPosition),u=N.useRef(t),m=n&&!!e.internals.handleBounds;return N.useEffect(()=>{r.current&&!e.hidden&&(!m||i.current!==r.current)&&(i.current&&(s==null||s.unobserve(i.current)),s==null||s.observe(r.current),i.current=r.current)},[m,e.hidden]),N.useEffect(()=>()=>{i.current&&(s==null||s.unobserve(i.current),i.current=null)},[]),N.useEffect(()=>{if(r.current){const d=u.current!==t,c=a.current!==e.sourcePosition,f=l.current!==e.targetPosition;(d||c||f)&&(u.current=t,a.current=e.sourcePosition,l.current=e.targetPosition,o.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}function Ha({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:o,onContextMenu:r,onDoubleClick:i,nodesDraggable:a,elementsSelectable:l,nodesConnectable:u,nodesFocusable:m,resizeObserver:d,noDragClassName:c,noPanClassName:f,disableKeyboardA11y:p,rfId:x,nodeTypes:w,nodeClickDistance:y,onError:v}){const{node:h,internals:b,isParent:S}=ee(F=>{const K=F.nodeLookup.get(e),Q=F.parentLookup.has(e);return{node:K,internals:K.internals,isParent:Q}},se);let E=h.type||"default",C=(w==null?void 0:w[E])||Pn[E];C===void 0&&(v==null||v("003",le.error003(E)),E="default",C=(w==null?void 0:w.default)||Pn.default);const P=!!(h.draggable||a&&typeof h.draggable>"u"),M=!!(h.selectable||l&&typeof h.selectable>"u"),O=!!(h.connectable||u&&typeof h.connectable>"u"),T=!!(h.focusable||m&&typeof h.focusable>"u"),k=oe(),A=so(h),D=Ta({node:h,nodeType:E,hasDimensions:A,resizeObserver:d}),L=_o({nodeRef:D,disabled:h.hidden||!P,noDragClassName:c,handleSelector:h.dragHandle,nodeId:e,isSelectable:M,nodeClickDistance:y}),z=To();if(h.hidden)return null;const _=fe(h),j=Ma(h),I=M||P||t||n||s||o,R=n?F=>n(F,{...b.userNode}):void 0,V=s?F=>s(F,{...b.userNode}):void 0,H=o?F=>o(F,{...b.userNode}):void 0,X=r?F=>r(F,{...b.userNode}):void 0,$=i?F=>i(F,{...b.userNode}):void 0,B=F=>{const{selectNodesOnDrag:K,nodeDragThreshold:Q}=k.getState();M&&(!K||!P||Q>0)&&Pt({id:e,store:k,nodeRef:D}),t&&t(F,{...b.userNode})},Y=F=>{if(!(ao(F.nativeEvent)||p)){if(Kn.includes(F.key)&&M){const K=F.key==="Escape";Pt({id:e,store:k,unselect:K,nodeRef:D})}else if(P&&h.selected&&Object.prototype.hasOwnProperty.call(rt,F.key)){F.preventDefault();const{ariaLabelConfig:K}=k.getState();k.setState({ariaLiveMessage:K["node.a11yDescription.ariaLiveMessage"]({direction:F.key.replace("Arrow","").toLowerCase(),x:~~b.positionAbsolute.x,y:~~b.positionAbsolute.y})}),z({direction:rt[F.key],factor:F.shiftKey?4:1})}}},G=()=>{var J;if(p||!((J=D.current)!=null&&J.matches(":focus-visible")))return;const{transform:F,width:K,height:Q,autoPanOnNodeFocus:U,setCenter:Z}=k.getState();if(!U)return;Dt(new Map([[e,h]]),{x:0,y:0,width:K,height:Q},F,!0).length>0||Z(h.position.x+_.width/2,h.position.y+_.height/2,{zoom:F[2]})};return g.jsx("div",{className:re(["react-flow__node",`react-flow__node-${E}`,{[f]:P},h.className,{selected:h.selected,selectable:M,parent:S,draggable:P,dragging:L}]),ref:D,style:{zIndex:b.z,transform:`translate(${b.positionAbsolute.x}px,${b.positionAbsolute.y}px)`,pointerEvents:I?"all":"none",visibility:A?"visible":"hidden",...h.style,...j},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:R,onMouseMove:V,onMouseLeave:H,onContextMenu:X,onClick:B,onDoubleClick:$,onKeyDown:T?Y:void 0,tabIndex:T?0:void 0,onFocus:T?G:void 0,role:h.ariaRole??(T?"group":void 0),"aria-roledescription":"node","aria-describedby":p?void 0:`${Mo}-${x}`,"aria-label":h.ariaLabel,...h.domAttributes,children:g.jsx(wa,{value:e,children:g.jsx(C,{id:e,data:h.data,type:E,positionAbsoluteX:b.positionAbsolute.x,positionAbsoluteY:b.positionAbsolute.y,selected:h.selected??!1,selectable:M,draggable:P,deletable:h.deletable??!0,isConnectable:O,sourcePosition:h.sourcePosition,targetPosition:h.targetPosition,dragging:L,dragHandle:h.dragHandle,zIndex:b.z,parentId:h.parentId,..._})})})}var za=N.memo(Ha);const Ba=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Bo(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,onError:r}=ee(Ba,se),i=La(e.onlyRenderVisibleElements),a=_a();return g.jsx("div",{className:"react-flow__nodes",style:ft,children:i.map(l=>g.jsx(za,{id:l,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:o,nodeClickDistance:e.nodeClickDistance,onError:r},l))})}Bo.displayName="NodeRenderer";const Ra=N.memo(Bo);function Va(e){return ee(N.useCallback(n=>{if(!e)return n.edges.map(o=>o.id);const s=[];if(n.width&&n.height)for(const o of n.edges){const r=n.nodeLookup.get(o.source),i=n.nodeLookup.get(o.target);r&&i&&Zr({sourceNode:r,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&s.push(o.id)}return s},[e]),se)}const Fa=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return g.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Oa=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return g.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},$n={[nt.Arrow]:Fa,[nt.ArrowClosed]:Oa};function Ya(e){const t=oe();return N.useMemo(()=>{var o,r;return Object.prototype.hasOwnProperty.call($n,e)?$n[e]:((r=(o=t.getState()).onError)==null||r.call(o,"009",le.error009(e)),null)},[e])}const Wa=({id:e,type:t,color:n,width:s=12.5,height:o=12.5,markerUnits:r="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const l=Ya(t);return l?g.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:a,refX:"0",refY:"0",children:g.jsx(l,{color:n,strokeWidth:i})}):null},Ro=({defaultColor:e,rfId:t})=>{const n=ee(r=>r.edges),s=ee(r=>r.defaultEdgeOptions),o=N.useMemo(()=>oi(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return o.length?g.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:g.jsx("defs",{children:o.map(r=>g.jsx(Wa,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};Ro.displayName="MarkerDefinitions";var Xa=N.memo(Ro);function Vo({x:e,y:t,label:n,labelStyle:s,labelShowBg:o=!0,labelBgStyle:r,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:l,className:u,...m}){const[d,c]=N.useState({x:1,y:0,width:0,height:0}),f=re(["react-flow__edge-textwrapper",u]),p=N.useRef(null);return N.useEffect(()=>{if(p.current){const x=p.current.getBBox();c({x:x.x,y:x.y,width:x.width,height:x.height})}},[n]),n?g.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:f,visibility:d.width?"visible":"hidden",...m,children:[o&&g.jsx("rect",{width:d.width+2*i[0],x:-i[0],y:-i[1],height:d.height+2*i[1],className:"react-flow__edge-textbg",style:r,rx:a,ry:a}),g.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:p,style:s,children:n}),l]}):null}Vo.displayName="EdgeText";const Ga=N.memo(Vo);function gt({path:e,labelX:t,labelY:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:l,interactionWidth:u=20,...m}){return g.jsxs(g.Fragment,{children:[g.jsx("path",{...m,d:e,fill:"none",className:re(["react-flow__edge-path",m.className])}),u?g.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,s&&ae(t)&&ae(n)?g.jsx(Ga,{x:t,y:n,label:s,labelStyle:o,labelShowBg:r,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:l}):null]})}function Ln({pos:e,x1:t,y1:n,x2:s,y2:o}){return e===W.Left||e===W.Right?[.5*(t+s),n]:[t,.5*(n+o)]}function Fo({sourceX:e,sourceY:t,sourcePosition:n=W.Bottom,targetX:s,targetY:o,targetPosition:r=W.Top}){const[i,a]=Ln({pos:n,x1:e,y1:t,x2:s,y2:o}),[l,u]=Ln({pos:r,x1:s,y1:o,x2:e,y2:t}),[m,d,c,f]=lo({sourceX:e,sourceY:t,targetX:s,targetY:o,sourceControlX:i,sourceControlY:a,targetControlX:l,targetControlY:u});return[`M${e},${t} C${i},${a} ${l},${u} ${s},${o}`,m,d,c,f]}function Oo(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i,targetPosition:a,label:l,labelStyle:u,labelShowBg:m,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:f,style:p,markerEnd:x,markerStart:w,interactionWidth:y})=>{const[v,h,b]=Fo({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a}),S=e.isInternal?void 0:t;return g.jsx(gt,{id:S,path:v,labelX:h,labelY:b,label:l,labelStyle:u,labelShowBg:m,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:f,style:p,markerEnd:x,markerStart:w,interactionWidth:y})})}const qa=Oo({isInternal:!1}),Yo=Oo({isInternal:!0});qa.displayName="SimpleBezierEdge";Yo.displayName="SimpleBezierEdgeInternal";function Wo(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:u,labelBgPadding:m,labelBgBorderRadius:d,style:c,sourcePosition:f=W.Bottom,targetPosition:p=W.Top,markerEnd:x,markerStart:w,pathOptions:y,interactionWidth:v})=>{const[h,b,S]=kt({sourceX:n,sourceY:s,sourcePosition:f,targetX:o,targetY:r,targetPosition:p,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset,stepPosition:y==null?void 0:y.stepPosition}),E=e.isInternal?void 0:t;return g.jsx(gt,{id:E,path:h,labelX:b,labelY:S,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:u,labelBgPadding:m,labelBgBorderRadius:d,style:c,markerEnd:x,markerStart:w,interactionWidth:v})})}const Xo=Wo({isInternal:!1}),Go=Wo({isInternal:!0});Xo.displayName="SmoothStepEdge";Go.displayName="SmoothStepEdgeInternal";function qo(e){return N.memo(({id:t,...n})=>{var o;const s=e.isInternal?void 0:t;return g.jsx(Xo,{...n,id:s,pathOptions:N.useMemo(()=>{var r;return{borderRadius:0,offset:(r=n.pathOptions)==null?void 0:r.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const Ka=qo({isInternal:!1}),Ko=qo({isInternal:!0});Ka.displayName="StepEdge";Ko.displayName="StepEdgeInternal";function Zo(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:u,labelBgPadding:m,labelBgBorderRadius:d,style:c,markerEnd:f,markerStart:p,interactionWidth:x})=>{const[w,y,v]=ho({sourceX:n,sourceY:s,targetX:o,targetY:r}),h=e.isInternal?void 0:t;return g.jsx(gt,{id:h,path:w,labelX:y,labelY:v,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:u,labelBgPadding:m,labelBgBorderRadius:d,style:c,markerEnd:f,markerStart:p,interactionWidth:x})})}const Za=Zo({isInternal:!1}),Uo=Zo({isInternal:!0});Za.displayName="StraightEdge";Uo.displayName="StraightEdgeInternal";function Qo(e){return N.memo(({id:t,sourceX:n,sourceY:s,targetX:o,targetY:r,sourcePosition:i=W.Bottom,targetPosition:a=W.Top,label:l,labelStyle:u,labelShowBg:m,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:f,style:p,markerEnd:x,markerStart:w,pathOptions:y,interactionWidth:v})=>{const[h,b,S]=uo({sourceX:n,sourceY:s,sourcePosition:i,targetX:o,targetY:r,targetPosition:a,curvature:y==null?void 0:y.curvature}),E=e.isInternal?void 0:t;return g.jsx(gt,{id:E,path:h,labelX:b,labelY:S,label:l,labelStyle:u,labelShowBg:m,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:f,style:p,markerEnd:x,markerStart:w,interactionWidth:v})})}const Ua=Qo({isInternal:!1}),Jo=Qo({isInternal:!0});Ua.displayName="BezierEdge";Jo.displayName="BezierEdgeInternal";const Dn={default:Jo,straight:Uo,step:Ko,smoothstep:Go,simplebezier:Yo},_n={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Qa=(e,t,n)=>n===W.Left?e-t:n===W.Right?e+t:e,Ja=(e,t,n)=>n===W.Top?e-t:n===W.Bottom?e+t:e,Tn="react-flow__edgeupdater";function Hn({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:o,onMouseEnter:r,onMouseOut:i,type:a}){return g.jsx("circle",{onMouseDown:o,onMouseEnter:r,onMouseOut:i,className:re([Tn,`${Tn}-${a}`]),cx:Qa(t,s,e),cy:Ja(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function ec({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:o,targetX:r,targetY:i,sourcePosition:a,targetPosition:l,onReconnect:u,onReconnectStart:m,onReconnectEnd:d,setReconnecting:c,setUpdateHover:f}){const p=oe(),x=(b,S)=>{if(b.button!==0)return;const{autoPanOnConnect:E,domNode:C,isValidConnection:P,connectionMode:M,connectionRadius:O,lib:T,onConnectStart:k,onConnectEnd:A,cancelConnection:D,nodeLookup:L,rfId:z,panBy:_,updateConnection:j}=p.getState(),I=S.type==="target",R=(X,$)=>{c(!1),d==null||d(X,n,S.type,$)},V=X=>u==null?void 0:u(n,X),H=(X,$)=>{c(!0),m==null||m(b,n,S.type),k==null||k(X,$)};It.onPointerDown(b.nativeEvent,{autoPanOnConnect:E,connectionMode:M,connectionRadius:O,domNode:C,handleId:S.id,nodeId:S.nodeId,nodeLookup:L,isTarget:I,edgeUpdaterType:S.type,lib:T,flowId:z,cancelConnection:D,panBy:_,isValidConnection:P,onConnect:V,onConnectStart:H,onConnectEnd:A,onReconnectEnd:R,updateConnection:j,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:b.currentTarget})},w=b=>x(b,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=b=>x(b,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>f(!0),h=()=>f(!1);return g.jsxs(g.Fragment,{children:[(e===!0||e==="source")&&g.jsx(Hn,{position:a,centerX:s,centerY:o,radius:t,onMouseDown:w,onMouseEnter:v,onMouseOut:h,type:"source"}),(e===!0||e==="target")&&g.jsx(Hn,{position:l,centerX:r,centerY:i,radius:t,onMouseDown:y,onMouseEnter:v,onMouseOut:h,type:"target"})]})}function tc({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:o,onDoubleClick:r,onContextMenu:i,onMouseEnter:a,onMouseMove:l,onMouseLeave:u,reconnectRadius:m,onReconnect:d,onReconnectStart:c,onReconnectEnd:f,rfId:p,edgeTypes:x,noPanClassName:w,onError:y,disableKeyboardA11y:v}){let h=ee(Z=>Z.edgeLookup.get(e));const b=ee(Z=>Z.defaultEdgeOptions);h=b?{...b,...h}:h;let S=h.type||"default",E=(x==null?void 0:x[S])||Dn[S];E===void 0&&(y==null||y("011",le.error011(S)),S="default",E=(x==null?void 0:x.default)||Dn.default);const C=!!(h.focusable||t&&typeof h.focusable>"u"),P=typeof d<"u"&&(h.reconnectable||n&&typeof h.reconnectable>"u"),M=!!(h.selectable||s&&typeof h.selectable>"u"),O=N.useRef(null),[T,k]=N.useState(!1),[A,D]=N.useState(!1),L=oe(),{zIndex:z,sourceX:_,sourceY:j,targetX:I,targetY:R,sourcePosition:V,targetPosition:H}=ee(N.useCallback(Z=>{const q=Z.nodeLookup.get(h.source),J=Z.nodeLookup.get(h.target);if(!q||!J)return{zIndex:h.zIndex,..._n};const te=ni({id:e,sourceNode:q,targetNode:J,sourceHandle:h.sourceHandle||null,targetHandle:h.targetHandle||null,connectionMode:Z.connectionMode,onError:y});return{zIndex:Kr({selected:h.selected,zIndex:h.zIndex,sourceNode:q,targetNode:J,elevateOnSelect:Z.elevateEdgesOnSelect}),...te||_n}},[h.source,h.target,h.sourceHandle,h.targetHandle,h.selected,h.zIndex]),se),X=N.useMemo(()=>h.markerStart?`url('#${Mt(h.markerStart,p)}')`:void 0,[h.markerStart,p]),$=N.useMemo(()=>h.markerEnd?`url('#${Mt(h.markerEnd,p)}')`:void 0,[h.markerEnd,p]);if(h.hidden||_===null||j===null||I===null||R===null)return null;const B=Z=>{var ne;const{addSelectedEdges:q,unselectNodesAndEdges:J,multiSelectionActive:te}=L.getState();M&&(L.setState({nodesSelectionActive:!1}),h.selected&&te?(J({nodes:[],edges:[h]}),(ne=O.current)==null||ne.blur()):q([e])),o&&o(Z,h)},Y=r?Z=>{r(Z,{...h})}:void 0,G=i?Z=>{i(Z,{...h})}:void 0,F=a?Z=>{a(Z,{...h})}:void 0,K=l?Z=>{l(Z,{...h})}:void 0,Q=u?Z=>{u(Z,{...h})}:void 0,U=Z=>{var q;if(!v&&Kn.includes(Z.key)&&M){const{unselectNodesAndEdges:J,addSelectedEdges:te}=L.getState();Z.key==="Escape"?((q=O.current)==null||q.blur(),J({edges:[h]})):te([e])}};return g.jsx("svg",{style:{zIndex:z},children:g.jsxs("g",{className:re(["react-flow__edge",`react-flow__edge-${S}`,h.className,w,{selected:h.selected,animated:h.animated,inactive:!M&&!o,updating:T,selectable:M}]),onClick:B,onDoubleClick:Y,onContextMenu:G,onMouseEnter:F,onMouseMove:K,onMouseLeave:Q,onKeyDown:C?U:void 0,tabIndex:C?0:void 0,role:h.ariaRole??(C?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":h.ariaLabel===null?void 0:h.ariaLabel||`Edge from ${h.source} to ${h.target}`,"aria-describedby":C?`${jo}-${p}`:void 0,ref:O,...h.domAttributes,children:[!A&&g.jsx(E,{id:e,source:h.source,target:h.target,type:h.type,selected:h.selected,animated:h.animated,selectable:M,deletable:h.deletable??!0,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,sourceX:_,sourceY:j,targetX:I,targetY:R,sourcePosition:V,targetPosition:H,data:h.data,style:h.style,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerStart:X,markerEnd:$,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth}),P&&g.jsx(ec,{edge:h,isReconnectable:P,reconnectRadius:m,onReconnect:d,onReconnectStart:c,onReconnectEnd:f,sourceX:_,sourceY:j,targetX:I,targetY:R,sourcePosition:V,targetPosition:H,setUpdateHover:k,setReconnecting:D})]})})}var nc=N.memo(tc);const oc=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function es({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:o,onReconnect:r,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:l,onEdgeMouseLeave:u,onEdgeClick:m,reconnectRadius:d,onEdgeDoubleClick:c,onReconnectStart:f,onReconnectEnd:p,disableKeyboardA11y:x}){const{edgesFocusable:w,edgesReconnectable:y,elementsSelectable:v,onError:h}=ee(oc,se),b=Va(t);return g.jsxs("div",{className:"react-flow__edges",children:[g.jsx(Xa,{defaultColor:e,rfId:n}),b.map(S=>g.jsx(nc,{id:S,edgesFocusable:w,edgesReconnectable:y,elementsSelectable:v,noPanClassName:o,onReconnect:r,onContextMenu:i,onMouseEnter:a,onMouseMove:l,onMouseLeave:u,onClick:m,reconnectRadius:d,onDoubleClick:c,onReconnectStart:f,onReconnectEnd:p,rfId:n,onError:h,edgeTypes:s,disableKeyboardA11y:x},S))]})}es.displayName="EdgeRenderer";const sc=N.memo(es),rc=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function ic({children:e}){const t=ee(rc);return g.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function ac(e){const t=Vt(),n=N.useRef(!1);N.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const cc=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function lc(e){const t=ee(cc),n=oe();return N.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function dc(e){return e.connection.inProgress?{...e.connection,to:Xe(e.connection.to,e.transform)}:{...e.connection}}function uc(e){return dc}function fc(e){const t=uc();return ee(t,se)}const gc=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function hc({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:o,width:r,height:i,isValid:a,inProgress:l}=ee(gc,se);return!(r&&o&&l)?null:g.jsx("svg",{style:e,width:r,height:i,className:"react-flow__connectionline react-flow__container",children:g.jsx("g",{className:re(["react-flow__connection",Qn(a)]),children:g.jsx(ts,{style:t,type:n,CustomComponent:s,isValid:a})})})}const ts=({style:e,type:t=pe.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:o,from:r,fromNode:i,fromHandle:a,fromPosition:l,to:u,toNode:m,toHandle:d,toPosition:c}=fc();if(!o)return;if(n)return g.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:r.x,fromY:r.y,toX:u.x,toY:u.y,fromPosition:l,toPosition:c,connectionStatus:Qn(s),toNode:m,toHandle:d});let f="";const p={sourceX:r.x,sourceY:r.y,sourcePosition:l,targetX:u.x,targetY:u.y,targetPosition:c};switch(t){case pe.Bezier:[f]=uo(p);break;case pe.SimpleBezier:[f]=Fo(p);break;case pe.Step:[f]=kt({...p,borderRadius:0});break;case pe.SmoothStep:[f]=kt(p);break;default:[f]=ho(p)}return g.jsx("path",{d:f,fill:"none",className:"react-flow__connection-path",style:e})};ts.displayName="ConnectionLine";const pc={};function zn(e=pc){N.useRef(e),oe(),N.useEffect(()=>{},[e])}function mc(){oe(),N.useRef(!1),N.useEffect(()=>{},[])}function ns({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:o,onNodeDoubleClick:r,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:m,onSelectionContextMenu:d,onSelectionStart:c,onSelectionEnd:f,connectionLineType:p,connectionLineStyle:x,connectionLineComponent:w,connectionLineContainerStyle:y,selectionKeyCode:v,selectionOnDrag:h,selectionMode:b,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:C,deleteKeyCode:P,onlyRenderVisibleElements:M,elementsSelectable:O,defaultViewport:T,translateExtent:k,minZoom:A,maxZoom:D,preventScrolling:L,defaultMarkerColor:z,zoomOnScroll:_,zoomOnPinch:j,panOnScroll:I,panOnScrollSpeed:R,panOnScrollMode:V,zoomOnDoubleClick:H,panOnDrag:X,onPaneClick:$,onPaneMouseEnter:B,onPaneMouseMove:Y,onPaneMouseLeave:G,onPaneScroll:F,onPaneContextMenu:K,paneClickDistance:Q,nodeClickDistance:U,onEdgeContextMenu:Z,onEdgeMouseEnter:q,onEdgeMouseMove:J,onEdgeMouseLeave:te,reconnectRadius:ne,onReconnect:ie,onReconnectStart:de,onReconnectEnd:Ge,noDragClassName:qe,noWheelClassName:Ke,noPanClassName:Pe,disableKeyboardA11y:Ae,nodeExtent:ht,rfId:Ze,viewport:ve,onViewportChange:$e}){return zn(e),zn(t),mc(),ac(n),lc(ve),g.jsx(Aa,{onPaneClick:$,onPaneMouseEnter:B,onPaneMouseMove:Y,onPaneMouseLeave:G,onPaneContextMenu:K,onPaneScroll:F,paneClickDistance:Q,deleteKeyCode:P,selectionKeyCode:v,selectionOnDrag:h,selectionMode:b,onSelectionStart:c,onSelectionEnd:f,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:C,elementsSelectable:O,zoomOnScroll:_,zoomOnPinch:j,zoomOnDoubleClick:H,panOnScroll:I,panOnScrollSpeed:R,panOnScrollMode:V,panOnDrag:X,defaultViewport:T,translateExtent:k,minZoom:A,maxZoom:D,onSelectionContextMenu:d,preventScrolling:L,noDragClassName:qe,noWheelClassName:Ke,noPanClassName:Pe,disableKeyboardA11y:Ae,onViewportChange:$e,isControlledViewport:!!ve,children:g.jsxs(ic,{children:[g.jsx(sc,{edgeTypes:t,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:ie,onReconnectStart:de,onReconnectEnd:Ge,onlyRenderVisibleElements:M,onEdgeContextMenu:Z,onEdgeMouseEnter:q,onEdgeMouseMove:J,onEdgeMouseLeave:te,reconnectRadius:ne,defaultMarkerColor:z,noPanClassName:Pe,disableKeyboardA11y:Ae,rfId:Ze}),g.jsx(hc,{style:x,type:p,component:w,containerStyle:y}),g.jsx("div",{className:"react-flow__edgelabel-renderer"}),g.jsx(Ra,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:r,onNodeMouseEnter:a,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:m,nodeClickDistance:U,onlyRenderVisibleElements:M,noPanClassName:Pe,noDragClassName:qe,disableKeyboardA11y:Ae,nodeExtent:ht,rfId:Ze}),g.jsx("div",{className:"react-flow__viewport-portal"})]})})}ns.displayName="GraphView";const xc=N.memo(ns),Bn=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:l=.5,maxZoom:u=2,nodeOrigin:m,nodeExtent:d}={})=>{const c=new Map,f=new Map,p=new Map,x=new Map,w=s??t??[],y=n??e??[],v=m??[0,0],h=d??He;xo(p,x,w);const b=jt(y,c,f,{nodeOrigin:v,nodeExtent:h,elevateNodesOnSelect:!1});let S=[0,0,1];if(i&&o&&r){const E=Ye(c,{filter:O=>!!((O.width||O.initialWidth)&&(O.height||O.initialHeight))}),{x:C,y:P,zoom:M}=_t(E,o,r,l,u,(a==null?void 0:a.padding)??.1);S=[C,P,M]}return{rfId:"1",width:o??0,height:r??0,transform:S,nodes:y,nodesInitialized:b,nodeLookup:c,parentLookup:f,edges:w,edgeLookup:x,connectionLookup:p,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:l,maxZoom:u,translateExtent:He,nodeExtent:h,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Se.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:v,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Un},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Or,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Zn}},yc=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:l,maxZoom:u,nodeOrigin:m,nodeExtent:d})=>Nr((c,f)=>{async function p(){const{nodeLookup:x,panZoom:w,fitViewOptions:y,fitViewResolver:v,width:h,height:b,minZoom:S,maxZoom:E}=f();w&&(await Vr({nodes:x,width:h,height:b,panZoom:w,minZoom:S,maxZoom:E},y),v==null||v.resolve(!0),c({fitViewResolver:null}))}return{...Bn({nodes:e,edges:t,width:o,height:r,fitView:i,fitViewOptions:a,minZoom:l,maxZoom:u,nodeOrigin:m,nodeExtent:d,defaultNodes:n,defaultEdges:s}),setNodes:x=>{const{nodeLookup:w,parentLookup:y,nodeOrigin:v,elevateNodesOnSelect:h,fitViewQueued:b}=f(),S=jt(x,w,y,{nodeOrigin:v,nodeExtent:d,elevateNodesOnSelect:h,checkEquality:!0});b&&S?(p(),c({nodes:x,nodesInitialized:S,fitViewQueued:!1,fitViewOptions:void 0})):c({nodes:x,nodesInitialized:S})},setEdges:x=>{const{connectionLookup:w,edgeLookup:y}=f();xo(w,y,x),c({edges:x})},setDefaultNodesAndEdges:(x,w)=>{if(x){const{setNodes:y}=f();y(x),c({hasDefaultNodes:!0})}if(w){const{setEdges:y}=f();y(w),c({hasDefaultEdges:!0})}},updateNodeInternals:x=>{const{triggerNodeChanges:w,nodeLookup:y,parentLookup:v,domNode:h,nodeOrigin:b,nodeExtent:S,debug:E,fitViewQueued:C}=f(),{changes:P,updatedInternals:M}=di(x,y,v,h,b,S);M&&(ii(y,v,{nodeOrigin:b,nodeExtent:S}),C?(p(),c({fitViewQueued:!1,fitViewOptions:void 0})):c({}),(P==null?void 0:P.length)>0&&(E&&console.log("React Flow: trigger node changes",P),w==null||w(P)))},updateNodePositions:(x,w=!1)=>{const y=[],v=[],{nodeLookup:h,triggerNodeChanges:b}=f();for(const[S,E]of x){const C=h.get(S),P=!!(C!=null&&C.expandParent&&(C!=null&&C.parentId)&&(E!=null&&E.position)),M={id:S,type:"position",position:P?{x:Math.max(0,E.position.x),y:Math.max(0,E.position.y)}:E.position,dragging:w};P&&C.parentId&&y.push({id:S,parentId:C.parentId,rect:{...E.internals.positionAbsolute,width:E.measured.width??0,height:E.measured.height??0}}),v.push(M)}if(y.length>0){const{parentLookup:S,nodeOrigin:E}=f(),C=Rt(y,h,S,E);v.push(...C)}b(v)},triggerNodeChanges:x=>{const{onNodesChange:w,setNodes:y,nodes:v,hasDefaultNodes:h,debug:b}=f();if(x!=null&&x.length){if(h){const S=Ao(x,v);y(S)}b&&console.log("React Flow: trigger node changes",x),w==null||w(x)}},triggerEdgeChanges:x=>{const{onEdgesChange:w,setEdges:y,edges:v,hasDefaultEdges:h,debug:b}=f();if(x!=null&&x.length){if(h){const S=$o(x,v);y(S)}b&&console.log("React Flow: trigger edge changes",x),w==null||w(x)}},addSelectedNodes:x=>{const{multiSelectionActive:w,edgeLookup:y,nodeLookup:v,triggerNodeChanges:h,triggerEdgeChanges:b}=f();if(w){const S=x.map(E=>xe(E,!0));h(S);return}h(Ce(v,new Set([...x]),!0)),b(Ce(y))},addSelectedEdges:x=>{const{multiSelectionActive:w,edgeLookup:y,nodeLookup:v,triggerNodeChanges:h,triggerEdgeChanges:b}=f();if(w){const S=x.map(E=>xe(E,!0));b(S);return}b(Ce(y,new Set([...x]))),h(Ce(v,new Set,!0))},unselectNodesAndEdges:({nodes:x,edges:w}={})=>{const{edges:y,nodes:v,nodeLookup:h,triggerNodeChanges:b,triggerEdgeChanges:S}=f(),E=x||v,C=w||y,P=E.map(O=>{const T=h.get(O.id);return T&&(T.selected=!1),xe(O.id,!1)}),M=C.map(O=>xe(O.id,!1));b(P),S(M)},setMinZoom:x=>{const{panZoom:w,maxZoom:y}=f();w==null||w.setScaleExtent([x,y]),c({minZoom:x})},setMaxZoom:x=>{const{panZoom:w,minZoom:y}=f();w==null||w.setScaleExtent([y,x]),c({maxZoom:x})},setTranslateExtent:x=>{var w;(w=f().panZoom)==null||w.setTranslateExtent(x),c({translateExtent:x})},setPaneClickDistance:x=>{var w;(w=f().panZoom)==null||w.setClickDistance(x)},resetSelectedElements:()=>{const{edges:x,nodes:w,triggerNodeChanges:y,triggerEdgeChanges:v,elementsSelectable:h}=f();if(!h)return;const b=w.reduce((E,C)=>C.selected?[...E,xe(C.id,!1)]:E,[]),S=x.reduce((E,C)=>C.selected?[...E,xe(C.id,!1)]:E,[]);y(b),v(S)},setNodeExtent:x=>{const{nodes:w,nodeLookup:y,parentLookup:v,nodeOrigin:h,elevateNodesOnSelect:b,nodeExtent:S}=f();x[0][0]===S[0][0]&&x[0][1]===S[0][1]&&x[1][0]===S[1][0]&&x[1][1]===S[1][1]||(jt(w,y,v,{nodeOrigin:h,nodeExtent:x,elevateNodesOnSelect:b,checkEquality:!1}),c({nodeExtent:x}))},panBy:x=>{const{transform:w,width:y,height:v,panZoom:h,translateExtent:b}=f();return ui({delta:x,panZoom:h,transform:w,translateExtent:b,width:y,height:v})},setCenter:async(x,w,y)=>{const{width:v,height:h,maxZoom:b,panZoom:S}=f();if(!S)return Promise.resolve(!1);const E=typeof(y==null?void 0:y.zoom)<"u"?y.zoom:b;return await S.setViewport({x:v/2-x*E,y:h/2-w*E,zoom:E},{duration:y==null?void 0:y.duration,ease:y==null?void 0:y.ease,interpolate:y==null?void 0:y.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{c({connection:{...Un}})},updateConnection:x=>{c({connection:x})},reset:()=>c({...Bn()})}},Object.is);function wc({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:o,initialHeight:r,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:l,fitView:u,nodeOrigin:m,nodeExtent:d,children:c}){const[f]=N.useState(()=>yc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:o,height:r,fitView:u,minZoom:i,maxZoom:a,fitViewOptions:l,nodeOrigin:m,nodeExtent:d}));return g.jsx(Hi,{value:f,children:g.jsx(ia,{children:c})})}function bc({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:o,width:r,height:i,fitView:a,fitViewOptions:l,minZoom:u,maxZoom:m,nodeOrigin:d,nodeExtent:c}){return N.useContext(dt)?g.jsx(g.Fragment,{children:e}):g.jsx(wc,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:o,initialWidth:r,initialHeight:i,fitView:a,initialFitViewOptions:l,initialMinZoom:u,initialMaxZoom:m,nodeOrigin:d,nodeExtent:c,children:e})}const vc={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Nc({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:o,nodeTypes:r,edgeTypes:i,onNodeClick:a,onEdgeClick:l,onInit:u,onMove:m,onMoveStart:d,onMoveEnd:c,onConnect:f,onConnectStart:p,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:y,onNodeMouseEnter:v,onNodeMouseMove:h,onNodeMouseLeave:b,onNodeContextMenu:S,onNodeDoubleClick:E,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:M,onNodesDelete:O,onEdgesDelete:T,onDelete:k,onSelectionChange:A,onSelectionDragStart:D,onSelectionDrag:L,onSelectionDragStop:z,onSelectionContextMenu:_,onSelectionStart:j,onSelectionEnd:I,onBeforeDelete:R,connectionMode:V,connectionLineType:H=pe.Bezier,connectionLineStyle:X,connectionLineComponent:$,connectionLineContainerStyle:B,deleteKeyCode:Y="Backspace",selectionKeyCode:G="Shift",selectionOnDrag:F=!1,selectionMode:K=ze.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:U=Re()?"Meta":"Control",zoomActivationKeyCode:Z=Re()?"Meta":"Control",snapToGrid:q,snapGrid:J,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:ne,nodesDraggable:ie,autoPanOnNodeFocus:de,nodesConnectable:Ge,nodesFocusable:qe,nodeOrigin:Ke=Io,edgesFocusable:Pe,edgesReconnectable:Ae,elementsSelectable:ht=!0,defaultViewport:Ze=Zi,minZoom:ve=.5,maxZoom:$e=2,translateExtent:Ot=He,preventScrolling:as=!0,nodeExtent:pt,defaultMarkerColor:cs="#b1b1b7",zoomOnScroll:ls=!0,zoomOnPinch:ds=!0,panOnScroll:us=!1,panOnScrollSpeed:fs=.5,panOnScrollMode:gs=ye.Free,zoomOnDoubleClick:hs=!0,panOnDrag:ps=!0,onPaneClick:ms,onPaneMouseEnter:xs,onPaneMouseMove:ys,onPaneMouseLeave:ws,onPaneScroll:bs,onPaneContextMenu:vs,paneClickDistance:Yt=0,nodeClickDistance:Ns=0,children:Es,onReconnect:Cs,onReconnectStart:Ss,onReconnectEnd:ks,onEdgeContextMenu:Ms,onEdgeDoubleClick:js,onEdgeMouseEnter:Is,onEdgeMouseMove:Ps,onEdgeMouseLeave:As,reconnectRadius:$s=10,onNodesChange:Ls,onEdgesChange:Ds,noDragClassName:_s="nodrag",noWheelClassName:Ts="nowheel",noPanClassName:Wt="nopan",fitView:Xt,fitViewOptions:Gt,connectOnClick:Hs,attributionPosition:zs,proOptions:Bs,defaultEdgeOptions:Rs,elevateNodesOnSelect:Vs,elevateEdgesOnSelect:Fs,disableKeyboardA11y:qt=!1,autoPanOnConnect:Os,autoPanOnNodeDrag:Ys,autoPanSpeed:Ws,connectionRadius:Xs,isValidConnection:Gs,onError:qs,style:Ks,id:Kt,nodeDragThreshold:Zs,connectionDragThreshold:Us,viewport:Qs,onViewportChange:Js,width:er,height:tr,colorMode:nr="light",debug:or,onScroll:Ue,ariaLabelConfig:sr,...rr},ir){const mt=Kt||"1",ar=ea(nr),cr=N.useCallback(Zt=>{Zt.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Ue==null||Ue(Zt)},[Ue]);return g.jsx("div",{"data-testid":"rf__wrapper",...rr,onScroll:cr,style:{...Ks,...vc},ref:ir,className:re(["react-flow",o,ar]),id:Kt,role:"application",children:g.jsxs(bc,{nodes:e,edges:t,width:er,height:tr,fitView:Xt,fitViewOptions:Gt,minZoom:ve,maxZoom:$e,nodeOrigin:Ke,nodeExtent:pt,children:[g.jsx(xc,{onInit:u,onNodeClick:a,onEdgeClick:l,onNodeMouseEnter:v,onNodeMouseMove:h,onNodeMouseLeave:b,onNodeContextMenu:S,onNodeDoubleClick:E,nodeTypes:r,edgeTypes:i,connectionLineType:H,connectionLineStyle:X,connectionLineComponent:$,connectionLineContainerStyle:B,selectionKeyCode:G,selectionOnDrag:F,selectionMode:K,deleteKeyCode:Y,multiSelectionKeyCode:U,panActivationKeyCode:Q,zoomActivationKeyCode:Z,onlyRenderVisibleElements:te,defaultViewport:Ze,translateExtent:Ot,minZoom:ve,maxZoom:$e,preventScrolling:as,zoomOnScroll:ls,zoomOnPinch:ds,zoomOnDoubleClick:hs,panOnScroll:us,panOnScrollSpeed:fs,panOnScrollMode:gs,panOnDrag:ps,onPaneClick:ms,onPaneMouseEnter:xs,onPaneMouseMove:ys,onPaneMouseLeave:ws,onPaneScroll:bs,onPaneContextMenu:vs,paneClickDistance:Yt,nodeClickDistance:Ns,onSelectionContextMenu:_,onSelectionStart:j,onSelectionEnd:I,onReconnect:Cs,onReconnectStart:Ss,onReconnectEnd:ks,onEdgeContextMenu:Ms,onEdgeDoubleClick:js,onEdgeMouseEnter:Is,onEdgeMouseMove:Ps,onEdgeMouseLeave:As,reconnectRadius:$s,defaultMarkerColor:cs,noDragClassName:_s,noWheelClassName:Ts,noPanClassName:Wt,rfId:mt,disableKeyboardA11y:qt,nodeExtent:pt,viewport:Qs,onViewportChange:Js}),g.jsx(Ji,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:f,onConnectStart:p,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:y,nodesDraggable:ie,autoPanOnNodeFocus:de,nodesConnectable:Ge,nodesFocusable:qe,edgesFocusable:Pe,edgesReconnectable:Ae,elementsSelectable:ht,elevateNodesOnSelect:Vs,elevateEdgesOnSelect:Fs,minZoom:ve,maxZoom:$e,nodeExtent:pt,onNodesChange:Ls,onEdgesChange:Ds,snapToGrid:q,snapGrid:J,connectionMode:V,translateExtent:Ot,connectOnClick:Hs,defaultEdgeOptions:Rs,fitView:Xt,fitViewOptions:Gt,onNodesDelete:O,onEdgesDelete:T,onDelete:k,onNodeDragStart:C,onNodeDrag:P,onNodeDragStop:M,onSelectionDrag:L,onSelectionDragStart:D,onSelectionDragStop:z,onMove:m,onMoveStart:d,onMoveEnd:c,noPanClassName:Wt,nodeOrigin:Ke,rfId:mt,autoPanOnConnect:Os,autoPanOnNodeDrag:Ys,autoPanSpeed:Ws,onError:qs,connectionRadius:Xs,isValidConnection:Gs,selectNodesOnDrag:ne,nodeDragThreshold:Zs,connectionDragThreshold:Us,onBeforeDelete:R,paneClickDistance:Yt,debug:or,ariaLabelConfig:sr}),g.jsx(Ki,{onSelectionChange:A}),Es,g.jsx(Yi,{proOptions:Bs,position:zs}),g.jsx(Oi,{rfId:mt,disableKeyboardA11y:qt})]})})}var Ec=Lo(Nc);function Cc(e){const[t,n]=N.useState(e),s=N.useCallback(o=>n(r=>Ao(o,r)),[]);return[t,n,s]}function Sc(e){const[t,n]=N.useState(e),s=N.useCallback(o=>n(r=>$o(o,r)),[]);return[t,n,s]}function kc({dimensions:e,lineWidth:t,variant:n,className:s}){return g.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:re(["react-flow__background-pattern",n,s])})}function Mc({radius:e,className:t}){return g.jsx("circle",{cx:e,cy:e,r:e,className:re(["react-flow__background-pattern","dots",t])})}var ue;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ue||(ue={}));const jc={[ue.Dots]:1,[ue.Lines]:1,[ue.Cross]:6},Ic=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function os({id:e,variant:t=ue.Dots,gap:n=20,size:s,lineWidth:o=1,offset:r=0,color:i,bgColor:a,style:l,className:u,patternClassName:m}){const d=N.useRef(null),{transform:c,patternId:f}=ee(Ic,se),p=s||jc[t],x=t===ue.Dots,w=t===ue.Cross,y=Array.isArray(n)?n:[n,n],v=[y[0]*c[2]||1,y[1]*c[2]||1],h=p*c[2],b=Array.isArray(r)?r:[r,r],S=w?[h,h]:v,E=[b[0]*c[2]||1+S[0]/2,b[1]*c[2]||1+S[1]/2],C=`${f}${e||""}`;return g.jsxs("svg",{className:re(["react-flow__background",u]),style:{...l,...ft,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:d,"data-testid":"rf__background",children:[g.jsx("pattern",{id:C,x:c[0]%v[0],y:c[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:x?g.jsx(Mc,{radius:h/2,className:m}):g.jsx(kc,{dimensions:S,lineWidth:o,variant:t,className:m})}),g.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${C})`})]})}os.displayName="Background";const Pc=N.memo(os);function Ac(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:g.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function $c(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:g.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Lc(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:g.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Dc(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:g.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function _c(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:g.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function tt({children:e,className:t,...n}){return g.jsx("button",{type:"button",className:re(["react-flow__controls-button",t]),...n,children:e})}const Tc=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function ss({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:o,onZoomIn:r,onZoomOut:i,onFitView:a,onInteractiveChange:l,className:u,children:m,position:d="bottom-left",orientation:c="vertical","aria-label":f}){const p=oe(),{isInteractive:x,minZoomReached:w,maxZoomReached:y,ariaLabelConfig:v}=ee(Tc,se),{zoomIn:h,zoomOut:b,fitView:S}=Vt(),E=()=>{h(),r==null||r()},C=()=>{b(),i==null||i()},P=()=>{S(o),a==null||a()},M=()=>{p.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),l==null||l(!x)},O=c==="horizontal"?"horizontal":"vertical";return g.jsxs(ut,{className:re(["react-flow__controls",O,u]),position:d,style:e,"data-testid":"rf__controls","aria-label":f??v["controls.ariaLabel"],children:[t&&g.jsxs(g.Fragment,{children:[g.jsx(tt,{onClick:E,className:"react-flow__controls-zoomin",title:v["controls.zoomIn.ariaLabel"],"aria-label":v["controls.zoomIn.ariaLabel"],disabled:y,children:g.jsx(Ac,{})}),g.jsx(tt,{onClick:C,className:"react-flow__controls-zoomout",title:v["controls.zoomOut.ariaLabel"],"aria-label":v["controls.zoomOut.ariaLabel"],disabled:w,children:g.jsx($c,{})})]}),n&&g.jsx(tt,{className:"react-flow__controls-fitview",onClick:P,title:v["controls.fitView.ariaLabel"],"aria-label":v["controls.fitView.ariaLabel"],children:g.jsx(Lc,{})}),s&&g.jsx(tt,{className:"react-flow__controls-interactive",onClick:M,title:v["controls.interactive.ariaLabel"],"aria-label":v["controls.interactive.ariaLabel"],children:x?g.jsx(_c,{}):g.jsx(Dc,{})}),m]})}ss.displayName="Controls";const Hc=N.memo(ss);function zc({id:e,x:t,y:n,width:s,height:o,style:r,color:i,strokeColor:a,strokeWidth:l,className:u,borderRadius:m,shapeRendering:d,selected:c,onClick:f}){const{background:p,backgroundColor:x}=r||{},w=i||p||x;return g.jsx("rect",{className:re(["react-flow__minimap-node",{selected:c},u]),x:t,y:n,rx:m,ry:m,width:s,height:o,style:{fill:w,stroke:a,strokeWidth:l},shapeRendering:d,onClick:f?y=>f(y,e):void 0})}const Bc=N.memo(zc),Rc=e=>e.nodes.map(t=>t.id),Nt=e=>e instanceof Function?e:()=>e;function Vc({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:o,nodeComponent:r=Bc,onClick:i}){const a=ee(Rc,se),l=Nt(t),u=Nt(e),m=Nt(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return g.jsx(g.Fragment,{children:a.map(c=>g.jsx(Oc,{id:c,nodeColorFunc:l,nodeStrokeColorFunc:u,nodeClassNameFunc:m,nodeBorderRadius:s,nodeStrokeWidth:o,NodeComponent:r,onClick:i,shapeRendering:d},c))})}function Fc({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:o,nodeStrokeWidth:r,shapeRendering:i,NodeComponent:a,onClick:l}){const{node:u,x:m,y:d,width:c,height:f}=ee(p=>{const{internals:x}=p.nodeLookup.get(e),w=x.userNode,{x:y,y:v}=x.positionAbsolute,{width:h,height:b}=fe(w);return{node:w,x:y,y:v,width:h,height:b}},se);return!u||u.hidden||!so(u)?null:g.jsx(a,{x:m,y:d,width:c,height:f,style:u.style,selected:!!u.selected,className:s(u),color:t(u),borderRadius:o,strokeColor:n(u),strokeWidth:r,shapeRendering:i,onClick:l,id:u.id})}const Oc=N.memo(Fc);var Yc=N.memo(Vc);const Wc=200,Xc=150,Gc=e=>!e.hidden,qc=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?oo(Ye(e.nodeLookup,{filter:Gc}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Kc="react-flow__minimap-desc";function rs({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:o="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:l,maskColor:u,maskStrokeColor:m,maskStrokeWidth:d,position:c="bottom-right",onClick:f,onNodeClick:p,pannable:x=!1,zoomable:w=!1,ariaLabel:y,inversePan:v,zoomStep:h=1,offsetScale:b=5}){const S=oe(),E=N.useRef(null),{boundingRect:C,viewBB:P,rfId:M,panZoom:O,translateExtent:T,flowWidth:k,flowHeight:A,ariaLabelConfig:D}=ee(qc,se),L=(e==null?void 0:e.width)??Wc,z=(e==null?void 0:e.height)??Xc,_=C.width/L,j=C.height/z,I=Math.max(_,j),R=I*L,V=I*z,H=b*I,X=C.x-(R-C.width)/2-H,$=C.y-(V-C.height)/2-H,B=R+H*2,Y=V+H*2,G=`${Kc}-${M}`,F=N.useRef(0),K=N.useRef();F.current=I,N.useEffect(()=>{if(E.current&&O)return K.current=bi({domNode:E.current,panZoom:O,getTransform:()=>S.getState().transform,getViewScale:()=>F.current}),()=>{var q;(q=K.current)==null||q.destroy()}},[O]),N.useEffect(()=>{var q;(q=K.current)==null||q.update({translateExtent:T,width:k,height:A,inversePan:v,pannable:x,zoomStep:h,zoomable:w})},[x,w,v,h,T,k,A]);const Q=f?q=>{var ne;const[J,te]=((ne=K.current)==null?void 0:ne.pointer(q))||[0,0];f(q,{x:J,y:te})}:void 0,U=p?N.useCallback((q,J)=>{const te=S.getState().nodeLookup.get(J).internals.userNode;p(q,te)},[]):void 0,Z=y??D["minimap.ariaLabel"];return g.jsx(ut,{position:c,style:{...e,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof m=="string"?m:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*I:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:re(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:g.jsxs("svg",{width:L,height:z,viewBox:`${X} ${$} ${B} ${Y}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":G,ref:E,onClick:Q,children:[Z&&g.jsx("title",{id:G,children:Z}),g.jsx(Yc,{onClick:U,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:a}),g.jsx("path",{className:"react-flow__minimap-mask",d:`M${X-H},${$-H}h${B+H*2}v${Y+H*2}h${-B-H*2}z
        M${P.x},${P.y}h${P.width}v${P.height}h${-P.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}rs.displayName="MiniMap";const Zc=N.memo(rs),Uc=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Qc={[be.Line]:"right",[be.Handle]:"bottom-right"};function Jc({nodeId:e,position:t,variant:n=be.Handle,className:s,style:o=void 0,children:r,color:i,minWidth:a=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:m=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:c,autoScale:f=!0,shouldResize:p,onResizeStart:x,onResize:w,onResizeEnd:y}){const v=Ho(),h=typeof e=="string"?e:v,b=oe(),S=N.useRef(null),E=n===be.Handle,C=ee(N.useCallback(Uc(E&&f),[E,f]),se),P=N.useRef(null),M=t??Qc[n];N.useEffect(()=>{if(!(!S.current||!h))return P.current||(P.current=Ti({domNode:S.current,nodeId:h,getStoreItems:()=>{const{nodeLookup:T,transform:k,snapGrid:A,snapToGrid:D,nodeOrigin:L,domNode:z}=b.getState();return{nodeLookup:T,transform:k,snapGrid:A,snapToGrid:D,nodeOrigin:L,paneDomNode:z}},onChange:(T,k)=>{const{triggerNodeChanges:A,nodeLookup:D,parentLookup:L,nodeOrigin:z}=b.getState(),_=[],j={x:T.x,y:T.y},I=D.get(h);if(I&&I.expandParent&&I.parentId){const R=I.origin??z,V=T.width??I.measured.width??0,H=T.height??I.measured.height??0,X={id:I.id,parentId:I.parentId,rect:{width:V,height:H,...ro({x:T.x??I.position.x,y:T.y??I.position.y},{width:V,height:H},I.parentId,D,R)}},$=Rt([X],D,L,z);_.push(...$),j.x=T.x?Math.max(R[0]*V,T.x):void 0,j.y=T.y?Math.max(R[1]*H,T.y):void 0}if(j.x!==void 0&&j.y!==void 0){const R={id:h,type:"position",position:{...j}};_.push(R)}if(T.width!==void 0&&T.height!==void 0){const V={id:h,type:"dimensions",resizing:!0,setAttributes:c?c==="horizontal"?"width":"height":!0,dimensions:{width:T.width,height:T.height}};_.push(V)}for(const R of k){const V={...R,type:"position"};_.push(V)}A(_)},onEnd:({width:T,height:k})=>{const A={id:h,type:"dimensions",resizing:!1,dimensions:{width:T,height:k}};b.getState().triggerNodeChanges([A])}})),P.current.update({controlPosition:M,boundaries:{minWidth:a,minHeight:l,maxWidth:u,maxHeight:m},keepAspectRatio:d,resizeDirection:c,onResizeStart:x,onResize:w,onResizeEnd:y,shouldResize:p}),()=>{var T;(T=P.current)==null||T.destroy()}},[M,a,l,u,m,d,x,w,y,p]);const O=M.split("-");return g.jsx("div",{className:re(["react-flow__resize-control","nodrag",...O,n,s]),ref:S,style:{...o,scale:C,...i&&{[E?"backgroundColor":"borderColor"]:i}},children:r})}const Rn=N.memo(Jc);function el({nodeId:e,isVisible:t=!0,handleClassName:n,handleStyle:s,lineClassName:o,lineStyle:r,color:i,minWidth:a=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:m=Number.MAX_VALUE,keepAspectRatio:d=!1,autoScale:c=!0,shouldResize:f,onResizeStart:p,onResize:x,onResizeEnd:w}){return t?g.jsxs(g.Fragment,{children:[Pi.map(y=>g.jsx(Rn,{className:o,style:r,nodeId:e,position:y,variant:be.Line,color:i,minWidth:a,minHeight:l,maxWidth:u,maxHeight:m,onResizeStart:p,keepAspectRatio:d,autoScale:c,shouldResize:f,onResize:x,onResizeEnd:w},y)),Ii.map(y=>g.jsx(Rn,{className:n,style:s,nodeId:e,position:y,color:i,minWidth:a,minHeight:l,maxWidth:u,maxHeight:m,onResizeStart:p,keepAspectRatio:d,autoScale:c,shouldResize:f,onResize:x,onResizeEnd:w},y))]}):null}function tl({onDragStart:e,onAutoLayout:t}){const n=[{type:"default",icon:lr,label:""},{type:"noteCard",icon:Gn,label:""},{type:"group",icon:Ar,label:""}];return g.jsxs("div",{className:"absolute left-4 top-20 z-10 bg-white/95 backdrop-blur-sm border border-gray-200 rounded-lg shadow-lg p-2",children:[g.jsx("div",{className:"space-y-1",children:n.map(({type:s,icon:o,label:r})=>g.jsx("div",{draggable:!0,onDragStart:i=>e(i,s),className:"p-2 rounded-md cursor-move hover:bg-blue-50 transition-colors border border-transparent hover:border-blue-200",title:r,children:g.jsx(o,{className:"h-5 w-5 text-gray-700"})},s))}),g.jsx("div",{className:"border-t border-gray-200 my-2"}),t&&g.jsx("button",{onClick:t,className:"p-2 rounded-md hover:bg-purple-50 transition-colors border border-transparent hover:border-purple-200 w-full",title:"",children:g.jsx(Pr,{className:"h-5 w-5 text-gray-700"})})]})}function nl({data:e,selected:t}){const n=e.color||"#ffffff",s=e.preview||e.label||"",o=e.title||"",r=()=>{e.onEdit&&e.onEdit()};return g.jsxs("div",{className:`note-card-node ${t?"selected":""} group`,style:{backgroundColor:n,border:t?"2px solid #3b82f6":"1px solid #e5e7eb",borderRadius:"8px",padding:"12px",minWidth:"200px",maxWidth:"300px",boxShadow:t?"0 4px 12px rgba(59, 130, 246, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",cursor:e.noteUuid?"pointer":"default",position:"relative"},onDoubleClick:r,title:e.noteUuid?"":void 0,children:[g.jsx(me,{type:"target",position:W.Top}),g.jsx(me,{type:"source",position:W.Bottom}),g.jsx(me,{type:"target",position:W.Left}),g.jsx(me,{type:"source",position:W.Right}),e.noteUuid&&g.jsx("button",{onClick:i=>{i.stopPropagation(),e.onEdit&&e.onEdit()},className:"absolute top-2 right-2 p-1.5 bg-white rounded-md shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-gray-100",title:"",children:g.jsx(Er,{className:"h-3.5 w-3.5 text-gray-600"})}),g.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[g.jsx(Et,{className:"h-4 w-4 text-gray-500 flex-shrink-0 mt-0.5"}),g.jsx("h3",{className:"text-sm font-semibold text-gray-900 flex-1 break-words",children:o})]}),g.jsx("div",{className:"text-xs text-gray-600 mb-2 line-clamp-3 break-words",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s}),e.tags&&e.tags.length>0&&g.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[g.jsx(Cr,{className:"h-3 w-3 text-gray-400"}),e.tags.slice(0,3).map((i,a)=>g.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:i},a)),e.tags.length>3&&g.jsxs("span",{className:"text-xs text-gray-400",children:["+",e.tags.length-3]})]})]})}const ol=N.memo(nl);function sl({data:e,selected:t}){var o;const n=e.color||"rgba(147, 197, 253, 0.1)",s=((o=e.color)==null?void 0:o.replace("0.1","0.3"))||"rgba(147, 197, 253, 0.3)";return g.jsxs(g.Fragment,{children:[g.jsx(el,{color:s,isVisible:t,minWidth:200,minHeight:150}),g.jsxs("div",{className:"group-node",style:{width:"100%",height:"100%",backgroundColor:n,border:`2px ${t?"solid":"dashed"} ${s}`,borderRadius:"12px",padding:"16px",position:"relative"},children:[g.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",right:"12px",backgroundColor:"white",padding:"6px 12px",borderRadius:"6px",border:`1px solid ${s}`,boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[g.jsx("div",{className:"text-sm font-semibold text-gray-700",children:e.label||""}),e.description&&g.jsx("div",{className:"text-xs text-gray-500 mt-1",children:e.description})]}),!t&&g.jsx("div",{style:{position:"absolute",bottom:"12px",right:"12px",fontSize:"11px",color:"#9ca3af",fontStyle:"italic"},children:""})]})]})}const rl=N.memo(sl),At=[{name:"",value:"#ffffff",rgba:"rgba(255, 255, 255, 1)"},{name:"",value:"#f3f4f6",rgba:"rgba(243, 244, 246, 1)"},{name:"",value:"#dbeafe",rgba:"rgba(219, 234, 254, 1)"},{name:"",value:"#d1fae5",rgba:"rgba(209, 250, 229, 1)"},{name:"",value:"#fef3c7",rgba:"rgba(254, 243, 199, 1)"},{name:"",value:"#fed7aa",rgba:"rgba(254, 215, 170, 1)"},{name:"",value:"#fecaca",rgba:"rgba(254, 202, 202, 1)"},{name:"",value:"#e9d5ff",rgba:"rgba(233, 213, 255, 1)"},{name:"",value:"#fbcfe8",rgba:"rgba(251, 207, 232, 1)"}];function il({id:e,top:t,left:n,right:s,bottom:o,onDelete:r,onDuplicate:i,onChangeColor:a,onEdit:l,onClose:u}){const[m,d]=N.useState(!1);N.useEffect(()=>{const f=()=>u();return document.addEventListener("click",f),()=>document.removeEventListener("click",f)},[u]);const c=N.useCallback(f=>{a&&a(f),d(!1),u()},[a,u]);return g.jsxs("div",{style:{position:"absolute",top:t,left:n,right:s,bottom:o,zIndex:1e3},className:"bg-white rounded-lg shadow-lg border border-gray-200 py-1 min-w-[180px]",onClick:f=>f.stopPropagation(),children:[l&&g.jsxs("button",{onClick:()=>{l(),u()},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[g.jsx(Ir,{className:"h-4 w-4"}),""]}),a&&g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>d(!m),className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[g.jsx(kr,{className:"h-4 w-4"}),""]}),m&&g.jsx("div",{className:"absolute left-full top-0 ml-1 bg-white border border-gray-200 rounded-lg shadow-lg p-2 z-10",children:g.jsx("div",{className:"grid grid-cols-3 gap-1",children:At.map(f=>g.jsx("button",{onClick:()=>c(f.value),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-blue-500 transition-all",style:{backgroundColor:f.value},title:f.name},f.value))})})]}),i&&g.jsxs("button",{onClick:()=>{i(),u()},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[g.jsx(Sr,{className:"h-4 w-4"}),""]}),g.jsx("div",{className:"border-t border-gray-200 my-1"}),g.jsxs("button",{onClick:()=>{r(),u()},className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left",children:[g.jsx(dr,{className:"h-4 w-4"}),""]})]})}function al({noteUuid:e,onClose:t,onSave:n}){const{toast:s}=Vn(),o=Fn(),[r,i]=N.useState(""),[a,l]=N.useState(""),{data:u,isLoading:m}=$t({queryKey:["note",e],queryFn:()=>Ct.getDetail(e),enabled:!!e}),d=On({mutationFn:p=>Ct.update(e,p),onSuccess:p=>{o.invalidateQueries({queryKey:["note",e]}),o.invalidateQueries({queryKey:["notes"]}),s({title:"",description:""}),n&&n(p),t()},onError:p=>{s({title:"",description:p.message,variant:"destructive"})}});N.useEffect(()=>{u&&(i(u.title||""),l(u.content||""))},[u]);const c=()=>{if(!r.trim()){s({title:"",description:"",variant:"destructive"});return}d.mutate({title:r.trim(),content:a.trim()})},f=p=>{(p.metaKey||p.ctrlKey)&&p.key==="s"&&(p.preventDefault(),c()),p.key==="Escape"&&t()};return g.jsx(g.Fragment,{children:g.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",onClick:t,children:g.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col",onClick:p=>p.stopPropagation(),onKeyDown:f,children:[g.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[g.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:""}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("button",{onClick:c,disabled:d.isPending||m,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d.isPending?g.jsxs(g.Fragment,{children:[g.jsx(Te,{className:"h-4 w-4 animate-spin"}),"..."]}):g.jsxs(g.Fragment,{children:[g.jsx(qn,{className:"h-4 w-4"}),""]})}),g.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:g.jsx(ur,{className:"h-5 w-5 text-gray-500"})})]})]}),g.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:m?g.jsx("div",{className:"flex items-center justify-center h-64",children:g.jsx(Te,{className:"h-8 w-8 animate-spin text-gray-400"})}):g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),g.jsx("input",{type:"text",value:r,onChange:p=>i(p.target.value),placeholder:"...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),g.jsx("textarea",{value:a,onChange:p=>l(p.target.value),placeholder:"...",rows:12,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none font-mono text-sm"})]})]})}),g.jsxs("div",{className:"px-6 py-3 border-t bg-gray-50 text-xs text-gray-500",children:[":  ",g.jsx("kbd",{className:"px-1.5 py-0.5 bg-white border rounded",children:"Cmd/Ctrl + S"}),"   ",g.jsx("kbd",{className:"px-1.5 py-0.5 bg-white border rounded",children:"Esc"})," "]})]})})})}function cl({onClose:e}){const[t,n]=N.useState(""),{data:s,isLoading:o}=$t({queryKey:["notes","whiteboard-sidebar",t],queryFn:()=>Ct.getPage({page:1,rows:100,keyword:t||void 0})}),r=(s==null?void 0:s.items)||[],i=(l,u)=>{console.log(" Drag start:",u.uuid,u.title),l.dataTransfer.setData("note-uuid",u.uuid),l.dataTransfer.setData("note-title",u.title),l.dataTransfer.setData("note-content",u.content||""),l.dataTransfer.effectAllowed="copy",l.currentTarget instanceof HTMLElement&&(l.currentTarget.style.opacity="0.5")},a=l=>{l.currentTarget instanceof HTMLElement&&(l.currentTarget.style.opacity="1")};return g.jsxs("div",{className:"h-full flex flex-col bg-white border-l border-gray-200",children:[g.jsxs("div",{className:"flex-shrink-0 px-4 py-3 border-b border-gray-200",children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsxs("h2",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[g.jsx(Gn,{className:"h-4 w-4"}),""]}),e&&g.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:g.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"relative",children:[g.jsx(fr,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),g.jsx(gr,{type:"text",placeholder:"...",value:t,onChange:l=>n(l.target.value),className:"pl-9 h-9 text-sm"})]})]}),g.jsx(hr,{className:"flex-1",children:g.jsx("div",{className:"p-2",children:o?g.jsx("div",{className:"flex items-center justify-center py-12",children:g.jsx(Te,{className:"h-6 w-6 animate-spin text-gray-400"})}):r.length===0?g.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[g.jsx(Et,{className:"h-12 w-12 text-gray-300 mb-3"}),g.jsx("p",{className:"text-sm text-gray-500",children:t?"":""}),g.jsx("p",{className:"text-xs text-gray-400 mt-1",children:!t&&""})]}):g.jsx("div",{className:"space-y-1",children:r.map(l=>g.jsxs("div",{draggable:!0,onDragStart:u=>i(u,l),onDragEnd:a,className:"group px-3 py-2.5 rounded-md hover:bg-blue-50 cursor-move transition-all duration-200 border border-transparent hover:border-blue-200",title:"",children:[g.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[g.jsx(Et,{className:"h-4 w-4 text-gray-400 flex-shrink-0 mt-0.5"}),g.jsx("h3",{className:"text-sm font-medium text-gray-900 line-clamp-2 flex-1",children:l.title||""})]}),l.content&&g.jsx("p",{className:"text-xs text-gray-500 line-clamp-2 ml-6",children:l.content.substring(0,80)}),g.jsxs("div",{className:"ml-6 mt-1 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[g.jsx("svg",{className:"h-3 w-3 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),g.jsx("span",{className:"text-xs text-blue-600",children:""})]}),g.jsx("div",{className:"text-xs text-gray-400 mt-1 ml-6",children:new Date(l.updated_at).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})})]},l.uuid))})})}),g.jsx("div",{className:"flex-shrink-0 px-4 py-3 border-t border-gray-200 bg-gray-50",children:g.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500",children:[g.jsx("svg",{className:"h-4 w-4 text-gray-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("p",{className:"leading-relaxed",children:""})]})})]})}function ll(e,t,n="TB"){const s=new tn.graphlib.Graph;s.setDefaultEdgeLabel(()=>({}));const o=250,r=150;return s.setGraph({rankdir:n,nodesep:80,ranksep:120,edgesep:50}),e.forEach(a=>{let l=o,u=r;a.type==="noteCard"?(l=300,u=180):a.type==="group"?(l=400,u=300):(a.type==="input"||a.type==="output")&&(l=180,u=80),s.setNode(a.id,{width:l,height:u})}),t.forEach(a=>{s.setEdge(a.source,a.target)}),tn.layout(s),{nodes:e.map(a=>{const l=s.node(a.id);return{...a,position:{x:l.x-l.width/2,y:l.y-l.height/2}}}),edges:t}}const dl=[],ul=[];let is=0;const Le=()=>`node_${is++}`;function fl({uuid:e,onSave:t,onError:n}){const s=Fn(),{toast:o}=Vn(),[r,i]=N.useState(!1),a=N.useRef(null),[l,u]=N.useState(null),[m,d,c]=Cc(dl),[f,p,x]=Sc(ul),[w,y]=N.useState(null),[v,h]=N.useState(null),[b,S]=N.useState(!0),E=N.useMemo(()=>({noteCard:ol,group:rl}),[]),{data:C,isLoading:P,error:M}=$t({queryKey:["whiteboard",e],queryFn:()=>Ut.getDetail(e),enabled:!!e}),O=On({mutationFn:$=>Ut.update(e,$),onSuccess:$=>{s.invalidateQueries({queryKey:["whiteboard",e]}),s.invalidateQueries({queryKey:["whiteboards"]}),o({title:"",description:""}),t&&t($)},onError:$=>{o({title:"",description:($==null?void 0:$.message)||"",variant:"destructive"}),n&&n($)}});N.useEffect(()=>{M&&n&&n(M)},[M,n]);const T=N.useCallback($=>p(B=>go($,B)),[p]),k=N.useCallback(($,B,Y)=>{console.log(" Toolbox drag start:",B,Y),$.dataTransfer.setData("application/reactflow-type",B),Y&&$.dataTransfer.setData("application/reactflow-edgetype",Y),$.dataTransfer.effectAllowed="copy"},[]),A=N.useCallback($=>{h($)},[]),D=N.useCallback($=>{d(B=>B.map(Y=>{var G;return Y.data.noteUuid===$.uuid?{...Y,data:{...Y.data,title:$.title,preview:((G=$.content)==null?void 0:G.substring(0,100))||""}}:Y}))},[d]),L=N.useCallback($=>{$.preventDefault(),$.dataTransfer.dropEffect="copy"},[]),z=N.useCallback($=>{$.preventDefault();const B=$.dataTransfer.getData("application/reactflow-type"),Y=$.dataTransfer.getData("note-uuid"),G=$.dataTransfer.getData("note-title"),F=$.dataTransfer.getData("note-content");if(console.log(" onDrop triggered:",{type:B,noteUuid:Y,noteTitle:G,noteContent:F}),!l||!a.current){console.log(" ReactFlow instance or wrapper not ready");return}const K=a.current.getBoundingClientRect(),Q=l.screenToFlowPosition({x:$.clientX-K.left,y:$.clientY-K.top});if(Y){console.log(" Creating note card:",Y,G);const Z={id:Le(),type:"noteCard",position:Q,data:{title:G||"",preview:(F==null?void 0:F.substring(0,100))||"...",tags:[],color:At[2].value,noteUuid:Y,onEdit:()=>A(Y)}};d(q=>q.concat(Z)),o({title:"",description:`"${G}" `});return}if(B==="edge"){o({title:"",description:""});return}if(typeof B>"u"||!B)return;let U;B==="noteCard"?U={id:Le(),type:"noteCard",position:Q,data:{title:"",preview:"...",tags:[],color:At[2].value,onEdit:void 0}}:B==="group"?U={id:Le(),type:"group",position:Q,data:{label:"",color:"rgba(147, 197, 253, 0.15)"},style:{width:400,height:300}}:U={id:Le(),type:B,position:Q,data:{label:B==="input"?"":B==="output"?"":""}},d(Z=>Z.concat(U))},[l,d,o,A]);N.useEffect(()=>{C&&!r&&(i(!0),console.log(":",C),C.snapshot&&C.snapshot.nodes&&C.snapshot.edges&&(d(C.snapshot.nodes),p(C.snapshot.edges),is=C.snapshot.nodes.reduce((B,Y)=>{const G=parseInt(Y.id.replace("node_",""));return isNaN(G)?B:Math.max(B,G)},0)+1))},[C,r,d,p]);const _=N.useCallback(()=>{const $={nodes:m,edges:f,timestamp:new Date().toISOString()};O.mutate({snapshot:$})},[m,f,O]),j=N.useCallback(()=>{if(!l){o({title:"",description:""});return}if(m.length===0){l.fitView({padding:.2,duration:800});return}const{nodes:$,edges:B}=ll(m,f,"TB");d($),p(B),setTimeout(()=>{l.fitView({padding:.2,duration:800,maxZoom:1.5,minZoom:.1})},50),o({title:"",description:""})},[m,f,d,p,l,o]),I=N.useCallback(($,B)=>{$.preventDefault(),y({id:B.id,top:$.clientY,left:$.clientX,nodeType:B.type})},[]),R=N.useCallback(()=>{w&&(d($=>$.filter(B=>B.id!==w.id)),p($=>$.filter(B=>B.source!==w.id&&B.target!==w.id)),y(null),o({title:"",description:""}))},[w,d,p,o]),V=N.useCallback(()=>{if(!w)return;const $=m.find(Y=>Y.id===w.id);if(!$)return;const B={...$,id:Le(),position:{x:$.position.x+50,y:$.position.y+50}};d(Y=>Y.concat(B)),y(null),o({title:"",description:""})},[w,m,d,o]),H=N.useCallback($=>{w&&(d(B=>B.map(Y=>Y.id===w.id?{...Y,data:{...Y.data,color:$}}:Y)),y(null))},[w,d]),X=N.useCallback(()=>{y(null)},[]);return P?g.jsx("div",{className:"flex items-center justify-center h-screen",children:g.jsx(Te,{className:"h-8 w-8 animate-spin text-gray-400"})}):M?g.jsx("div",{className:"flex items-center justify-center h-screen",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:""}),g.jsx("p",{className:"text-sm text-gray-600",children:(M==null?void 0:M.message)||""})]})}):C?g.jsxs("div",{className:"h-screen w-full flex flex-col bg-white",children:[g.jsx("div",{className:"flex-shrink-0 border-b bg-background px-4 py-3",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:C.title}),C.description&&g.jsx("p",{className:"text-sm text-gray-600 mt-1",children:C.description})]}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsxs("button",{onClick:()=>S(!b),className:"flex items-center gap-2 px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition-colors",title:b?"":"",children:[b?g.jsx(Mr,{className:"h-4 w-4"}):g.jsx(jr,{className:"h-4 w-4"}),g.jsxs("span",{className:"text-sm",children:[b?"":"",""]})]}),g.jsx("button",{onClick:_,disabled:O.isPending,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:O.isPending?g.jsxs(g.Fragment,{children:[g.jsx(Te,{className:"h-4 w-4 animate-spin"}),"..."]}):g.jsxs(g.Fragment,{children:[g.jsx(qn,{className:"h-4 w-4"}),""]})})]})]})}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsxs("div",{className:"flex-1 overflow-hidden",ref:a,children:[g.jsxs(Ec,{nodes:m,edges:f,onNodesChange:c,onEdgesChange:x,onConnect:T,onInit:u,onDrop:z,onDragOver:L,onNodeContextMenu:I,onPaneClick:X,nodeTypes:E,fitView:!0,attributionPosition:"bottom-left",children:[g.jsx(Hc,{}),g.jsx(Zc,{nodeColor:$=>$.type==="noteCard"?"#dbeafe":$.type==="group"?"#93c5fd":$.type==="input"?"#d1fae5":$.type==="output"?"#fecaca":"#f3f4f6",maskColor:"rgba(0, 0, 0, 0.05)"}),g.jsx(Pc,{variant:ue.Dots,gap:12,size:1}),g.jsx(tl,{onDragStart:k,onAutoLayout:j})]}),w&&g.jsx(il,{id:w.id,top:w.top,left:w.left,onDelete:R,onDuplicate:V,onChangeColor:H,onClose:()=>y(null)})]}),b&&g.jsx("div",{className:"w-80 flex-shrink-0",children:g.jsx(cl,{onClose:()=>S(!1)})})]}),v&&g.jsx(al,{noteUuid:v,onClose:()=>h(null),onSave:D})]}):g.jsx("div",{className:"flex items-center justify-center h-screen",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:""}),g.jsx("p",{className:"text-sm text-gray-600",children:""})]})})}function gl(){const{uuid:e}=pr({from:"/_auth_custom_layout/whiteboard/$uuid"});return g.jsx(fl,{uuid:e})}const El=mr("/_auth_custom_layout/whiteboard/$uuid")({component:gl});export{El as Route};
