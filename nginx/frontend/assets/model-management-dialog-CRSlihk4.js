import{c as Y,ad as h,r as m,j as e,D as I,d as $,e as T,f as L,L as u,I as b,B as w,a as te,T as q}from"./index-QCM3tg6T.js";import{T as ae}from"./textarea-BRLhZEOX.js";import{S as A}from"./switch-Dx-NYZfn.js";import{E as ie}from"./eye-5ZjLGcoG.js";import{C as re}from"./checkbox-BToW39pY.js";import{C as z}from"./circle-check-big-OsbAB31v.js";import{S as B}from"./square-pen-BEuFlBVg.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=Y("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=Y("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),M={getProviders:async a=>(await h.post("/aimodel/provider/page",a)).data,getProvider:async a=>(await h.post(`/aimodel/provider/detail/${a}`)).data,createProvider:async a=>(await h.post("/aimodel/provider/create",a)).data,updateProvider:async(a,l)=>(await h.post(`/aimodel/provider/update/${a}`,l)).data,deleteProvider:async a=>{await h.post(`/aimodel/provider/delete/${a}`)}},C={getModels:async a=>(await h.post("/aimodel/model/page",a)).data,getModel:async a=>(await h.post(`/aimodel/model/detail/${a}`)).data,createModel:async a=>(await h.post("/aimodel/model/create",a)).data,updateModel:async(a,l)=>(await h.post(`/aimodel/model/update/${a}`,l)).data,deleteModel:async a=>{await h.post(`/aimodel/model/delete/${a}`)},setDefaultModel:async a=>(await h.post(`/aimodel/model/set-default/${a}`)).data};function le({open:a,onOpenChange:l,provider:t,onSave:g}){const[x,o]=m.useState({name:"",description:"",api_base_url:"",api_secret:"",is_active:!0}),[p,r]=m.useState(!1);m.useEffect(()=>{o(t?{name:t.name||"",description:t.description||"",api_base_url:t.api_base_url||"",api_secret:t.api_secret||"",is_active:t.is_active}:{name:"",description:"",api_base_url:"",api_secret:"",is_active:!0}),r(!1)},[t,a]);const v=n=>{if(n.preventDefault(),x.name.trim()){const _={...x,display_name:x.name};g(_)}},j=(n,_)=>{o(N=>({...N,[n]:_}))};return e.jsx(I,{open:a,onOpenChange:l,children:e.jsxs($,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(L,{children:t?"编辑提供商":"添加提供商"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"提供商名称 *"}),e.jsx(b,{id:"name",value:x.name,onChange:n=>j("name",n.target.value),placeholder:"例如：OpenAI",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"描述"}),e.jsx(ae,{id:"description",value:x.description,onChange:n=>j("description",n.target.value),placeholder:"提供商描述信息",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"api_base_url",children:"API 基础 URL"}),e.jsx(b,{id:"api_base_url",value:x.api_base_url,onChange:n=>j("api_base_url",n.target.value),placeholder:"例如：https://api.openai.com/v1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"api_secret",children:"API 密钥"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{id:"api_secret",type:p?"text":"password",value:x.api_secret,onChange:n=>j("api_secret",n.target.value),placeholder:"例如：sk-...",className:"pr-10"}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>r(!p),children:p?e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"is_active",checked:x.is_active,onCheckedChange:n=>j("is_active",n)}),e.jsx(u,{htmlFor:"is_active",children:"启用提供商"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>l(!1),children:"取消"}),e.jsx(w,{type:"submit",children:t?"保存":"添加"})]})]})]})})}const oe=[{value:"text",label:"文本"},{value:"thinking",label:"推理"},{value:"video",label:"视频"},{value:"image",label:"图片"},{value:"audio",label:"音频"},{value:"tools",label:"工具"},{value:"search",label:"联网"},{value:"embedding",label:"嵌入"}];function ce({open:a,onOpenChange:l,model:t,provider:g,onSave:x}){const[o,p]=m.useState({llm_id:"",name:"",max_tokens:"",context_window:"",is_active:!0,is_default:!1}),[r,v]=m.useState([]);m.useEffect(()=>{var i,d;t?(p({llm_id:t.llm_id||"",name:t.name||"",max_tokens:((i=t.max_tokens)==null?void 0:i.toString())||"",context_window:((d=t.context_window)==null?void 0:d.toString())||"",is_active:t.is_active,is_default:t.is_default}),v(t.llm_type||[])):(p({llm_id:"",name:"",max_tokens:"",context_window:"",is_active:!0,is_default:!1}),v([]))},[t,a]);const j=i=>{if(i.preventDefault(),o.llm_id.trim()&&o.name.trim()&&r.length>0){const d={...o,llm_type:r,display_name:o.name,max_tokens:o.max_tokens?parseInt(o.max_tokens):void 0,context_window:o.context_window?parseInt(o.context_window):void 0};x(d)}},n=(i,d)=>{p(y=>({...y,[i]:d}))},_=i=>{p(d=>({...d,llm_id:i,name:i}))},N=(i,d)=>{v(d?y=>[...y,i]:y=>y.filter(k=>k!==i))};return e.jsx(I,{open:a,onOpenChange:l,children:e.jsxs($,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsxs(L,{children:[t?"编辑模型":"添加模型",g&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",g.name,")"]})]})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"llm_id",children:"模型标识符 *"}),e.jsx(b,{id:"llm_id",value:o.llm_id,onChange:i=>_(i.target.value),placeholder:"例如：gpt-4",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"模型名称 *"}),e.jsx(b,{id:"name",value:o.name,onChange:i=>n("name",i.target.value),placeholder:"例如：GPT-4",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"显示名称将自动与模型名称保持一致"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"模型类型 *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{id:i.value,checked:r.includes(i.value),onCheckedChange:d=>N(i.value,d)}),e.jsx(u,{htmlFor:i.value,className:"text-sm font-normal",children:i.label})]},i.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"max_tokens",children:"最大 Token 数"}),e.jsx(b,{id:"max_tokens",type:"number",value:o.max_tokens,onChange:i=>n("max_tokens",i.target.value),placeholder:"例如：8192",min:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"context_window",children:"上下文窗口大小"}),e.jsx(b,{id:"context_window",type:"number",value:o.context_window,onChange:i=>n("context_window",i.target.value),placeholder:"例如：128000",min:"1"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"is_active",checked:o.is_active,onCheckedChange:i=>n("is_active",i)}),e.jsx(u,{htmlFor:"is_active",children:"启用模型"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"is_default",checked:o.is_default,onCheckedChange:i=>n("is_default",i)}),e.jsx(u,{htmlFor:"is_default",children:"设为默认模型"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>l(!1),children:"取消"}),e.jsx(w,{type:"submit",children:t?"保存":"添加"})]})]})]})})}const R={text:"文本",thinking:"推理",video:"视频",image:"图片",audio:"音频",tools:"工具",search:"联网",embedding:"嵌入"},de=a=>Array.isArray(a)?a.map(l=>R[l]||l).join(", "):R[a]||a;function je({open:a,onOpenChange:l}){const{toast:t}=te(),[g,x]=m.useState([]),[o,p]=m.useState([]),[r,v]=m.useState(null),[j,n]=m.useState(!1),[_,N]=m.useState(!1),[i,d]=m.useState(!1),[y,k]=m.useState(!1),[P,F]=m.useState(null),[S,D]=m.useState(null),E=async()=>{try{n(!0);const s={page:1,rows:100},c=await M.getProviders(s);x(c.items)}catch{t({title:"错误",description:"加载提供商列表失败",variant:"destructive"})}finally{n(!1)}},f=async s=>{try{N(!0);const c={page:1,rows:100,...s&&{provider_id:s}},se=await C.getModels(c);p(se.items)}catch{t({title:"错误",description:"加载模型列表失败",variant:"destructive"})}finally{N(!1)}};m.useEffect(()=>{a&&(E(),f())},[a]);const G=()=>{F(null),d(!0)},H=s=>{F(s),d(!0)},U=async s=>{if(confirm(`确定要删除提供商 "${s.display_name}" 吗？`))try{await M.deleteProvider(s.uuid),t({title:"成功",description:"提供商删除成功"}),E(),(r==null?void 0:r.uuid)===s.uuid&&(v(null),f())}catch{t({title:"错误",description:"删除提供商失败",variant:"destructive"})}},J=async s=>{try{P?(await M.updateProvider(P.uuid,s),t({title:"成功",description:"提供商更新成功"})):(await M.createProvider(s),t({title:"成功",description:"提供商创建成功"})),d(!1),F(null),E()}catch{t({title:"错误",description:P?"更新提供商失败":"创建提供商失败",variant:"destructive"})}},K=()=>{D(null),k(!0)},Q=s=>{D(s),k(!0)},V=async s=>{if(confirm(`确定要删除模型 "${s.display_name}" 吗？`))try{await C.deleteModel(s.uuid),t({title:"成功",description:"模型删除成功"}),r?f(r.id):f()}catch{t({title:"错误",description:"删除模型失败",variant:"destructive"})}},W=async s=>{try{await C.setDefaultModel(s.uuid),t({title:"成功",description:"设置默认模型成功"}),r?f(r.id):f()}catch{t({title:"错误",description:"设置默认模型失败",variant:"destructive"})}},X=async s=>{try{if(S)await C.updateModel(S.uuid,s),t({title:"成功",description:"模型更新成功"});else{if(!r)return;const c={...s,provider_id:r.id};await C.createModel(c),t({title:"成功",description:"模型创建成功"})}k(!1),D(null),r?f(r.id):f()}catch{t({title:"错误",description:S?"更新模型失败":"创建模型失败",variant:"destructive"})}},Z=s=>{v(s),f(s.id)},ee=()=>{v(null),f()};return e.jsx(I,{open:a,onOpenChange:l,children:e.jsxs($,{className:"max-w-2xl h-[600px] p-0 flex flex-col",children:[e.jsx(T,{className:"px-6 py-4 border-b flex-shrink-0",children:e.jsx(L,{children:"AI模型管理"})}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-base",children:"提供商"}),e.jsx(w,{onClick:G,variant:"ghost",size:"default",children:"增加"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:j?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-muted-foreground text-base",children:"加载中..."})}):g.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground text-base",children:"暂无提供商"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`group relative px-4 py-3 cursor-pointer border-b border-border hover:bg-muted/50 transition-colors ${r===null?"bg-accent":""}`,onClick:ee,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-medium text-base",children:"所有模型"})})})}),g.map(s=>e.jsx("div",{className:`group relative px-4 py-3 cursor-pointer border-b border-border hover:bg-muted/50 transition-colors ${(r==null?void 0:r.uuid)===s.uuid?"bg-accent":""}`,onClick:()=>Z(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"font-medium text-base flex items-center",children:[s.name,!s.is_active&&e.jsx(z,{className:"w-2 h-2 text-gray-400 fill-current ml-1"})]})}),e.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),H(s)},className:"p-1.5 rounded hover:bg-background transition-colors",title:"编辑",children:e.jsx(B,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),U(s)},className:"p-1.5 rounded hover:bg-background transition-colors",title:"删除",children:e.jsx(q,{className:"w-4 h-4 text-destructive"})})]})]})},s.uuid))]})})]}),e.jsxs("div",{className:"w-2/3 flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-base",children:["模型型号",r&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",r.name,")"]})]}),e.jsx(w,{onClick:()=>{if(!r){t({title:"提示",description:"请先选择一个提供商",variant:"destructive"});return}K()},variant:"ghost",size:"default",children:"增加"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:_?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-muted-foreground text-base",children:"加载中..."})}):o.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground text-base",children:r?"该提供商暂无模型":"暂无模型"}):o.map(s=>e.jsx("div",{className:"group relative px-4 py-3 cursor-pointer border-b border-border hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium text-base",children:[s.name,!r&&s.provider_name&&e.jsxs("span",{className:"font-normal ml-1",children:["/ ",s.provider_name]})]}),!s.is_active&&e.jsx(z,{className:"w-2 h-2 text-gray-400 fill-current"}),s.is_default&&e.jsx(O,{className:"w-4 h-4 text-yellow-500 fill-current"}),!s.is_default&&e.jsx("button",{onClick:c=>{c.stopPropagation(),W(s)},className:"p-1.5 rounded hover:bg-background transition-colors opacity-0 group-hover:opacity-100",title:"设为默认",children:e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[de(s.llm_type),s.max_tokens&&` • ${s.max_tokens.toLocaleString()}`,typeof s.context_window=="number"&&e.jsxs(e.Fragment,{children:[" •  ",s.context_window.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),Q(s)},className:"p-1.5 rounded hover:bg-background transition-colors",title:"编辑",children:e.jsx(B,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),V(s)},className:"p-1.5 rounded hover:bg-background transition-colors",title:"删除",children:e.jsx(q,{className:"w-4 h-4 text-destructive"})})]})]})},s.uuid))})]})]}),e.jsx(le,{open:i,onOpenChange:d,provider:P,onSave:J}),e.jsx(ce,{open:y,onOpenChange:k,model:S,provider:r,onSave:X})]})})}export{je as M,C as m};
