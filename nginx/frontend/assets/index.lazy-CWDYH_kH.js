import{c as E,bb as Se,r as g,j as e,bc as he,Y as Pe,u as ke,E as Ie,b as W,at as U,ad as R,D as ee,d as se,e as te,f as ae,S as pe,I as L,B as p,X as ne,i as T,C as re,ae as V,h as ge,T as fe,G as _e,R as _,P as Ve,V as $e,W as ze,g as Ee,Z as Re,$ as Z,a0 as X,a1 as B,a2 as me,a3 as Y,am as Ue,an as Le,ao as Te,ap as J,bd as Ae,w as qe}from"./index-QCM3tg6T.js";import{T as Oe}from"./textarea-BRLhZEOX.js";import{C as je}from"./confirm-dialog-Ct8Hml3F.js";import{u as Qe,a as He}from"./knowledge.service-C47W0xzH.js";import{U as ve}from"./upload-YM7RS55f.js";import{D as Ke}from"./download-X36T7S5J.js";import{F as Ge}from"./file-DwiOQTNT.js";import{H as We}from"./header-BrQ_ZiF7.js";import{M as Ze}from"./main-BjTc0OpD.js";import{E as Xe}from"./ellipsis-vertical-MoBodAGb.js";import{S as Be}from"./square-pen-BEuFlBVg.js";import"./use-infinite-scroll-Hevnk5Sy.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=E("FileArchive",[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=E("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=E("FileCode",[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=E("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=E("FileVideo",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]);var le="Progress",oe=100,[as,As]=Se(le),[ns,rs]=as(le),Ne=g.forwardRef((s,t)=>{const{__scopeProgress:a,value:n=null,max:r,getValueLabel:o=ls,...d}=s;(r||r===0)&&!ue(r)&&console.error(os(`${r}`,"Progress"));const i=ue(r)?r:oe;n!==null&&!xe(n,i)&&console.error(is(`${n}`,"Progress"));const m=xe(n,i)?n:null,l=A(m)?o(m,i):void 0;return e.jsx(ns,{scope:a,value:m,max:i,children:e.jsx(he.div,{"aria-valuemax":i,"aria-valuemin":0,"aria-valuenow":A(m)?m:void 0,"aria-valuetext":l,role:"progressbar","data-state":we(m,i),"data-value":m??void 0,"data-max":i,...d,ref:t})})});Ne.displayName=le;var ye="ProgressIndicator",be=g.forwardRef((s,t)=>{const{__scopeProgress:a,...n}=s,r=rs(ye,a);return e.jsx(he.div,{"data-state":we(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...n,ref:t})});be.displayName=ye;function ls(s,t){return`${Math.round(s/t*100)}%`}function we(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function A(s){return typeof s=="number"}function ue(s){return A(s)&&!isNaN(s)&&s>0}function xe(s,t){return A(s)&&!isNaN(s)&&s<=t&&s>=0}function os(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${oe}\`.`}function is(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${oe} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ce=Ne,cs=be;const De=g.forwardRef(({className:s,value:t,...a},n)=>e.jsx(Ce,{ref:n,className:Pe("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(cs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));De.displayName=Ce.displayName;const ds=async({knowledge_base_id:s,keyword:t})=>{const a={page:1,rows:1e3,knowledge_base_id:s,...(t==null?void 0:t.trim())&&{keyword:t.trim()}},{data:n}=await R.post("/document/page",a);return{data:n.items,count:n.pagination.total}},ms=async s=>{const{data:t}=await R.post(`/document/delete/${s}`);return t},us=async s=>{const{data:t}=await R.post("/document/batch-delete",{uuids:s});return t},xs=async(s,t)=>{try{const a=await R.get(`/utils/upload/file/${s}`,{responseType:"blob"}),n=new Blob([a.data]),r=window.URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r)}catch(a){throw console.error("下载文件失败:",a),a}},hs=async(s,t)=>{const a=new FormData;return Array.from(s).forEach(r=>{a.append("files",r)}),a.append("knowledge_base_id",t.toString()),(await R.post("/utils/upload/knowledge",a,{headers:{"Content-Type":"multipart/form-data"}})).data};function ps(s,t){const[a,n]=g.useState(s);return g.useEffect(()=>{const r=setTimeout(()=>{n(s)},t);return()=>{clearTimeout(r)}},[s,t]),a}function gs(s){const t=s==null?void 0:s.uuid,a=s==null?void 0:s.id,[n,r]=g.useState(""),o=ps(n,500),[d,i]=g.useState([]),[m,l]=g.useState(!1),[f,x]=g.useState({type:null}),y=ke(),{data:h,isLoading:C,error:c}=Ie({queryKey:["documents",t,o],queryFn:()=>ds({knowledge_base_id:a||0,keyword:o}),enabled:!!a,staleTime:5*60*1e3}),j=g.useMemo(()=>(h==null?void 0:h.data)||[],[h]),N=()=>{y.invalidateQueries({queryKey:["documents",t]})},$=W({mutationFn:u=>ms(u.uuid),onSuccess:(u,v)=>{U({title:"删除成功",description:`文档 "${v.title}" 已删除`}),N(),x({type:null})}}),S=W({mutationFn:u=>us(u),onSuccess:(u,v)=>{U({title:"批量删除成功",description:`成功删除 ${v.length} 个文档`}),N()}}),P=W({mutationFn:u=>{var I;const v=(I=u.extra_data)==null?void 0:I.file_uuid;if(!v)throw new Error("文件UUID不存在");return xs(v,u.title)},onSuccess:(u,v)=>{U({title:"下载成功",description:`文档 "${v.title}" 已开始下载`})},onError:u=>{U({title:"下载失败",description:(u==null?void 0:u.message)||"文件下载过程中发生错误",variant:"destructive"})}}),k=async u=>{var D,ie,ce,de;if(!u.length)return;l(!0);const v=Array.from(u),I=v.map(F=>({filename:F.name,progress:0,status:"uploading"}));i(F=>[...I,...F]);for(let F=0;F<v.length;F++){const Me=v[F],O=F;try{const w=new DataTransfer;w.items.add(Me);const Q=w.files,H=setInterval(()=>{i(z=>z.map((M,G)=>G===O&&M.status==="uploading"?{...M,progress:Math.min(M.progress+Math.random()*15,90)}:M))},300),K=await hs(Q,a||0);clearInterval(H),i(z=>z.map((M,G)=>G===O?{...M,progress:100,status:"success"}:M))}catch(w){const Q=((ie=(D=w==null?void 0:w.response)==null?void 0:D.data)==null?void 0:ie.message)||((de=(ce=w==null?void 0:w.response)==null?void 0:ce.data)==null?void 0:de.detail)||(w==null?void 0:w.message)||"上传失败";i(H=>H.map((K,z)=>z===O?{...K,status:"error",error:Q}:K));continue}}l(!1),setTimeout(()=>{N()},1e3)},b={upload:()=>x({type:"upload"}),delete:u=>x({type:"delete",document:u}),close:()=>x({type:null})},q=()=>{i([]),l(!1)};return{documents:j,totalCount:(h==null?void 0:h.count)||0,isLoading:C||$.isPending||S.isPending||P.isPending,error:c,searchQuery:n,setSearchQuery:r,uploadProgress:d,isUploading:m,handleFileUpload:k,dialogState:f,dialogActions:b,deleteDocument:$.mutate,batchDeleteDocuments:S.mutate,downloadDocument:P.mutate,refreshData:N,clearUploadProgress:q}}const fs=s=>s.startsWith("image/")?ss:s.startsWith("video/")?ts:s.startsWith("audio/")?Je:s.includes("zip")||s.includes("rar")||s.includes("tar")?Ye:s.includes("text")||s.includes("json")||s.includes("xml")?es:s.includes("pdf")||s.includes("doc")?_e:Ge,Fe=s=>{if(s===0)return"0 B";const t=1024,a=["B","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+a[n]},js=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});function vs({open:s,isUploading:t,uploadProgress:a,onClose:n,onUpload:r,onClearUploads:o}){const d=g.useRef(null),i=l=>{const f=l.target.files;f&&f.length>0&&(r(f),d.current&&(d.current.value=""))},m=()=>{d.current&&(d.current.value=""),o(),n()};return e.jsx(ee,{open:s,onOpenChange:m,children:e.jsxs(se,{className:"sm:max-w-md max-h-[90vh] flex flex-col",children:[e.jsx(te,{children:e.jsx(ae,{children:"上传文件"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:d,type:"file",multiple:!0,onChange:i,className:"hidden",accept:"*/*"}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>{var l;return(l=d.current)==null?void 0:l.click()},className:"w-full h-20 border-dashed",disabled:t,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ve,{className:"h-6 w-6"}),e.jsx("span",{children:t?"上传中...":"点击选择文件"}),t&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"可以继续选择更多文件"})]})})]}),a.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:"上传列表"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:o,className:"h-6 px-2 text-xs",disabled:t,children:"清空列表"})]}),a.map((l,f)=>e.jsxs(re,{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm gap-2",children:[e.jsx("span",{className:"truncate flex-1 min-w-0 max-w-[calc(100%-80px)]",children:l.filename}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[l.status==="uploading"&&e.jsx(T,{className:"h-4 w-4 animate-spin"}),l.status==="success"&&e.jsx(V,{variant:"default",className:"text-xs",children:"成功"}),l.status==="error"&&e.jsx(V,{variant:"destructive",className:"text-xs",children:"失败"})]})]}),e.jsx(De,{value:l.progress,className:"h-2"}),l.error&&e.jsx("p",{className:"text-xs text-destructive",children:l.error})]},`${l.filename}-${f}`))]})]}),e.jsx(ge,{children:e.jsx(p,{type:"button",variant:"outline",onClick:m,children:"关闭"})})]})})}function Ns({open:s,document:t,isLoading:a,onClose:n,onDelete:r}){return e.jsx(je,{open:s,onOpenChange:o=>!o&&n(),handleConfirm:r,title:"删除文档",desc:t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["确定要删除文档 ",e.jsxs("span",{className:"font-semibold",children:['"',t.title,'"']})," 吗？"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• 文件大小：",Fe(t.file_size)]}),e.jsxs("p",{children:["• 文件类型：",t.file_type]}),e.jsxs("p",{children:["• 创建时间：",js(t.created_at)]})]}),e.jsx("p",{className:"text-sm font-medium text-destructive mt-3",children:"此操作无法撤销，请谨慎操作。"})]}):"此操作无法撤销，请谨慎操作。",confirmText:"删除",destructive:!0,isLoading:a})}function ys({document:s,onDelete:t,onDownload:a}){const n=fs(s.file_type);return e.jsx(re,{className:"p-4 hover:bg-accent hover:text-accent-foreground border-0 relative group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(n,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:Fe(s.file_size)}),e.jsx("span",{children:s.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>a(s),title:"下载",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive",onClick:()=>t(s),title:"删除",children:e.jsx(fe,{className:"h-4 w-4"})})]})]})})}function bs({open:s,knowledgeBase:t,onClose:a}){const{documents:n,totalCount:r,isLoading:o,error:d,searchQuery:i,setSearchQuery:m,uploadProgress:l,isUploading:f,handleFileUpload:x,dialogState:y,dialogActions:h,deleteDocument:C,downloadDocument:c,clearUploadProgress:j}=gs(t),N=()=>{j(),a()},$=()=>{m("")},S=b=>{h.delete(b)},P=b=>{c(b)},k=()=>{y.document&&C(y.document)};return e.jsx(ee,{open:s,onOpenChange:N,children:e.jsxs(se,{className:"sm:max-w-1xl max-h-[80vh] flex flex-col",children:[e.jsx(te,{children:e.jsx(ae,{children:t==null?void 0:t.name})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative w-80",children:[e.jsx(pe,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(L,{className:"pl-8 h-8 bg-transparent text-sm",placeholder:"搜索文件名、内容...",value:i,onChange:b=>m(b.target.value)}),i&&e.jsx(p,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6 p-0 opacity-70 hover:opacity-100",onClick:$,disabled:o,children:e.jsx(ne,{className:"h-3 w-3"})})]}),e.jsxs(p,{size:"sm",onClick:h.upload,disabled:f,children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"上传文件"]})]}),!o&&e.jsx("div",{className:"mb-4 text-sm text-muted-foreground",children:r>0&&(i?e.jsxs(e.Fragment,{children:["找到 ",r,' 个匹配 "',i,'" 的文档']}):e.jsxs(e.Fragment,{children:["共 ",r," 个文档"]}))}),o&&n.length===0?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(T,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载中..."})]}):d?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:"加载文档失败"})}):n.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:i?`没有找到匹配 "${i}" 的文档`:"还没有文档，点击上方按钮上传第一个文档"})}):e.jsx("div",{className:"space-y-3",children:n.map(b=>e.jsx(ys,{document:b,onDelete:S,onDownload:P},b.uuid))})]}),e.jsx(vs,{open:y.type==="upload",isUploading:f,uploadProgress:l,onClose:h.close,onUpload:x,onClearUploads:j}),e.jsx(Ns,{open:y.type==="delete",document:y.document,isLoading:o,onClose:h.close,onDelete:k})]})})}const ws=_.object({name:_.string().min(1,{message:"知识库名称是必填项"}).max(200,{message:"名称不能超过200个字符"}),description:_.string().optional(),category:_.string().default("general"),tags:_.array(_.string()).default([])});function Cs({open:s,currentKnowledge:t,isLoading:a,closeDialog:n,handleSubmit:r}){const[o,d]=g.useState(""),i=!!t,m=s==="create"||s==="edit";console.log("KnowledgeForm渲染:",{open:s,isFormOpen:m,currentKnowledge:t});const l=$e({resolver:ze(ws),defaultValues:{name:"",description:"",category:"general",tags:[]}});g.useEffect(()=>{t?l.reset({name:t.name,description:t.description||"",category:t.category||"general",tags:t.tags||[]}):l.reset({name:"",description:"",category:"general",tags:[]})},[t,l]);const f=c=>{r(c),d("")},x=()=>{if(o.trim()&&!l.getValues("tags").includes(o.trim())){const c=l.getValues("tags");l.setValue("tags",[...c,o.trim()]),d("")}},y=c=>{const j=l.getValues("tags");l.setValue("tags",j.filter(N=>N!==c))},h=c=>{c.key==="Enter"&&(c.preventDefault(),x())},C=c=>{!a&&!c&&(l.reset(),d(""),n())};return e.jsx(ee,{open:m,onOpenChange:C,children:e.jsxs(se,{className:"sm:max-w-md",children:[e.jsxs(te,{className:"text-left",children:[e.jsx(ae,{children:i?"编辑知识库":"创建知识库"}),e.jsxs(Ee,{children:[i?"修改知识库信息":"创建一个新的知识库","，填写必要信息后点击保存。"]})]}),e.jsx(Re,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(f),className:"space-y-4",children:[e.jsx(Z,{control:l.control,name:"name",render:({field:c})=>e.jsxs(X,{children:[e.jsx(B,{children:"知识库名称 *"}),e.jsx(me,{children:e.jsx(L,{placeholder:"请输入知识库名称",...c,disabled:a})}),e.jsx(Y,{})]})}),e.jsx(Z,{control:l.control,name:"description",render:({field:c})=>e.jsxs(X,{children:[e.jsx(B,{children:"描述"}),e.jsx(me,{children:e.jsx(Oe,{placeholder:"请输入知识库描述",className:"resize-none",rows:3,...c,disabled:a})}),e.jsx(Y,{})]})}),e.jsx(Z,{control:l.control,name:"tags",render:({field:c})=>e.jsxs(X,{children:[e.jsx(B,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{placeholder:"输入标签后按回车添加",value:o,onChange:j=>d(j.target.value),onKeyPress:h,disabled:a}),e.jsx(p,{type:"button",variant:"outline",onClick:x,disabled:!o.trim()||a,children:"添加"})]}),c.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:c.value.map((j,N)=>e.jsxs(V,{variant:"secondary",className:"text-sm",children:[j,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>y(j),disabled:a,children:e.jsx(ne,{className:"h-3 w-3"})})]},N))})]}),e.jsx(Y,{})]})}),e.jsxs(ge,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>C(!1),disabled:a,children:"取消"}),e.jsx(p,{type:"submit",disabled:a,children:a?"保存中...":i?"更新":"创建"})]})]})})]})})}function Ds({open:s,currentKnowledge:t,isLoading:a,closeDialog:n,handleDelete:r}){return e.jsx(je,{open:s==="delete",onOpenChange:o=>!o&&n(),handleConfirm:r,title:"删除知识库",desc:t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["确定要删除知识库 ",e.jsxs("span",{className:"font-semibold",children:['"',t.name,'"']})," 吗？"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• 文档数量：",t.document_count," 个"]}),e.jsxs("p",{children:["• 标签：",t.tags.join(", ")||"无"]})]}),e.jsx("p",{className:"text-sm font-medium text-destructive mt-3",children:"此操作无法撤销，请谨慎操作。"})]}):"此操作无法撤销，请谨慎操作。",confirmText:"删除",destructive:!0,isLoading:a})}function Fs({kb:s,openEdit:t,openDelete:a,openManageFiles:n}){return e.jsx(re,{className:"p-4 hover:bg-accent hover:text-accent-foreground border-0 relative group",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:!s.is_active&&e.jsx(V,{variant:"secondary",className:"text-xs",children:"已禁用"})})]}),e.jsxs(Ue,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs(Te,{align:"end",children:[e.jsxs(J,{onClick:()=>t(s),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"编辑"]}),e.jsxs(J,{onClick:()=>n(s),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"管理文件"]}),e.jsxs(J,{onClick:()=>a(s),className:"text-destructive focus:text-destructive",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"删除"]})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:[s.document_count," 个文档"]}),e.jsx("p",{className:"text-sm text-muted-foreground flex-grow mb-3 line-clamp-2",children:s.description||"暂无描述"}),s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.tags.slice(0,3).map((r,o)=>e.jsx(V,{variant:"secondary",className:"text-muted-foreground bg-muted/50 text-xs",children:r},o)),s.tags.length>3&&e.jsxs(V,{variant:"secondary",className:"text-muted-foreground bg-muted/50 text-xs",children:["+",s.tags.length-3]})]})]})})}function Ms({dialogProps:s}){const[t,a]=g.useState(!1),[n,r]=g.useState(null),{knowledgeBases:o,totalCount:d,isLoading:i,error:m,hasNextPage:l,isFetchingNextPage:f,searchQuery:x,setSearchQuery:y,loadMoreRef:h,fetchNextPage:C}=He(),{open:c,currentKnowledge:j,dialogLoading:N,openCreate:$,openEdit:S,openDelete:P,closeDialog:k,handleSubmit:b,handleDelete:q}=s,u=D=>{r(D),a(!0)},v=()=>{a(!1),r(null)},I=()=>{y("")};return m?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-destructive",children:"加载知识库失败"}),e.jsx(p,{onClick:()=>C(),className:"mt-4",children:"重试"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto pt-0 px-6 pb-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(L,{className:"pl-8 h-10 bg-transparent",placeholder:"搜索知识库名称、描述或标签...",value:x,onChange:D=>y(D.target.value)}),x&&e.jsx(p,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 opacity-70 hover:opacity-100",onClick:I,disabled:i,children:e.jsx(ne,{className:"h-4 w-4"})})]})}),!i&&e.jsx("div",{className:"mb-6 text-sm text-muted-foreground",children:d>0&&(x?e.jsxs(e.Fragment,{children:["找到 ",d,' 个匹配 "',x,'" 的知识库']}):e.jsxs(e.Fragment,{children:["共 ",d," 个知识库"]}))}),i&&o.length===0?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(T,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载中..."})]}):o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:x?`没有找到匹配 "${x}" 的知识库`:"还没有知识库，点击上方按钮创建第一个知识库"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(D=>e.jsx(Fs,{kb:D,openEdit:S,openDelete:P,openManageFiles:u},D.uuid))}),e.jsx("div",{ref:h,className:"mt-8 flex justify-center",children:f?e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx(T,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"加载更多..."})]}):l?e.jsx("div",{className:"py-4",children:e.jsx(p,{variant:"outline",onClick:()=>C(),className:"text-sm",children:x?"点击加载更多搜索结果":"点击加载更多"})}):o.length>0?e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"已到底啦"})}):null})]}),e.jsx(Cs,{open:c,currentKnowledge:j,isLoading:N,closeDialog:k,handleSubmit:b}),e.jsx(Ds,{open:c,currentKnowledge:j,isLoading:N,closeDialog:k,handleDelete:q}),e.jsx(bs,{open:t,knowledgeBase:n,onClose:v}),e.jsx("div",{className:"h-[30px]"})]})}function Ss(){const{open:s,currentKnowledge:t,isLoading:a,openCreate:n,openEdit:r,openDelete:o,closeDialog:d,handleSubmit:i,handleDelete:m}=Qe();return e.jsxs(e.Fragment,{children:[e.jsxs(We,{fixed:!0,children:[e.jsx("h3",{className:"text-2xl font-bold",children:"知识库"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsxs(p,{onClick:n,variant:"ghost",children:[e.jsx(Ve,{className:"h-4 w-4"}),"新建知识库"]})})]}),e.jsx(Ze,{children:e.jsx(Ms,{dialogProps:{open:s,currentKnowledge:t,dialogLoading:a,openCreate:n,openEdit:r,openDelete:o,closeDialog:d,handleSubmit:i,handleDelete:m}})})]})}const qs=qe("/_authenticated/knowledges/")({component:Ss});export{qs as Route};
