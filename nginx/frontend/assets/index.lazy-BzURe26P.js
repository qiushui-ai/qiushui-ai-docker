import{a6 as p,j as e,B as f,P as re,S as ce,I as g,X as q,i as O,r as D,K as ie,a8 as de,a9 as oe,D as xe,d as me,e as he,f as je,g as ue,aa as pe,ab as r,ac as c,ae as o,ad as i,af as x,E as Q,b8 as ge,aF as ve,h as fe,C as be,N as Ne,O as ye,R as Ce,U as te,T as we,w as _e}from"./index-CTPVv2qI.js";import{T as F}from"./textarea-sXwijNo4.js";import{S as W,a as Z,b as L,c as ee,d as se}from"./select-BxdJP45j.js";import{S as X}from"./switch-DtYmKlj_.js";import{C as Se}from"./confirm-dialog-DJh58xrA.js";import{u as ke,a as De,g as Fe}from"./mcptools.service-CdCpUVdG.js";import{H as Ve}from"./header-DQW_dqlj.js";import{M as Ee}from"./main-CdabfA0i.js";import{T as Pe,a as ze,b as U,c as B}from"./tabs-BP2O6kcy.js";import{C as Te}from"./chevron-down-B6oOayy8.js";import{E as Ke}from"./ellipsis-vertical-CdlH8IKm.js";import{S as Me}from"./square-pen-DRmb1xVr.js";import"./index-DOFEKLPp.js";import"./use-infinite-scroll-BdHXd_Cp.js";const Re=p.object({name:p.string().min(1,{message:"工具名称是必填项"}).max(200,{message:"名称不能超过200个字符"}),description:p.string().optional(),tool_type:p.string().default("mcp"),sub_type:p.string().default("stdio"),tags:p.array(p.string()).default([]),is_active:p.boolean().default(!0),command:p.string().optional(),args:p.string().optional(),env:p.string().optional(),url:p.string().optional(),headers:p.string().default(""),timeout:p.number().optional()}).refine(d=>{var l,n;return d.sub_type==="stdio"?!!((l=d.command)!=null&&l.trim()):d.sub_type==="sse"||d.sub_type==="streamableHttp"?!!((n=d.url)!=null&&n.trim()):!0},{message:"请填写必要的配置信息",path:["sub_type"]}),ae=[{value:"stdio",label:"STDIO"},{value:"sse",label:"SSE"},{value:"streamableHttp",label:"Streamable HTTP"}];function Ie({open:d,currentTool:l,isLoading:n,closeDialog:b,handleSubmit:y}){const[m,N]=D.useState(""),[v,V]=D.useState(new Set(["get_channel_videos"])),[C,_]=D.useState("info"),[h,S]=D.useState(null),[$,k]=D.useState(new Set),A=!!l,Y=d==="create"||d==="edit",{data:T,isLoading:E}=ie({queryKey:["mcp-info",l==null?void 0:l.uuid,C],queryFn:()=>Fe(l.uuid),enabled:!!l&&l.sub_type==="streamableHttp"&&["tools","prompts","resources"].includes(C)&&!$.has(`${l.uuid}-${C}`),staleTime:5*60*1e3});D.useEffect(()=>{T&&l&&(S(T.mcp_info),k(s=>new Set(s).add(`${l.uuid}-${C}`)))},[T,l,C]);const t=de({resolver:oe(Re),defaultValues:{name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",api_key:"",headers:"",timeout:30}});D.useEffect(()=>{if(l){const s=l.tool_conf||{},a=l.sub_type||"stdio";let j="",H="",K="",z="",M="";if(a==="stdio"){j=s.command||"",H=s.args?Array.isArray(s.args)?s.args.join(" "):s.args:"";const u=s.env;typeof u=="object"&&u!==null?K=Object.entries(u).map(([R,I])=>`${R}=${I}`).join(`
`):K=u||""}else if(a==="sse"){z=s.url||"";const u=s.headers;typeof u=="object"&&u!==null?M=Object.entries(u).map(([R,I])=>`${R}: ${I}`).join(`
`):M=u||""}else if(a==="streamableHttp"){z=s.url||"";const u=s.headers;typeof u=="object"&&u!==null?M=Object.entries(u).map(([R,I])=>`${R}: ${I}`).join(`
`):M=u||""}t.reset({name:l.name,description:l.description||"",tool_type:l.tool_type||"mcp",sub_type:a,tags:l.tags||[],is_active:l.is_active??!0,command:j,args:H,env:K,url:z,headers:M,timeout:s.timeout||30}),_("info"),S(null),k(new Set)}else t.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",headers:"",timeout:30}),_("info"),S(null),k(new Set)},[l,t]);const G=s=>{y(s),N("")},P=()=>{if(m.trim()&&!t.getValues("tags").includes(m.trim())){const s=t.getValues("tags");t.setValue("tags",[...s,m.trim()]),N("")}},w=s=>{const a=t.getValues("tags");t.setValue("tags",a.filter(j=>j!==s))},J=s=>{s.key==="Enter"&&(s.preventDefault(),P())},le=s=>{const a=new Set(v);a.has(s)?a.delete(s):a.add(s),V(a)},ne=s=>{!n&&!s&&(t.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",headers:"",timeout:30}),N(""),_("info"),S(null),k(new Set),b())};return e.jsx(xe,{open:Y,onOpenChange:ne,children:e.jsxs(me,{className:"sm:max-w-1xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{className:"text-left",children:[e.jsx(je,{children:A?`编辑工具 - ${l==null?void 0:l.name}`:"创建工具"}),e.jsxs(ue,{children:[A?"修改工具信息":"创建一个新的工具","，填写必要信息后点击保存。"]})]}),e.jsx(pe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(G),className:"space-y-4",children:[e.jsx(r,{control:t.control,name:"tool_type",render:({field:s})=>e.jsx(c,{className:"hidden",children:e.jsx(o,{children:e.jsx(g,{...s,type:"hidden"})})})}),t.watch("sub_type")==="streamableHttp"&&e.jsx(e.Fragment,{children:e.jsxs(Pe,{value:C,onValueChange:_,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4",children:[e.jsx(U,{value:"info",children:"信息"}),e.jsx(U,{value:"tools",children:"工具"}),e.jsx(U,{value:"prompts",children:"提示"}),e.jsx(U,{value:"resources",children:"资源"})]}),e.jsxs(B,{value:"info",className:"space-y-4",children:[e.jsx(r,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(o,{children:e.jsx(g,{placeholder:"请输入工具名称",...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(o,{children:e.jsx(F,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(W,{onValueChange:s.onChange,defaultValue:s.value,disabled:n,children:[e.jsx(o,{children:e.jsx(Z,{children:e.jsx(L,{placeholder:"选择对接方式"})})}),e.jsx(ee,{children:ae.map(a=>e.jsx(se,{value:a.value,children:a.label},a.value))})]}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"url",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"URL *"}),e.jsx(o,{children:e.jsx(g,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:n})}),e.jsx(x,{})]})}),t.watch("sub_type")==="streamableHttp"&&e.jsx(r,{control:t.control,name:"headers",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"请求头"}),e.jsx(o,{children:e.jsx(F,{placeholder:`例如:
Authorization: Bearer your_token_here
Content-Type: application/json
X-API-Key: your_api_key
每行一个请求头，格式：Key: Value`,className:"resize-none",rows:4,...s,disabled:n})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"每行一个请求头，格式：Key: Value。空行会被忽略。"}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(o,{children:e.jsx(g,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:a=>s.onChange(parseInt(a.target.value)||30),disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(o,{children:e.jsx(X,{checked:s.value,onCheckedChange:s.onChange,disabled:n})})]})}),e.jsx(r,{control:t.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{placeholder:"输入标签后按回车添加",value:m,onChange:a=>N(a.target.value),onKeyPress:J,disabled:n}),e.jsx(f,{type:"button",variant:"outline",onClick:P,disabled:!m.trim()||n,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((a,j)=>e.jsxs(Q,{variant:"secondary",className:"text-sm",children:[a,e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>w(a),disabled:n,children:e.jsx(q,{className:"h-3 w-3"})})]},j))})]}),e.jsx(x,{})]})})]}),e.jsx(B,{value:"tools",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:E?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(O,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载工具信息中..."})]}):h!=null&&h.tools&&h.tools.length>0?h.tools.map((s,a)=>e.jsxs("div",{className:"border rounded p-3 hover:bg-accent cursor-pointer",onClick:()=>le(s.name),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v.has(s.name)?e.jsx(Te,{className:"h-4 w-4 flex-shrink-0"}):e.jsx(ge,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]})}),v.has(s.name)&&e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:s.inputSchema&&e.jsxs("div",{className:"mt-3 ml-5",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"输入参数:"}),e.jsx("div",{className:"bg-muted rounded p-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 text-xs",children:Object.entries(s.inputSchema.properties||{}).map(([j,H])=>{var z;const K=((z=s.inputSchema.required)==null?void 0:z.includes(j))||!1;return e.jsxs(ve.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[j,K&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"text-muted-foreground",children:e.jsx("span",{className:"inline-flex items-center",children:H.type})})]},j)})})})]})})]},a)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用工具"})})}),e.jsx(B,{value:"prompts",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:E?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(O,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载提示信息中..."})]}):h!=null&&h.prompts&&h.prompts.length>0?h.prompts.map((s,a)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description}),s.arguments&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"参数:"}),e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto",children:JSON.stringify(s.arguments,null,2)})]})]},a)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用提示"})})}),e.jsx(B,{value:"resources",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:E?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(O,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载资源信息中..."})]}):h!=null&&h.resources&&h.resources.length>0?h.resources.map((s,a)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("div",{className:"text-xs text-blue-600 break-all",children:["URI: ",s.uri]})]},a)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用资源"})})})]})}),t.watch("sub_type")==="sse"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(o,{children:e.jsx(g,{placeholder:"请输入工具名称",...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(o,{children:e.jsx(F,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(W,{onValueChange:s.onChange,defaultValue:s.value,disabled:n,children:[e.jsx(o,{children:e.jsx(Z,{children:e.jsx(L,{placeholder:"选择对接方式"})})}),e.jsx(ee,{children:ae.map(a=>e.jsx(se,{value:a.value,children:a.label},a.value))})]}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"url",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"URL *"}),e.jsx(o,{children:e.jsx(g,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"headers",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"请求头"}),e.jsx(o,{children:e.jsx(F,{placeholder:`例如:
Authorization: Bearer your_token_here
Content-Type: application/json
X-API-Key: your_api_key
每行一个请求头，格式：Key: Value`,className:"resize-none",rows:4,...s,disabled:n})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"每行一个请求头，格式：Key: Value。空行会被忽略。"}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(o,{children:e.jsx(g,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:a=>s.onChange(parseInt(a.target.value)||30),disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(o,{children:e.jsx(X,{checked:s.value,onCheckedChange:s.onChange,disabled:n})})]})}),e.jsx(r,{control:t.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{placeholder:"输入标签后按回车添加",value:m,onChange:a=>N(a.target.value),onKeyPress:J,disabled:n}),e.jsx(f,{type:"button",variant:"outline",onClick:P,disabled:!m.trim()||n,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((a,j)=>e.jsxs(Q,{variant:"secondary",className:"text-sm",children:[a,e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>w(a),disabled:n,children:e.jsx(q,{className:"h-3 w-3"})})]},j))})]}),e.jsx(x,{})]})})]}),t.watch("sub_type")==="stdio"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(o,{children:e.jsx(g,{placeholder:"请输入工具名称",...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(o,{children:e.jsx(F,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(W,{onValueChange:s.onChange,defaultValue:s.value,disabled:n,children:[e.jsx(o,{children:e.jsx(Z,{children:e.jsx(L,{placeholder:"选择对接方式"})})}),e.jsx(ee,{children:ae.map(a=>e.jsx(se,{value:a.value,children:a.label},a.value))})]}),e.jsx(x,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{control:t.control,name:"command",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"命令 *"}),e.jsx(o,{children:e.jsx(g,{placeholder:"例如: python, node, npx",...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"args",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"参数"}),e.jsx(o,{children:e.jsx(F,{placeholder:`例如: path/to/script.py --option value
每行一个参数，或者用空格分隔`,className:"resize-none",rows:3,...s,disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"env",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"环境变量"}),e.jsx(o,{children:e.jsx(F,{placeholder:`例如:
API_KEY=your_api_key_here
DEBUG=true
PORT=3000
每行一个环境变量，格式：KEY=VALUE`,className:"resize-none",rows:4,...s,disabled:n})}),e.jsx(x,{})]})})]}),e.jsx(r,{control:t.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(o,{children:e.jsx(g,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:a=>s.onChange(parseInt(a.target.value)||30),disabled:n})}),e.jsx(x,{})]})}),e.jsx(r,{control:t.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(o,{children:e.jsx(X,{checked:s.value,onCheckedChange:s.onChange,disabled:n})})]})}),e.jsx(r,{control:t.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{placeholder:"输入标签后按回车添加",value:m,onChange:a=>N(a.target.value),onKeyPress:J,disabled:n}),e.jsx(f,{type:"button",variant:"outline",onClick:P,disabled:!m.trim()||n,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((a,j)=>e.jsxs(Q,{variant:"secondary",className:"text-sm",children:[a,e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>w(a),disabled:n,children:e.jsx(q,{className:"h-3 w-3"})})]},j))})]}),e.jsx(x,{})]})})]}),e.jsxs(fe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>ne(!1),disabled:n,children:"取消"}),e.jsx(f,{type:"submit",disabled:n,children:n?"保存中...":A?"更新":"创建"})]})]})})]})})}function Oe({open:d,currentTool:l,isLoading:n,closeDialog:b,handleDelete:y}){return e.jsx(Se,{open:d==="delete",onOpenChange:m=>!m&&b(),handleConfirm:y,title:"删除工具",desc:l?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["确定要删除工具 ",e.jsxs("span",{className:"font-semibold",children:['"',l.name,'"']})," 吗？"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• 对接方式：",l.sub_type]}),e.jsxs("p",{children:["• 标签：",l.tags.join(", ")||"无"]})]}),e.jsx("p",{className:"text-sm font-medium text-destructive mt-3",children:"此操作无法撤销，请谨慎操作。"})]}):"此操作无法撤销，请谨慎操作。",confirmText:"删除",destructive:!0,isLoading:n})}function $e({tool:d,openEdit:l,openDelete:n,toggleToolStatus:b}){const y=m=>{b({toolUuid:d.uuid,enable:m})};return e.jsx(be,{className:"p-4 hover:bg-accent hover:text-accent-foreground border-0 relative group",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold truncate",children:d.name})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{checked:d.is_active,onCheckedChange:y}),e.jsxs(Ne,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsxs(te,{onClick:()=>l(d),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"编辑"]}),e.jsxs(te,{onClick:()=>n(d),className:"text-destructive focus:text-destructive",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"删除"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs text-muted-foreground",children:[e.jsx("span",{children:d.sub_type}),!d.is_active&&e.jsx(Q,{variant:"secondary",className:"text-xs",children:"已禁用"})]}),e.jsx("p",{className:"text-sm text-muted-foreground flex-grow line-clamp-2",children:d.description||"暂无描述"})]})})}function Ae({dialogProps:d}){const{tools:l,totalCount:n,isLoading:b,error:y,hasNextPage:m,isFetchingNextPage:N,searchQuery:v,setSearchQuery:V,loadMoreRef:C,fetchNextPage:_,toggleToolStatus:h}=De(),{open:S,currentTool:$,dialogLoading:k,openCreate:A,openEdit:Y,openDelete:T,closeDialog:E,handleSubmit:t,handleDelete:G}=d,P=()=>{V("")};return y?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-destructive",children:"加载工具失败"}),e.jsx(f,{onClick:()=>_(),className:"mt-4",children:"重试"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto pt-0 px-6 pb-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{className:"pl-8 h-10 bg-transparent",placeholder:"搜索工具名称、描述或标签...",value:v,onChange:w=>V(w.target.value)}),v&&e.jsx(f,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 opacity-70 hover:opacity-100",onClick:P,disabled:b,children:e.jsx(q,{className:"h-4 w-4"})})]})}),!b&&e.jsx("div",{className:"mb-6 text-sm text-muted-foreground",children:n>0&&(v?e.jsxs(e.Fragment,{children:["找到 ",n,' 个匹配 "',v,'" 的工具']}):e.jsxs(e.Fragment,{children:["共 ",n," 个工具"]}))}),b&&l.length===0?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(O,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载中..."})]}):l.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:v?`没有找到匹配 "${v}" 的工具`:"还没有工具，点击上方按钮创建第一个工具"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(w=>e.jsx($e,{tool:w,openEdit:Y,openDelete:T,toggleToolStatus:h},w.uuid))}),e.jsx("div",{ref:C,className:"mt-8 flex justify-center",children:N?e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx(O,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"加载更多..."})]}):m?e.jsx("div",{className:"py-4",children:e.jsx(f,{variant:"outline",onClick:()=>_(),className:"text-sm",children:v?"点击加载更多搜索结果":"点击加载更多"})}):l.length>0?e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"已到底啦"})}):null})]}),e.jsx(Ie,{open:S,currentTool:$,isLoading:k,closeDialog:E,handleSubmit:t}),e.jsx(Oe,{open:S,currentTool:$,isLoading:k,closeDialog:E,handleDelete:G}),e.jsx("div",{className:"h-[30px]"})]})}function He(){const{open:d,currentTool:l,isLoading:n,openCreate:b,openEdit:y,openDelete:m,closeDialog:N,handleSubmit:v,handleDelete:V}=ke();return e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{fixed:!0,children:[e.jsx("h3",{className:"text-2xl font-bold",children:"MCP工具"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsxs(f,{onClick:b,variant:"ghost",children:[e.jsx(re,{className:"h-4 w-4"}),"新建工具"]})})]}),e.jsx(Ee,{children:e.jsx(Ae,{dialogProps:{open:d,currentTool:l,dialogLoading:n,openEdit:y,openDelete:m,closeDialog:N,handleSubmit:v,handleDelete:V}})})]})}const ns=_e("/_authenticated/mcptools/")({component:He});export{ns as Route};
