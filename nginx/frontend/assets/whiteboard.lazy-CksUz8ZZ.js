import{c as G,u as w,a as L,r as o,b as V,j as e,D as $,d as Z,e as J,f as U,g as X,L as F,I as q,h as Y,B as h,i as y,A as ee,k as se,l as te,m as ae,n as ie,o as ne,p as re,q as le,H,s as I,t as W,T as R,C as ce,v as oe,S as de,P as xe,w as me}from"./index-C_oIiI4O.js";import{M as ue}from"./main-DSKQ9ujU.js";import{u as he,a as pe}from"./use-infinite-scroll-BwChjD87.js";import{w as z,g as ge,W as je}from"./whiteboard-DFKjNlWZ.js";import{T as ve}from"./textarea-C7_dNQbG.js";import{f as A,g as fe,V as Ne,s as ye}from"./notes-view-storage-CBy5OMOX.js";import{T as we,a as Ce,b as M,c as g,d as De,e as j}from"./table-CRWGgVfV.js";import{E as K}from"./eye-4HsJyM9I.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=G("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);function ke({open:i,onOpenChange:t,onWhiteboardCreated:n}){const s=w(),{toast:a}=L(),[m,p]=o.useState(""),[u,d]=o.useState(""),v=V({mutationFn:l=>z.create(l),onSuccess:l=>{s.invalidateQueries({queryKey:["whiteboards"]}),t(!1),a({title:"创建成功",description:"白板已成功创建，即将跳转到编辑页面"}),p(""),d(""),n&&n(),window.open(`/whiteboard/${l.uuid}`,"_blank")},onError:l=>{a({title:"创建失败",description:(l==null?void 0:l.message)||"创建白板时发生错误",variant:"destructive"})}}),N=l=>{if(l.preventDefault(),!m.trim()){a({title:"标题不能为空",description:"请输入白板标题",variant:"destructive"});return}v.mutate({title:m.trim(),description:u.trim()||void 0})},c=v.isPending;return e.jsx($,{open:i,onOpenChange:t,children:e.jsx(Z,{className:"sm:max-w-[500px]",children:e.jsxs("form",{onSubmit:N,children:[e.jsxs(J,{children:[e.jsx(U,{children:"创建白板"}),e.jsx(X,{children:"输入白板的标题和描述，创建后将跳转到编辑页面。"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{htmlFor:"title",children:"标题 *"}),e.jsx(q,{id:"title",value:m,onChange:l=>p(l.target.value),placeholder:"输入白板标题",disabled:c,autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{htmlFor:"description",children:"描述"}),e.jsx(ve,{id:"description",value:u,onChange:l=>d(l.target.value),placeholder:"输入白板描述（可选）",disabled:c,rows:4})]})]}),e.jsxs(Y,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:c,children:"取消"}),e.jsxs(h,{type:"submit",disabled:c,children:[c&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"创建"]})]})]})})})}function Te({open:i,onOpenChange:t,whiteboard:n}){const s=w(),{toast:a}=L(),m=V({mutationFn:d=>z.delete(d),onSuccess:()=>{s.invalidateQueries({queryKey:["whiteboards"]}),t(!1),a({title:"删除成功",description:"白板已成功删除"})},onError:d=>{a({title:"删除失败",description:(d==null?void 0:d.message)||"删除白板时发生错误",variant:"destructive"})}}),p=()=>{n&&m.mutate(n.uuid)},u=m.isPending;return e.jsx(ee,{open:i,onOpenChange:t,children:e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"确认删除"}),e.jsxs(ie,{children:['您确定要删除白板 "',(n==null?void 0:n.title)||"无标题",'" 吗？此操作无法撤销。']})]}),e.jsxs(ne,{children:[e.jsx(re,{disabled:u,children:"取消"}),e.jsxs(le,{onClick:p,disabled:u,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[u&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"删除"]})]})]})})}function Pe({whiteboards:i,onEditWhiteboard:t,onDeleteWhiteboard:n}){return e.jsx("div",{className:"w-full",children:e.jsxs(we,{children:[e.jsx(Ce,{children:e.jsxs(M,{children:[e.jsx(g,{children:"标题"}),e.jsx(g,{className:"w-[30%]",children:"描述"}),e.jsx(g,{className:"w-[10%] text-center min-w-[80px]",children:"查看次数"}),e.jsx(g,{className:"w-[10%] text-center min-w-[80px]",children:"更新"}),e.jsx(g,{className:"w-[10%] text-center min-w-[80px]",children:"创建"}),e.jsx(g,{className:"w-[5%] text-center min-w-[60px]"})]})}),e.jsx(De,{children:i.map(s=>e.jsxs(M,{className:"cursor-pointer hover:bg-muted/50 group",onClick:()=>{t&&t(s)},children:[e.jsx(j,{className:"min-w-[200px]",children:e.jsx("div",{className:"line-clamp-1 text-sm text-foreground/90 hover:text-primary cursor-pointer font-medium",onClick:a=>{a.stopPropagation(),t&&t(s)},children:s.title})}),e.jsx(j,{className:"w-[30%]",children:e.jsx("div",{className:"line-clamp-2 text-sm text-muted-foreground",children:s.description||"-"})}),e.jsx(j,{className:"text-sm text-muted-foreground w-[10%] text-center min-w-[80px] whitespace-nowrap",onClick:a=>a.stopPropagation(),children:s.view_count}),e.jsx(j,{className:"text-sm text-muted-foreground w-[10%] text-center min-w-[80px] whitespace-nowrap",onClick:a=>a.stopPropagation(),children:A(s.updated_at)}),e.jsx(j,{className:"text-sm text-muted-foreground w-[10%] text-center min-w-[80px] whitespace-nowrap",onClick:a=>a.stopPropagation(),children:A(s.created_at)}),e.jsx(j,{className:"w-[5%] min-w-[60px]",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1",children:[e.jsxs(H,{children:[e.jsx(I,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:a=>{a.stopPropagation(),t&&t(s)},children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsx(W,{className:"w-80",side:"left",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-700",children:s.description}),e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t space-y-1",children:[e.jsxs("div",{children:["创建时间: ",new Date(s.created_at).toLocaleString()]}),e.jsxs("div",{children:["更新时间: ",new Date(s.updated_at).toLocaleString()]}),e.jsxs("div",{children:["查看次数: ",s.view_count]}),s.is_public&&e.jsx("div",{className:"text-blue-600",children:"公开"})]})]})})]}),e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:a=>{a.stopPropagation(),n&&n(s)},children:e.jsx(R,{className:"h-4 w-4"})})]})})]},s.uuid))})]})})}function Se({whiteboard:i,onEditWhiteboard:t,onDeleteWhiteboard:n}){return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(H,{children:[e.jsx(I,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:s=>{s.stopPropagation(),t&&t(i)},children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsx(W,{className:"w-80",side:"left",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:i.title}),i.description&&e.jsx("p",{className:"text-sm text-gray-700",children:i.description}),e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("div",{children:["创建时间: ",new Date(i.created_at).toLocaleString()]}),e.jsxs("div",{children:["查看次数: ",i.view_count]}),i.is_public&&e.jsx("div",{className:"text-blue-600",children:"公开"})]})]})})]}),e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:s=>{s.stopPropagation(),n&&n(i)},children:e.jsx(R,{className:"h-4 w-4"})})]})}function _e({whiteboards:i,onEditWhiteboard:t,onDeleteWhiteboard:n}){return e.jsx("div",{className:"grid gap-3 grid-cols-5",children:i.map(s=>e.jsxs(ce,{className:"group cursor-pointer hover:shadow-md transition-all duration-200 hover:border-gray-300 flex flex-col h-[180px] bg-white border border-gray-200 rounded-lg relative",onClick:()=>{t&&t(s)},children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(Se,{whiteboard:s,onEditWhiteboard:t,onDeleteWhiteboard:n})}),e.jsxs(oe,{className:"p-4 flex-1 overflow-hidden",children:[e.jsx("h3",{className:"font-medium text-sm mb-2 line-clamp-2 text-gray-900 hover:text-primary cursor-pointer",onClick:a=>{a.stopPropagation(),t&&t(s)},children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),s.view_count>0&&e.jsxs("div",{className:"text-xs text-gray-400",children:[s.view_count," 次查看"]})]})]})]},s.uuid))})}function Fe(i,t){const[n,s]=o.useState(i);return o.useEffect(()=>{const a=setTimeout(()=>{s(i)},t);return()=>{clearTimeout(a)}},[i,t]),n}function Ae(){var S,_;const i=w(),[t,n]=o.useState(""),[s,a]=o.useState(!1),[m,p]=o.useState(!1),[u,d]=o.useState(null),[v,N]=o.useState("card"),c=Fe(t,500);o.useEffect(()=>{const r=fe("card");N(r)},[]);const l=r=>{N(r),ye(r)},{data:x,isLoading:C,fetchNextPage:D,hasNextPage:b,isFetchingNextPage:k}=he({queryKey:["whiteboards-infinite",c],queryFn:({pageParam:r=1})=>ge({pageParam:r,keyword:c}),initialPageParam:1,getNextPageParam:(r,E)=>{if(r.data.length===je)return E.length+1},staleTime:0,refetchOnMount:!0,refetchOnWindowFocus:!0}),f=o.useMemo(()=>(x==null?void 0:x.pages.flatMap(r=>r.data))||[],[x]),{loadMoreRef:O}=pe({hasNextPage:b,isFetchingNextPage:k,fetchNextPage:D,threshold:200}),Q=()=>{a(!0)},T=r=>{window.open(`/whiteboard/${r.uuid}`,"_blank")},P=r=>{d(r),p(!0)},B=()=>{i.invalidateQueries({queryKey:["whiteboards"]})};return e.jsx(e.Fragment,{children:e.jsxs(ue,{className:"h-screen flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 border-b bg-background",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"白板"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(q,{placeholder:"搜索白板...",value:t,onChange:r=>n(r.target.value),className:"pl-8 h-8 w-48 bg-transparent text-sm"})]}),e.jsx(Ne,{currentView:v,onViewChange:l}),e.jsxs(h,{onClick:Q,variant:"ghost",children:[e.jsx(xe,{className:"h-4 w-4"}),"新建白板"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto pt-0 px-6 pt-6 pb-6",children:[!C&&((_=(S=x==null?void 0:x.pages)==null?void 0:S[0])==null?void 0:_.count)&&x.pages[0].count>0&&e.jsx("div",{className:"mb-6 text-sm text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:["找到 ",x.pages[0].count,' 个匹配 "',c,'" 的白板']}):e.jsxs(e.Fragment,{children:["共 ",x.pages[0].count," 个白板"]})}),C&&f.length===0?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-gray-400"})}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(be,{className:"h-12 w-12 mb-2"}),e.jsx("p",{className:"text-sm",children:c?`没有找到匹配 "${c}" 的白板`:"暂无白板"})]}):e.jsxs(e.Fragment,{children:[v==="card"?e.jsx(_e,{whiteboards:f,onEditWhiteboard:T,onDeleteWhiteboard:P}):e.jsx(Pe,{whiteboards:f,onEditWhiteboard:T,onDeleteWhiteboard:P}),e.jsx("div",{ref:O,className:"mt-8 flex justify-center",children:k?e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx(y,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"加载更多..."})]}):b?e.jsx("div",{className:"py-4",children:e.jsx(h,{variant:"outline",onClick:()=>D(),className:"text-sm",children:c?"点击加载更多搜索结果":"点击加载更多"})}):f.length>0?e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"已到底啦"})}):null})]})]})}),e.jsx(ke,{open:s,onOpenChange:a,onWhiteboardCreated:B}),e.jsx(Te,{open:m,onOpenChange:p,whiteboard:u})]})})}const ze=me("/_authenticated_notes/whiteboard")({component:Ae});export{ze as Route};
