import{ad as p,r as d,u as q,b as m,at as y}from"./index-QCM3tg6T.js";import{u as D,a as E}from"./use-infinite-scroll-Hevnk5Sy.js";const M=9,I=e=>{const{sub_type:t,command:s,args:i,env:a,url:c,headers:n,timeout:r}=e;return t==="stdio"?{command:s||"",args:i?i.split(/\s+/).filter(Boolean):[],env:a||"",timeout:r||30}:t==="sse"?{url:c||"",timeout:r||30}:t==="streamableHttp"?{url:c||"",headers:n||"",timeout:r||30}:{command:"",args:[],env:"",timeout:30}},L=async({pageParam:e=1,keyword:t,tool_type:s})=>{const i={page:e,rows:M,...(t==null?void 0:t.trim())&&{keyword:t.trim()},...s&&{tool_type:s}},{data:a}=await p.post("/tools/page",i);return{data:a.items,count:a.pagination.total}},O=async e=>{const{data:t}=await p.post(`/tools/mcpinfo/${e}`);return{tool:t.tool_info,mcp_info:{tools:t.tools,resources:t.resources,prompts:t.prompts}}};function N(e,t){const[s,i]=d.useState(e);return d.useEffect(()=>{const a=setTimeout(()=>{i(e)},t);return()=>{clearTimeout(a)}},[e,t]),s}function A(){var b;const[e,t]=d.useState(""),[s,i]=d.useState(""),a=N(e,500),[c,n]=d.useState({type:null}),r=q(),{data:l,isLoading:C,error:F,fetchNextPage:f,hasNextPage:T,isFetchingNextPage:h}=D({queryKey:["tools-infinite",a,s],queryFn:({pageParam:o=1})=>L({pageParam:o,keyword:a,tool_type:s||void 0}),initialPageParam:1,getNextPageParam:(o,u)=>{if(o.data.length===M)return u.length+1},staleTime:5*60*1e3}),v=d.useMemo(()=>(l==null?void 0:l.pages.flatMap(o=>o.data))||[],[l]),{loadMoreRef:x}=E({hasNextPage:T,isFetchingNextPage:h,fetchNextPage:f,threshold:200}),g=()=>{r.invalidateQueries({queryKey:["tools-infinite"]})},S=m({mutationFn:o=>p.post("/tools/create",o).then(u=>u.data),onSuccess:o=>{y({title:"创建成功",description:`工具 "${o.name}" 已创建`}),g(),n({type:null})}}),_=m({mutationFn:({uuid:o,data:u})=>p.post(`/tools/update/${o}`,u).then($=>$.data),onSuccess:o=>{y({title:"更新成功",description:`工具 "${o.name}" 已更新`}),g(),n({type:null})}}),P=m({mutationFn:o=>p.post(`/tools/delete/${o.uuid}`).then(u=>u.data),onSuccess:(o,u)=>{y({title:"删除成功",description:`工具 "${u.name}" 已删除`}),g(),n({type:null})}}),Q={create:()=>n({type:"create"}),edit:o=>n({type:"edit",tool:o}),delete:o=>n({type:"delete",tool:o}),close:()=>n({type:null})};return{tools:v,totalCount:((b=l==null?void 0:l.pages[0])==null?void 0:b.count)||0,isLoading:C||S.isPending||_.isPending||P.isPending,error:F,hasNextPage:T,isFetchingNextPage:h,fetchNextPage:f,searchQuery:e,setSearchQuery:t,toolTypeFilter:s,setToolTypeFilter:i,dialogState:c,dialogActions:Q,createTool:S.mutate,updateTool:_.mutate,deleteTool:P.mutate,loadMoreRef:x}}function V(){const{dialogState:e,dialogActions:t,createTool:s,updateTool:i,deleteTool:a,isLoading:c}=A();return{open:e.type,currentTool:e.tool,isLoading:c,openCreate:t.create,openEdit:t.edit,openDelete:t.delete,closeDialog:t.close,handleSubmit:n=>{const r=I(n),l={name:n.name,description:n.description,tool_type:n.tool_type,sub_type:n.sub_type,tags:n.tags,is_active:n.is_active,tool_conf:r};e.type==="create"?s(l):e.type==="edit"&&e.tool&&i({uuid:e.tool.uuid,data:l})},handleDelete:()=>{e.tool&&a(e.tool)}}}export{A as a,O as g,V as u};
