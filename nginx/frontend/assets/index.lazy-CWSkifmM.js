import{a6 as u,j as e,B as p,P as he,S as je,I as j,X,i as $,r as w,K as ue,a8 as pe,a9 as ge,D as ve,d as fe,e as ye,f as be,g as Ne,aa as we,ab as r,ac as c,ae as d,ad as i,af as o,E as G,b7 as Ce,aE as _e,h as Se,C as ke,N as Ee,O as De,R as Pe,U as ie,T as Ve,w as Ae}from"./index-C_oIiI4O.js";import{T as P}from"./textarea-C7_dNQbG.js";import{S as se,a as ae,b as te,c as le,d as ne}from"./select-BauWeIlu.js";import{S as J}from"./switch-Dt4iotig.js";import{C as Fe}from"./confirm-dialog-CIPCPIvP.js";import{u as Ke,a as ze,g as Ie}from"./mcptools.service-BxNWhckW.js";import{H as Te}from"./header-r54Q9O0z.js";import{M as Me}from"./main-DSKQ9ujU.js";import{T as Oe,a as Re,b as Y,c as Q}from"./tabs-DST1jKAc.js";import{E as de}from"./eye-off-BWyvkZrK.js";import{E as oe}from"./eye-4HsJyM9I.js";import{C as $e}from"./chevron-down-DRo-ILD-.js";import{E as He}from"./ellipsis-vertical-C0GcISUa.js";import{S as Be}from"./square-pen-DhP0NQU-.js";import"./index-C0WwR0Wa.js";import"./use-infinite-scroll-BwChjD87.js";const Ue=u.object({name:u.string().min(1,{message:"工具名称是必填项"}).max(200,{message:"名称不能超过200个字符"}),description:u.string().optional(),tool_type:u.string().default("mcp"),sub_type:u.string().default("stdio"),tags:u.array(u.string()).default([]),is_active:u.boolean().default(!0),command:u.string().optional(),args:u.string().optional(),env:u.string().optional(),url:u.string().optional(),api_key:u.string().optional(),headers:u.string().default(""),timeout:u.number().optional()}).refine(x=>{var n,a;return x.sub_type==="stdio"?!!((n=x.command)!=null&&n.trim()):x.sub_type==="sse"||x.sub_type==="streamableHttp"?!!((a=x.url)!=null&&a.trim()):!0},{message:"请填写必要的配置信息",path:["sub_type"]}),re=[{value:"stdio",label:"STDIO"},{value:"sse",label:"SSE"},{value:"streamableHttp",label:"Streamable HTTP"}];function qe({open:x,currentTool:n,isLoading:a,closeDialog:y,handleSubmit:N}){const[m,b]=w.useState(""),[f,V]=w.useState(new Set(["get_channel_videos"])),[C,S]=w.useState("info"),[h,k]=w.useState(null),[H,E]=w.useState(new Set),[B,A]=w.useState(!1),[K,D]=w.useState(!1),z=!!n,W=x==="create"||x==="edit",{data:I,isLoading:_}=ue({queryKey:["mcp-info",n==null?void 0:n.uuid,C],queryFn:()=>Ie(n.uuid),enabled:!!n&&n.sub_type==="streamableHttp"&&["tools","prompts","resources"].includes(C)&&!H.has(`${n.uuid}-${C}`),staleTime:5*60*1e3});w.useEffect(()=>{I&&n&&(k(I.mcp_info),E(s=>new Set(s).add(`${n.uuid}-${C}`)))},[I,n,C]);const l=pe({resolver:ge(Ue),defaultValues:{name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",api_key:"",headers:"",timeout:30}});w.useEffect(()=>{if(n){const s=n.tool_conf||{},t=n.sub_type||"stdio";let g="",q="",T="",F="",ee="",M="";if(t==="stdio"){g=s.command||"",q=s.args?Array.isArray(s.args)?s.args.join(" "):s.args:"";const v=s.env;typeof v=="object"&&v!==null?T=Object.entries(v).map(([O,R])=>`${O}=${R}`).join(`
`):T=v||""}else if(t==="sse"){F=s.url||"",ee=s.api_key||"";const v=s.headers;typeof v=="object"&&v!==null?M=Object.entries(v).map(([O,R])=>`${O}: ${R}`).join(`
`):M=v||""}else if(t==="streamableHttp"){F=s.url||"",ee=s.api_key||"";const v=s.headers;typeof v=="object"&&v!==null?M=Object.entries(v).map(([O,R])=>`${O}: ${R}`).join(`
`):M=v||""}l.reset({name:n.name,description:n.description||"",tool_type:n.tool_type||"mcp",sub_type:t,tags:n.tags||[],is_active:n.is_active??!0,command:g,args:q,env:T,url:F,api_key:ee,headers:M,timeout:s.timeout||30}),S("info"),k(null),E(new Set),A(!1),D(!1)}else l.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",api_key:"",headers:"",timeout:30}),S("info"),k(null),E(new Set),A(!1),D(!1)},[n,l]);const xe=s=>{N(s),b("")},U=()=>{if(m.trim()&&!l.getValues("tags").includes(m.trim())){const s=l.getValues("tags");l.setValue("tags",[...s,m.trim()]),b("")}},Z=s=>{const t=l.getValues("tags");l.setValue("tags",t.filter(g=>g!==s))},L=s=>{s.key==="Enter"&&(s.preventDefault(),U())},me=s=>{const t=new Set(f);t.has(s)?t.delete(s):t.add(s),V(t)},ce=s=>{!a&&!s&&(l.reset({name:"",description:"",tool_type:"mcp",sub_type:"stdio",tags:[],is_active:!0,command:"",args:"",env:"",url:"",api_key:"",headers:"",timeout:30}),b(""),S("info"),k(null),E(new Set),A(!1),D(!1),y())};return e.jsx(ve,{open:W,onOpenChange:ce,children:e.jsxs(fe,{className:"sm:max-w-1xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{className:"text-left",children:[e.jsx(be,{children:z?`编辑工具 - ${n==null?void 0:n.name}`:"创建工具"}),e.jsxs(Ne,{children:[z?"修改工具信息":"创建一个新的工具","，填写必要信息后点击保存。"]})]}),e.jsx(we,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(xe),className:"space-y-4",children:[e.jsx(r,{control:l.control,name:"tool_type",render:({field:s})=>e.jsx(c,{className:"hidden",children:e.jsx(d,{children:e.jsx(j,{...s,type:"hidden"})})})}),l.watch("sub_type")==="streamableHttp"&&e.jsx(e.Fragment,{children:e.jsxs(Oe,{value:C,onValueChange:S,className:"w-full",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(Y,{value:"info",children:"信息"}),e.jsx(Y,{value:"tools",children:"工具"}),e.jsx(Y,{value:"prompts",children:"提示"}),e.jsx(Y,{value:"resources",children:"资源"})]}),e.jsxs(Q,{value:"info",className:"space-y-4",children:[e.jsx(r,{control:l.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(d,{children:e.jsx(j,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(d,{children:e.jsx(P,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(se,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(d,{children:e.jsx(ae,{children:e.jsx(te,{placeholder:"选择对接方式"})})}),e.jsx(le,{children:re.map(t=>e.jsx(ne,{value:t.value,children:t.label},t.value))})]}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"url",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"URL *"}),e.jsx(d,{children:e.jsx(j,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"api_key",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"API Key"}),e.jsx(d,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:B?"text":"password",placeholder:"请输入API密钥",...s,disabled:a,className:"pr-10"}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 hover:bg-transparent",onClick:()=>A(!B),disabled:a,children:B?e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:'格式如"Authorization": "Bearer API_KEY"，将自动添加到请求头中'}),e.jsx(o,{})]})}),l.watch("sub_type")==="streamableHttp"&&e.jsx(r,{control:l.control,name:"headers",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"请求头"}),e.jsx(d,{children:e.jsx(P,{placeholder:`例如:
Authorization: Bearer your_token_here
Content-Type: application/json
X-API-Key: your_api_key
每行一个请求头，格式：Key: Value`,className:"resize-none",rows:4,...s,disabled:a})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"每行一个请求头，格式：Key: Value。空行会被忽略。"}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(d,{children:e.jsx(j,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:t=>s.onChange(parseInt(t.target.value)||30),disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(d,{children:e.jsx(J,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(r,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{placeholder:"输入标签后按回车添加",value:m,onChange:t=>b(t.target.value),onKeyPress:L,disabled:a}),e.jsx(p,{type:"button",variant:"outline",onClick:U,disabled:!m.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((t,g)=>e.jsxs(G,{variant:"secondary",className:"text-sm",children:[t,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Z(t),disabled:a,children:e.jsx(X,{className:"h-3 w-3"})})]},g))})]}),e.jsx(o,{})]})})]}),e.jsx(Q,{value:"tools",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:_?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载工具信息中..."})]}):h!=null&&h.tools&&h.tools.length>0?h.tools.map((s,t)=>e.jsxs("div",{className:"border rounded p-3 hover:bg-accent cursor-pointer",onClick:()=>me(s.name),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[f.has(s.name)?e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}):e.jsx(Ce,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]})}),f.has(s.name)&&e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:s.inputSchema&&e.jsxs("div",{className:"mt-3 ml-5",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"输入参数:"}),e.jsx("div",{className:"bg-muted rounded p-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 text-xs",children:Object.entries(s.inputSchema.properties||{}).map(([g,q])=>{var F;const T=((F=s.inputSchema.required)==null?void 0:F.includes(g))||!1;return e.jsxs(_e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[g,T&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"text-muted-foreground",children:e.jsx("span",{className:"inline-flex items-center",children:q.type})})]},g)})})})]})})]},t)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用工具"})})}),e.jsx(Q,{value:"prompts",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:_?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载提示信息中..."})]}):h!=null&&h.prompts&&h.prompts.length>0?h.prompts.map((s,t)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description}),s.arguments&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"参数:"}),e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto",children:JSON.stringify(s.arguments,null,2)})]})]},t)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用提示"})})}),e.jsx(Q,{value:"resources",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:_?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx($,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载资源信息中..."})]}):h!=null&&h.resources&&h.resources.length>0?h.resources.map((s,t)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium mb-2",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("div",{className:"text-xs text-blue-600 break-all",children:["URI: ",s.uri]})]},t)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"暂无可用资源"})})})]})}),l.watch("sub_type")==="sse"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{control:l.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(d,{children:e.jsx(j,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(d,{children:e.jsx(P,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(se,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(d,{children:e.jsx(ae,{children:e.jsx(te,{placeholder:"选择对接方式"})})}),e.jsx(le,{children:re.map(t=>e.jsx(ne,{value:t.value,children:t.label},t.value))})]}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"url",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"URL *"}),e.jsx(d,{children:e.jsx(j,{type:"url",placeholder:"例如: http://localhost:8000/events",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"api_key",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"API Key"}),e.jsx(d,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:K?"text":"password",placeholder:"请输入API密钥",...s,disabled:a,className:"pr-10"}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 hover:bg-transparent",onClick:()=>D(!K),disabled:a,children:K?e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:'格式如"Authorization": "Bearer API_KEY"，将自动添加到请求头中'}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"headers",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"请求头"}),e.jsx(d,{children:e.jsx(P,{placeholder:`例如:
Authorization: Bearer your_token_here
Content-Type: application/json
X-API-Key: your_api_key
每行一个请求头，格式：Key: Value`,className:"resize-none",rows:4,...s,disabled:a})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"每行一个请求头，格式：Key: Value。空行会被忽略。"}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(d,{children:e.jsx(j,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:t=>s.onChange(parseInt(t.target.value)||30),disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(d,{children:e.jsx(J,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(r,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{placeholder:"输入标签后按回车添加",value:m,onChange:t=>b(t.target.value),onKeyPress:L,disabled:a}),e.jsx(p,{type:"button",variant:"outline",onClick:U,disabled:!m.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((t,g)=>e.jsxs(G,{variant:"secondary",className:"text-sm",children:[t,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Z(t),disabled:a,children:e.jsx(X,{className:"h-3 w-3"})})]},g))})]}),e.jsx(o,{})]})})]}),l.watch("sub_type")==="stdio"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{control:l.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"工具名称 *"}),e.jsx(d,{children:e.jsx(j,{placeholder:"请输入工具名称",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"描述"}),e.jsx(d,{children:e.jsx(P,{placeholder:"请输入工具描述",className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"sub_type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"对接方式"}),e.jsxs(se,{onValueChange:s.onChange,defaultValue:s.value,disabled:a,children:[e.jsx(d,{children:e.jsx(ae,{children:e.jsx(te,{placeholder:"选择对接方式"})})}),e.jsx(le,{children:re.map(t=>e.jsx(ne,{value:t.value,children:t.label},t.value))})]}),e.jsx(o,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{control:l.control,name:"command",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"命令 *"}),e.jsx(d,{children:e.jsx(j,{placeholder:"例如: python, node, npx",...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"args",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"参数"}),e.jsx(d,{children:e.jsx(P,{placeholder:`例如: path/to/script.py --option value
每行一个参数，或者用空格分隔`,className:"resize-none",rows:3,...s,disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"env",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"环境变量"}),e.jsx(d,{children:e.jsx(P,{placeholder:`例如:
API_KEY=your_api_key_here
DEBUG=true
PORT=3000
每行一个环境变量，格式：KEY=VALUE`,className:"resize-none",rows:4,...s,disabled:a})}),e.jsx(o,{})]})})]}),e.jsx(r,{control:l.control,name:"timeout",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"超时时间（秒）"}),e.jsx(d,{children:e.jsx(j,{type:"number",min:1,max:300,placeholder:"30",...s,onChange:t=>s.onChange(parseInt(t.target.value)||30),disabled:a})}),e.jsx(o,{})]})}),e.jsx(r,{control:l.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"启用状态"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"是否启用此工具"})]}),e.jsx(d,{children:e.jsx(J,{checked:s.value,onCheckedChange:s.onChange,disabled:a})})]})}),e.jsx(r,{control:l.control,name:"tags",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"标签"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{placeholder:"输入标签后按回车添加",value:m,onChange:t=>b(t.target.value),onKeyPress:L,disabled:a}),e.jsx(p,{type:"button",variant:"outline",onClick:U,disabled:!m.trim()||a,children:"添加"})]}),s.value.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.value.map((t,g)=>e.jsxs(G,{variant:"secondary",className:"text-sm",children:[t,e.jsx(p,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 text-muted-foreground hover:text-foreground",onClick:()=>Z(t),disabled:a,children:e.jsx(X,{className:"h-3 w-3"})})]},g))})]}),e.jsx(o,{})]})})]}),e.jsxs(Se,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>ce(!1),disabled:a,children:"取消"}),e.jsx(p,{type:"submit",disabled:a,children:a?"保存中...":z?"更新":"创建"})]})]})})]})})}function Ye({open:x,currentTool:n,isLoading:a,closeDialog:y,handleDelete:N}){return e.jsx(Fe,{open:x==="delete",onOpenChange:m=>!m&&y(),handleConfirm:N,title:"删除工具",desc:n?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["确定要删除工具 ",e.jsxs("span",{className:"font-semibold",children:['"',n.name,'"']})," 吗？"]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["• 对接方式：",n.sub_type]}),e.jsxs("p",{children:["• 标签：",n.tags.join(", ")||"无"]})]}),e.jsx("p",{className:"text-sm font-medium text-destructive mt-3",children:"此操作无法撤销，请谨慎操作。"})]}):"此操作无法撤销，请谨慎操作。",confirmText:"删除",destructive:!0,isLoading:a})}function Qe({tool:x,openEdit:n,openDelete:a,toggleToolStatus:y}){const N=m=>{y({toolUuid:x.uuid,enable:m})};return e.jsx(ke,{className:"p-4 hover:bg-accent hover:text-accent-foreground border-0 relative group",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold truncate",children:x.name})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{checked:x.is_active,onCheckedChange:N}),e.jsxs(Ee,{children:[e.jsx(De,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(He,{className:"h-4 w-4"})})}),e.jsxs(Pe,{align:"end",children:[e.jsxs(ie,{onClick:()=>n(x),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"编辑"]}),e.jsxs(ie,{onClick:()=>a(x),className:"text-destructive focus:text-destructive",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"删除"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs text-muted-foreground",children:[e.jsx("span",{children:x.sub_type}),!x.is_active&&e.jsx(G,{variant:"secondary",className:"text-xs",children:"已禁用"})]}),e.jsx("p",{className:"text-sm text-muted-foreground flex-grow line-clamp-2",children:x.description||"暂无描述"})]})})}function Xe({dialogProps:x}){const{tools:n,totalCount:a,isLoading:y,error:N,hasNextPage:m,isFetchingNextPage:b,searchQuery:f,setSearchQuery:V,loadMoreRef:C,fetchNextPage:S,toggleToolStatus:h}=ze(),{open:k,currentTool:H,dialogLoading:E,openCreate:B,openEdit:A,openDelete:K,closeDialog:D,handleSubmit:z,handleDelete:W}=x,I=()=>{V("")};return N?e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-destructive",children:"加载工具失败"}),e.jsx(p,{onClick:()=>S(),className:"mt-4",children:"重试"})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto pt-0 px-6 pb-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{className:"pl-8 h-10 bg-transparent",placeholder:"搜索工具名称、描述或标签...",value:f,onChange:_=>V(_.target.value)}),f&&e.jsx(p,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 opacity-70 hover:opacity-100",onClick:I,disabled:y,children:e.jsx(X,{className:"h-4 w-4"})})]})}),!y&&e.jsx("div",{className:"mb-6 text-sm text-muted-foreground",children:a>0&&(f?e.jsxs(e.Fragment,{children:["找到 ",a,' 个匹配 "',f,'" 的工具']}):e.jsxs(e.Fragment,{children:["共 ",a," 个工具"]}))}),y&&n.length===0?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx($,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"加载中..."})]}):n.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:f?`没有找到匹配 "${f}" 的工具`:"还没有工具，点击上方按钮创建第一个工具"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(_=>e.jsx(Qe,{tool:_,openEdit:A,openDelete:K,toggleToolStatus:h},_.uuid))}),e.jsx("div",{ref:C,className:"mt-8 flex justify-center",children:b?e.jsxs("div",{className:"flex items-center gap-2 py-4",children:[e.jsx($,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"加载更多..."})]}):m?e.jsx("div",{className:"py-4",children:e.jsx(p,{variant:"outline",onClick:()=>S(),className:"text-sm",children:f?"点击加载更多搜索结果":"点击加载更多"})}):n.length>0?e.jsx("div",{className:"py-4 text-center",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"已到底啦"})}):null})]}),e.jsx(qe,{open:k,currentTool:H,isLoading:E,closeDialog:D,handleSubmit:z}),e.jsx(Ye,{open:k,currentTool:H,isLoading:E,closeDialog:D,handleDelete:W}),e.jsx("div",{className:"h-[30px]"})]})}function Ge(){const{open:x,currentTool:n,isLoading:a,openCreate:y,openEdit:N,openDelete:m,closeDialog:b,handleSubmit:f,handleDelete:V}=Ke();return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{fixed:!0,children:[e.jsx("h3",{className:"text-2xl font-bold",children:"MCP工具"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsxs(p,{onClick:y,variant:"ghost",children:[e.jsx(he,{className:"h-4 w-4"}),"新建工具"]})})]}),e.jsx(Me,{children:e.jsx(Xe,{dialogProps:{open:x,currentTool:n,dialogLoading:a,openEdit:N,openDelete:m,closeDialog:b,handleSubmit:f,handleDelete:V}})})]})}const ms=Ae("/_authenticated/mcptools/")({component:Ge});export{ms as Route};
